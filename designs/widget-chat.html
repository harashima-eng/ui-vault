<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Widget</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

:root{
  --bg:#0b0c0f;
  --surface:#151720;
  --surface-raised:#1c1e2a;
  --accent:#8b5cf6;
  --accent-soft:rgba(139,92,246,0.15);
  --accent-glow:rgba(139,92,246,0.3);
  --text:#e8e9ed;
  --text-secondary:#8b8d98;
  --text-tertiary:#5c5e6a;
  --border:rgba(255,255,255,0.08);
  --radius:14px;
  --font:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  --msg-user:var(--accent);
  --msg-user-text:#fff;
  --msg-agent:var(--surface-raised);
  --msg-agent-text:var(--text);
  --online:#34d399;
  --bubble-size:60px;
  --chat-width:380px;
  --chat-height:540px;
  --scrollbar-thumb:rgba(255,255,255,0.08);
}

body{
  min-height:100dvh;
  font-family:var(--font);
  background:var(--bg);
  color:var(--text);
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ─── Dot Grid Background ──────────────────── */
body::before{
  content:'';
  position:fixed;
  inset:0;
  background-image:radial-gradient(circle,rgba(255,255,255,0.04) 1px,transparent 1px);
  background-size:28px 28px;
  pointer-events:none;
  z-index:0;
}

/* ─── Page Info ────────────────────────────── */
.page-info{
  position:relative;
  z-index:1;
  text-align:center;
  padding:40px 24px;
}

.page-info h1{
  font-size:clamp(28px,4vw,42px);
  font-weight:700;
  line-height:1.2;
  letter-spacing:-0.02em;
  color:var(--text);
  margin-bottom:8px;
  text-wrap:balance;
}

.page-info p{
  font-size:15px;
  color:var(--text-secondary);
  max-width:40ch;
  margin:0 auto;
}

/* ─── Chat Bubble ──────────────────────────── */
.chat-bubble{
  position:fixed;
  bottom:28px;
  right:28px;
  z-index:200;
  width:var(--bubble-size);
  height:var(--bubble-size);
  border-radius:50%;
  background:var(--accent);
  border:none;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  box-shadow:0 4px 20px var(--accent-glow), 0 2px 8px rgba(0,0,0,0.3);
  font-family:var(--font);
}

.chat-bubble svg{
  width:26px;
  height:26px;
}

.chat-bubble .close-icon{
  display:none;
}

.chat-bubble.is-open .chat-icon{
  display:none;
}

.chat-bubble.is-open .close-icon{
  display:block;
}

/* Unread badge */
.unread-badge{
  position:absolute;
  top:-2px;
  right:-2px;
  width:22px;
  height:22px;
  border-radius:50%;
  background:#ef4444;
  color:#fff;
  font-size:11px;
  font-weight:700;
  display:flex;
  align-items:center;
  justify-content:center;
  border:2px solid var(--bg);
  pointer-events:none;
}

/* ─── Chat Window ──────────────────────────── */
.chat-window{
  position:fixed;
  bottom:calc(28px + var(--bubble-size) + 16px);
  right:28px;
  z-index:199;
  width:var(--chat-width);
  height:var(--chat-height);
  max-height:calc(100dvh - 120px);
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:
    0 0 0 1px rgba(0,0,0,0.2),
    0 20px 60px rgba(0,0,0,0.5),
    0 0 30px var(--accent-glow);
  display:flex;
  flex-direction:column;
  overflow:hidden;
  visibility:hidden;
  pointer-events:none;
  opacity:0;
  transform:scale(0.9) translateY(20px);
  transform-origin:bottom right;
}

.chat-window.open{
  visibility:visible;
  pointer-events:auto;
}

/* ─── Chat Header ──────────────────────────── */
.chat-header{
  display:flex;
  align-items:center;
  gap:12px;
  padding:16px 18px;
  border-bottom:1px solid var(--border);
  flex-shrink:0;
}

.agent-avatar{
  position:relative;
  width:38px;
  height:38px;
  border-radius:50%;
  background:linear-gradient(135deg,var(--accent),#a78bfa);
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-weight:700;
  font-size:15px;
  flex-shrink:0;
}

.agent-avatar .status-dot{
  position:absolute;
  bottom:0;right:0;
  width:10px;height:10px;
  border-radius:50%;
  background:var(--online);
  border:2px solid var(--surface);
}

.agent-info{flex:1;min-width:0}

.agent-name{
  font-size:14px;
  font-weight:600;
  color:var(--text);
  line-height:1.3;
}

.agent-status{
  font-size:12px;
  color:var(--online);
  display:flex;
  align-items:center;
  gap:4px;
}

.header-close{
  width:32px;height:32px;
  border-radius:8px;
  background:none;
  border:none;
  color:var(--text-tertiary);
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ─── Messages Area ────────────────────────── */
.chat-messages{
  flex:1;
  overflow-y:auto;
  padding:18px 14px 12px;
  display:flex;
  flex-direction:column;
  gap:6px;
  scrollbar-width:thin;
  scrollbar-color:var(--scrollbar-thumb) transparent;
}

.chat-messages::-webkit-scrollbar{width:5px}
.chat-messages::-webkit-scrollbar-track{background:transparent}
.chat-messages::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb);border-radius:3px}

/* ─── Message Rows ─────────────────────────── */
.msg-row{
  display:flex;
  align-items:flex-end;
  gap:8px;
  max-width:85%;
}

.msg-row.agent{
  align-self:flex-start;
}

.msg-row.user{
  align-self:flex-end;
  flex-direction:row-reverse;
}

.msg-avatar{
  width:26px;
  height:26px;
  border-radius:50%;
  background:linear-gradient(135deg,var(--accent),#a78bfa);
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-size:10px;
  font-weight:700;
  flex-shrink:0;
}

.msg-row.user .msg-avatar{
  display:none;
}

.msg-bubble{
  padding:10px 14px;
  border-radius:16px;
  font-size:13.5px;
  line-height:1.5;
  max-width:100%;
  word-break:break-word;
}

.msg-row.agent .msg-bubble{
  background:var(--msg-agent);
  color:var(--msg-agent-text);
  border-bottom-left-radius:4px;
}

.msg-row.user .msg-bubble{
  background:var(--msg-user);
  color:var(--msg-user-text);
  border-bottom-right-radius:4px;
}

.msg-time{
  font-size:10px;
  color:var(--text-tertiary);
  padding:0 4px;
  flex-shrink:0;
  align-self:flex-end;
}

.msg-row.user .msg-time{
  text-align:right;
}

/* Consecutive same-sender: tighter gap */
.msg-row + .msg-row.agent,
.msg-row + .msg-row.user{
  margin-top:2px;
}

.msg-row.agent + .msg-row.user,
.msg-row.user + .msg-row.agent{
  margin-top:10px;
}

/* ─── Typing Indicator ─────────────────────── */
.typing-row{
  display:flex;
  align-items:flex-end;
  gap:8px;
  align-self:flex-start;
  max-width:85%;
}

.typing-dots{
  display:flex;
  align-items:center;
  gap:4px;
  padding:12px 16px;
  background:var(--msg-agent);
  border-radius:16px;
  border-bottom-left-radius:4px;
}

.typing-dots span{
  display:block;
  width:7px;
  height:7px;
  border-radius:50%;
  background:var(--text-tertiary);
}

/* ─── Input Area ───────────────────────────── */
.chat-input-area{
  display:flex;
  align-items:center;
  gap:8px;
  padding:12px 14px;
  border-top:1px solid var(--border);
  flex-shrink:0;
}

.chat-input{
  flex:1;
  padding:10px 14px;
  background:var(--surface-raised);
  border:1px solid var(--border);
  border-radius:22px;
  font-size:13.5px;
  font-family:var(--font);
  color:var(--text);
  outline:none;
  caret-color:var(--accent);
}

.chat-input::placeholder{
  color:var(--text-tertiary);
}

.send-btn{
  width:38px;
  height:38px;
  border-radius:50%;
  background:var(--accent);
  border:none;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  flex-shrink:0;
}

.send-btn:disabled{
  opacity:0.4;
  cursor:default;
}

.send-btn svg{
  width:18px;
  height:18px;
}

/* ─── Responsive ───────────────────────────── */
@media(max-width:440px){
  .chat-window{
    right:8px;
    left:8px;
    bottom:calc(20px + var(--bubble-size) + 12px);
    width:auto;
  }
  .chat-bubble{
    right:16px;
    bottom:16px;
  }
}
</style>
</head>
<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Flip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/TextPlugin.min.js"></script>
<script src="../animations/gsap-utils.js"></script>

<!-- ─── Page Info ──────────────────────────── -->
<div class="page-info">
  <h1>Chat Widget</h1>
  <p>A floating support chat with real-time typing indicators and smooth GSAP-powered transitions.</p>
</div>

<!-- ─── Chat Window ────────────────────────── -->
<div class="chat-window" id="chatWindow">

  <!-- Header -->
  <div class="chat-header">
    <div class="agent-avatar">
      S
      <span class="status-dot"></span>
    </div>
    <div class="agent-info">
      <div class="agent-name">Sarah from Support</div>
      <div class="agent-status">Online</div>
    </div>
    <button class="header-close" id="headerClose" aria-label="Close chat">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
    </button>
  </div>

  <!-- Messages -->
  <div class="chat-messages" id="chatMessages">

    <div class="msg-row agent">
      <div class="msg-avatar">S</div>
      <div class="msg-bubble">Hey there! Welcome to UI Vault. How can I help you today?</div>
    </div>

    <div class="msg-row user">
      <div class="msg-bubble">Hi! I'm looking for a dark-themed dashboard template. Got anything like that?</div>
    </div>

    <div class="msg-row agent">
      <div class="msg-avatar">S</div>
      <div class="msg-bubble">Absolutely! We have the Analytics Dashboard with GSAP animations, dark mode, and stat cards. Let me pull that up for you.</div>
    </div>

    <div class="msg-row user">
      <div class="msg-bubble">That sounds perfect. Does it include chart components?</div>
    </div>

    <div class="msg-row agent">
      <div class="msg-avatar">S</div>
      <div class="msg-bubble">Yes! It has animated bar charts, number countups, and a data table. All animations are GSAP-powered for smooth 60fps performance.</div>
    </div>

    <div class="msg-row user">
      <div class="msg-bubble">Great, I'll check it out. Thanks!</div>
    </div>

    <!-- Typing indicator -->
    <div class="typing-row" id="typingRow">
      <div class="msg-avatar">S</div>
      <div class="typing-dots">
        <span></span><span></span><span></span>
      </div>
    </div>
  </div>

  <!-- Input -->
  <div class="chat-input-area">
    <input type="text" class="chat-input" id="chatInput" placeholder="Type a message..." autocomplete="off" spellcheck="false">
    <button class="send-btn" id="sendBtn" disabled aria-label="Send message">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
    </button>
  </div>
</div>

<!-- ─── Chat Bubble ────────────────────────── -->
<button class="chat-bubble" id="chatBubble" aria-label="Open chat">
  <svg class="chat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
  <svg class="close-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
  <span class="unread-badge" id="unreadBadge">2</span>
</button>

<script>
gsap.registerPlugin(ScrollTrigger, Flip, TextPlugin);

var reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

(function() {
  'use strict';

  var chatBubble = document.getElementById('chatBubble');
  var chatWindow = document.getElementById('chatWindow');
  var chatMessages = document.getElementById('chatMessages');
  var chatInput = document.getElementById('chatInput');
  var sendBtn = document.getElementById('sendBtn');
  var headerClose = document.getElementById('headerClose');
  var unreadBadge = document.getElementById('unreadBadge');
  var typingRow = document.getElementById('typingRow');
  var isOpen = false;
  var typingTl = null;

  // ─── Typing Dots Animation ──────────────────
  function startTypingAnimation() {
    var dots = typingRow.querySelectorAll('.typing-dots span');
    if (reducedMotion) {
      gsap.set(dots, { opacity: 0.5 });
      return;
    }
    typingTl = gsap.timeline({ repeat: -1 });
    typingTl.to(dots[0], { y: -4, opacity: 1, duration: 0.3, ease: 'sine.inOut' })
      .to(dots[0], { y: 0, opacity: 0.4, duration: 0.3, ease: 'sine.inOut' })
      .to(dots[1], { y: -4, opacity: 1, duration: 0.3, ease: 'sine.inOut' }, 0.15)
      .to(dots[1], { y: 0, opacity: 0.4, duration: 0.3, ease: 'sine.inOut' }, 0.45)
      .to(dots[2], { y: -4, opacity: 1, duration: 0.3, ease: 'sine.inOut' }, 0.3)
      .to(dots[2], { y: 0, opacity: 0.4, duration: 0.3, ease: 'sine.inOut' }, 0.6);
  }

  function stopTypingAnimation() {
    if (typingTl) {
      typingTl.kill();
      typingTl = null;
    }
  }

  // ─── Open / Close ───────────────────────────
  function openChat() {
    if (isOpen) return;
    isOpen = true;
    chatWindow.classList.add('open');
    chatBubble.classList.add('is-open');

    // Hide unread badge
    gsap.to(unreadBadge, { scale: 0, opacity: 0, duration: 0.2, ease: 'power2.in' });

    if (!reducedMotion) {
      gsap.killTweensOf(chatWindow);
      gsap.fromTo(chatWindow,
        { opacity: 0, scale: 0.88, y: 20 },
        { opacity: 1, scale: 1, y: 0, duration: 0.4, ease: 'back.out(1.5)' }
      );

      // Stagger messages entrance
      var msgs = chatMessages.querySelectorAll('.msg-row, .typing-row');
      gsap.fromTo(msgs,
        { opacity: 0, y: 16 },
        { opacity: 1, y: 0, duration: 0.3, ease: 'power2.out', stagger: 0.05, delay: 0.15 }
      );

      // Bubble morph
      gsap.to(chatBubble, { scale: 0.9, duration: 0.15, ease: 'power2.in', yoyo: true, repeat: 1 });
    } else {
      gsap.set(chatWindow, { opacity: 1, scale: 1, y: 0 });
    }

    startTypingAnimation();
    scrollToBottom();
    requestAnimationFrame(function() { chatInput.focus(); });
  }

  function closeChat() {
    if (!isOpen) return;
    isOpen = false;
    chatBubble.classList.remove('is-open');
    stopTypingAnimation();

    if (!reducedMotion) {
      gsap.to(chatWindow, {
        opacity: 0, scale: 0.9, y: 16,
        duration: 0.25, ease: 'power2.in',
        onComplete: function() {
          chatWindow.classList.remove('open');
        }
      });
      gsap.to(chatBubble, { scale: 0.9, duration: 0.1, ease: 'power2.in', yoyo: true, repeat: 1 });
    } else {
      chatWindow.classList.remove('open');
      gsap.set(chatWindow, { opacity: 0 });
    }
  }

  function toggleChat() {
    if (isOpen) closeChat(); else openChat();
  }

  // ─── Send Message ───────────────────────────
  function sendMessage() {
    var text = chatInput.value.trim();
    if (!text) return;

    // Hide typing indicator
    gsap.to(typingRow, { opacity: 0, y: -8, duration: 0.15, ease: 'power2.in' });
    stopTypingAnimation();

    // Create user message
    var row = document.createElement('div');
    row.className = 'msg-row user';
    var bubble = document.createElement('div');
    bubble.className = 'msg-bubble';
    bubble.textContent = text;
    row.appendChild(bubble);

    typingRow.parentNode.insertBefore(row, typingRow);
    chatInput.value = '';
    sendBtn.disabled = true;

    // Animate message in
    if (!reducedMotion) {
      gsap.fromTo(row,
        { opacity: 0, y: 12, scale: 0.95 },
        { opacity: 1, y: 0, scale: 1, duration: 0.3, ease: 'back.out(1.4)' }
      );
    }

    scrollToBottom();

    // Simulate agent response
    setTimeout(function() {
      // Show typing
      gsap.to(typingRow, { opacity: 1, y: 0, duration: 0.2, ease: 'power2.out' });
      startTypingAnimation();
      scrollToBottom();

      setTimeout(function() {
        // Hide typing
        gsap.to(typingRow, { opacity: 0, y: -8, duration: 0.15, ease: 'power2.in' });
        stopTypingAnimation();

        setTimeout(function() {
          var agentRow = document.createElement('div');
          agentRow.className = 'msg-row agent';
          var av = document.createElement('div');
          av.className = 'msg-avatar';
          av.textContent = 'S';
          var agentBubble = document.createElement('div');
          agentBubble.className = 'msg-bubble';

          var responses = [
            "That's a great question! Let me look into that for you.",
            "I'd be happy to help with that. Give me just a moment.",
            "Sure thing! We have several options that might work.",
            "Absolutely, I can help you find exactly what you need.",
            "Great choice! Let me get you the details on that.",
          ];
          agentBubble.textContent = responses[Math.floor(Math.random() * responses.length)];

          agentRow.appendChild(av);
          agentRow.appendChild(agentBubble);
          typingRow.parentNode.insertBefore(agentRow, typingRow);

          if (!reducedMotion) {
            gsap.fromTo(agentRow,
              { opacity: 0, y: 12, scale: 0.95 },
              { opacity: 1, y: 0, scale: 1, duration: 0.3, ease: 'back.out(1.4)' }
            );
          }

          scrollToBottom();

          // Show typing again after a pause
          setTimeout(function() {
            gsap.to(typingRow, { opacity: 1, y: 0, duration: 0.2, ease: 'power2.out' });
            startTypingAnimation();
            scrollToBottom();
          }, 2000);
        }, 200);
      }, 1500 + Math.random() * 1000);
    }, 600);
  }

  function scrollToBottom() {
    requestAnimationFrame(function() {
      if (!reducedMotion) {
        gsap.to(chatMessages, {
          scrollTop: chatMessages.scrollHeight,
          duration: 0.3,
          ease: 'power2.out',
        });
      } else {
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
    });
  }

  // ─── Events ─────────────────────────────────
  chatBubble.addEventListener('click', toggleChat);
  headerClose.addEventListener('click', closeChat);

  chatInput.addEventListener('input', function() {
    sendBtn.disabled = !chatInput.value.trim();
  });

  chatInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  sendBtn.addEventListener('click', sendMessage);

  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && isOpen) {
      closeChat();
    }
  });

  // ─── Bubble Hover ───────────────────────────
  if (!reducedMotion) {
    chatBubble.addEventListener('mouseenter', function() {
      gsap.to(chatBubble, { scale: 1.08, duration: 0.25, ease: 'power2.out' });
    });
    chatBubble.addEventListener('mouseleave', function() {
      gsap.to(chatBubble, { scale: 1, duration: 0.25, ease: 'power2.out' });
    });

    // Send button hover
    sendBtn.addEventListener('mouseenter', function() {
      if (!sendBtn.disabled) {
        gsap.to(sendBtn, { scale: 1.1, duration: 0.2, ease: 'power2.out' });
      }
    });
    sendBtn.addEventListener('mouseleave', function() {
      gsap.to(sendBtn, { scale: 1, duration: 0.2, ease: 'power2.out' });
    });

    // Header close hover
    headerClose.addEventListener('mouseenter', function() {
      gsap.to(headerClose, { scale: 1.15, rotation: 90, duration: 0.25, ease: 'power2.out' });
    });
    headerClose.addEventListener('mouseleave', function() {
      gsap.to(headerClose, { scale: 1, rotation: 0, duration: 0.25, ease: 'power2.out' });
    });
  }

  // ─── Input Focus Glow ───────────────────────
  if (!reducedMotion) {
    chatInput.addEventListener('focus', function() {
      gsap.to('.chat-input', { boxShadow: '0 0 0 2px var(--accent-soft)', duration: 0.2, ease: 'power2.out' });
    });
    chatInput.addEventListener('blur', function() {
      gsap.to('.chat-input', { boxShadow: '0 0 0 0px transparent', duration: 0.2, ease: 'power2.out' });
    });
  }

  // ─── Page Entrance ──────────────────────────
  if (!reducedMotion) {
    var enterTl = gsap.timeline();
    enterTl.from('.page-info h1', { opacity: 0, y: -20, duration: 0.5, ease: 'power3.out' });
    enterTl.from('.page-info p', { opacity: 0, y: -12, duration: 0.4, ease: 'power3.out' }, '-=0.3');

    // Bubble entrance
    gsap.from(chatBubble, {
      scale: 0, opacity: 0,
      duration: 0.5,
      ease: 'back.out(2)',
      delay: 0.4,
    });

    // Unread badge pop
    gsap.from(unreadBadge, {
      scale: 0,
      duration: 0.3,
      ease: 'back.out(3)',
      delay: 0.9,
    });

    // Bubble pulse for attention
    gsap.to(chatBubble, {
      boxShadow: '0 4px 30px var(--accent-glow), 0 0 60px rgba(139,92,246,0.15)',
      duration: 1.2,
      ease: 'sine.inOut',
      repeat: -1,
      yoyo: true,
      delay: 1.5,
    });
  }

  UV.addControlPanel();
})();
</script>
</body>
</html>