<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Notification Center — UI Vault</title>
<style>
/* ============================================================
   DESIGN TOKENS
   ============================================================ */
:root {
  --bg: #09090b;
  --surface: #131316;
  --surface-raised: #1a1a1f;
  --surface-hover: rgba(255, 255, 255, 0.04);
  --accent: #f59e0b;
  --accent-soft: rgba(245, 158, 11, 0.12);
  --text: #e8e6e3;
  --text-secondary: #8a8680;
  --text-dim: #5a5650;
  --border: rgba(255, 255, 255, 0.07);
  --radius: 14px;
  --radius-sm: 8px;
  --font: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;

  /* Notification colors */
  --unread-dot: #3b82f6;
  --unread-bg: rgba(59, 130, 246, 0.06);
  --badge-red: #ef4444;
  --type-comment: #3b82f6;
  --type-mention: #8b5cf6;
  --type-system: #6b7280;
  --type-invite: #22c55e;
  --type-social: #f472b6;
  --type-billing: #f59e0b;
  --type-alert: #ef4444;
}

/* ============================================================
   RESET & BASE
   ============================================================ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  line-height: 1.5;
  min-height: 100dvh;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ============================================================
   APP HEADER (simulated)
   ============================================================ */
.app-header {
  position: sticky;
  top: 0;
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 24px;
  height: 56px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
}

.app-logo {
  font-size: 1rem;
  font-weight: 800;
  color: var(--text);
  letter-spacing: -0.03em;
}

.app-logo span { color: var(--accent); }

.app-search {
  width: 280px;
  padding: 7px 14px 7px 36px;
  font-family: var(--font);
  font-size: 0.8125rem;
  color: var(--text);
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  outline: none;
}

.app-search:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: -1px;
}

.app-search::placeholder { color: var(--text-dim); }

.search-wrapper {
  position: relative;
}

.search-wrapper svg {
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  width: 16px;
  height: 16px;
  stroke: var(--text-dim);
  stroke-width: 2;
  fill: none;
  pointer-events: none;
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* ── Bell Button ── */
.bell-wrapper {
  position: relative;
}

.bell-btn {
  width: 40px;
  height: 40px;
  border-radius: var(--radius-sm);
  background: none;
  border: 1px solid transparent;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  color: var(--text-secondary);
}

.bell-btn:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

.bell-btn svg {
  width: 20px;
  height: 20px;
  stroke: currentColor;
  stroke-width: 2;
  fill: none;
}

.bell-badge {
  position: absolute;
  top: 4px;
  right: 4px;
  min-width: 18px;
  height: 18px;
  padding: 0 5px;
  font-size: 0.625rem;
  font-weight: 700;
  color: #fff;
  background: var(--badge-red);
  border-radius: 100px;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  line-height: 1;
}

/* ── User Avatar ── */
.user-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: linear-gradient(145deg, #6d28d9, #3b82f6);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.75rem;
  font-weight: 700;
  color: #fff;
}

/* ============================================================
   NOTIFICATION DROPDOWN
   ============================================================ */
.notif-dropdown {
  position: absolute;
  top: calc(100% + 8px);
  right: 0;
  width: 380px;
  max-height: 520px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 2px 8px rgba(0, 0, 0, 0.3);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  transform-origin: top right;
  z-index: 200;
}

.notif-dropdown[data-open="false"] {
  pointer-events: none;
}

/* ── Header ── */
.notif-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px 10px;
  border-bottom: 1px solid var(--border);
}

.notif-header h2 {
  font-size: 0.9375rem;
  font-weight: 700;
  color: var(--text);
}

.mark-all-btn {
  font-family: var(--font);
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--accent);
  background: none;
  border: none;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 4px;
}

.mark-all-btn:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* ── Tab Bar ── */
.notif-tabs {
  display: flex;
  gap: 0;
  padding: 0 16px;
  border-bottom: 1px solid var(--border);
  position: relative;
}

.notif-tab {
  font-family: var(--font);
  font-size: 0.8125rem;
  font-weight: 600;
  color: var(--text-dim);
  background: none;
  border: none;
  padding: 10px 16px;
  cursor: pointer;
  position: relative;
}

.notif-tab:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: -2px;
}

.notif-tab[data-active="true"] {
  color: var(--accent);
}

.tab-indicator {
  position: absolute;
  bottom: 0;
  left: 16px;
  height: 2px;
  background: var(--accent);
  border-radius: 1px;
}

/* ── Notification List ── */
.notif-list {
  overflow-y: auto;
  flex: 1;
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,0.1) transparent;
}

.notif-list::-webkit-scrollbar { width: 6px; }
.notif-list::-webkit-scrollbar-track { background: transparent; }
.notif-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }

/* ── Date Group Header ── */
.notif-group-header {
  font-size: 0.6875rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--text-dim);
  padding: 10px 16px 6px;
}

/* ── Notification Item ── */
.notif-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 12px 16px;
  position: relative;
  cursor: pointer;
}

.notif-item[data-unread="true"] {
  background: var(--unread-bg);
}

/* Avatar */
.notif-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.75rem;
  font-weight: 700;
  color: #fff;
  flex-shrink: 0;
  position: relative;
}

.notif-avatar-badge {
  position: absolute;
  bottom: -2px;
  right: -2px;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: var(--surface);
  border: 2px solid var(--surface);
  display: flex;
  align-items: center;
  justify-content: center;
}

.notif-avatar-badge svg {
  width: 10px;
  height: 10px;
  stroke-width: 2.5;
  fill: none;
}

/* Content */
.notif-content {
  flex: 1;
  min-width: 0;
}

.notif-title {
  font-size: 0.8125rem;
  line-height: 1.4;
  color: var(--text);
}

.notif-item[data-unread="true"] .notif-title {
  font-weight: 600;
}

.notif-item[data-unread="false"] .notif-title {
  font-weight: 400;
  color: var(--text-secondary);
}

.notif-time {
  font-size: 0.6875rem;
  color: var(--text-dim);
  margin-top: 2px;
}

/* Unread dot */
.notif-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--unread-dot);
  flex-shrink: 0;
  margin-top: 6px;
}

.notif-item[data-unread="false"] .notif-dot {
  opacity: 0;
}

/* ── Empty State ── */
.notif-empty {
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 48px 24px;
  text-align: center;
}

.notif-empty.visible {
  display: flex;
}

.notif-empty svg {
  width: 40px;
  height: 40px;
  stroke: var(--text-dim);
  stroke-width: 1.5;
  fill: none;
  margin-bottom: 12px;
  opacity: 0.5;
}

.notif-empty-title {
  font-size: 0.9375rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 4px;
}

.notif-empty-desc {
  font-size: 0.8125rem;
  color: var(--text-dim);
}

/* ============================================================
   DEMO CONTENT AREA
   ============================================================ */
.demo-content {
  max-width: 600px;
  margin: 80px auto;
  padding: 0 24px;
  text-align: center;
}

.demo-content h1 {
  font-size: clamp(1.75rem, 3vw + 0.5rem, 2.5rem);
  font-weight: 800;
  letter-spacing: -0.03em;
  margin-bottom: 12px;
  text-wrap: balance;
}

.demo-content p {
  font-size: 1.0625rem;
  color: var(--text-secondary);
  max-width: 50ch;
  margin-inline: auto;
  text-wrap: pretty;
}

.demo-hint {
  margin-top: 32px;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-size: 0.8125rem;
  color: var(--text-dim);
  padding: 8px 16px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 100px;
}

.demo-hint svg {
  width: 14px;
  height: 14px;
  stroke: var(--accent);
  stroke-width: 2;
  fill: none;
}

/* ============================================================
   RESPONSIVE
   ============================================================ */
@media (max-width: 580px) {
  .app-search { display: none; }
  .notif-dropdown { width: calc(100vw - 16px); right: -8px; }
}
</style>
</head>
<body>

<!-- ── APP HEADER ── -->
<header class="app-header">
  <div class="app-logo">UI<span>.</span>Vault</div>
  <div class="search-wrapper">
    <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    <input class="app-search" type="search" placeholder="Search..." aria-label="Search">
  </div>
  <div class="header-actions">
    <div class="bell-wrapper">
      <button class="bell-btn" id="bellBtn" aria-label="Notifications" aria-expanded="false">
        <svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
      </button>
      <span class="bell-badge" id="bellBadge">5</span>

      <!-- ── NOTIFICATION DROPDOWN ── -->
      <div class="notif-dropdown" id="notifDropdown" data-open="false" role="dialog" aria-label="Notifications">
        <div class="notif-header">
          <h2>Notifications</h2>
          <button class="mark-all-btn" id="markAllBtn">Mark all read</button>
        </div>

        <div class="notif-tabs" role="tablist">
          <button class="notif-tab" data-tab="all" data-active="true" role="tab" aria-selected="true">All</button>
          <button class="notif-tab" data-tab="unread" role="tab" aria-selected="false">Unread</button>
          <button class="notif-tab" data-tab="mentions" role="tab" aria-selected="false">Mentions</button>
          <div class="tab-indicator" id="tabIndicator"></div>
        </div>

        <div class="notif-list" id="notifList">
          <!-- Today -->
          <div class="notif-group-header">Today</div>

          <div class="notif-item" data-unread="true" data-type="comment" data-tab-match="all,unread">
            <div class="notif-avatar" style="background:linear-gradient(145deg,#6d28d9,#a78bfa)">SC
              <span class="notif-avatar-badge"><svg viewBox="0 0 16 16" stroke="var(--type-comment)"><path d="M2 4h12v7H5l-3 3V4z"/></svg></span>
            </div>
            <div class="notif-content">
              <div class="notif-title"><strong>Sarah Chen</strong> commented on your post</div>
              <div class="notif-time">2 min ago</div>
            </div>
            <div class="notif-dot"></div>
          </div>

          <div class="notif-item" data-unread="true" data-type="mention" data-tab-match="all,unread,mentions">
            <div class="notif-avatar" style="background:linear-gradient(145deg,#2563eb,#60a5fa)">JD
              <span class="notif-avatar-badge"><svg viewBox="0 0 16 16" stroke="var(--type-mention)"><path d="M8 4v4l2 2"/><circle cx="8" cy="8" r="6"/></svg></span>
            </div>
            <div class="notif-content">
              <div class="notif-title"><strong>@john</strong> mentioned you in <strong>#general</strong></div>
              <div class="notif-time">15 min ago</div>
            </div>
            <div class="notif-dot"></div>
          </div>

          <div class="notif-item" data-unread="true" data-type="system" data-tab-match="all,unread">
            <div class="notif-avatar" style="background:linear-gradient(145deg,#374151,#6b7280)">SY
              <span class="notif-avatar-badge"><svg viewBox="0 0 16 16" stroke="var(--type-system)"><circle cx="8" cy="8" r="6"/><line x1="8" y1="5" x2="8" y2="8"/><circle cx="8" cy="11" r="0.5" fill="var(--type-system)"/></svg></span>
            </div>
            <div class="notif-content">
              <div class="notif-title">System maintenance scheduled for tonight</div>
              <div class="notif-time">1 hour ago</div>
            </div>
            <div class="notif-dot"></div>
          </div>

          <!-- Yesterday -->
          <div class="notif-group-header">Yesterday</div>

          <div class="notif-item" data-unread="true" data-type="invite" data-tab-match="all,unread">
            <div class="notif-avatar" style="background:linear-gradient(145deg,#059669,#34d399)">DT
              <span class="notif-avatar-badge"><svg viewBox="0 0 16 16" stroke="var(--type-invite)"><path d="M4 8h8M8 4v8"/></svg></span>
            </div>
            <div class="notif-content">
              <div class="notif-title">Team invite from <strong>Design Team</strong></div>
              <div class="notif-time">Yesterday at 4:30 PM</div>
            </div>
            <div class="notif-dot"></div>
          </div>

          <div class="notif-item" data-unread="true" data-type="comment" data-tab-match="all,unread">
            <div class="notif-avatar" style="background:linear-gradient(145deg,#0891b2,#22d3ee)">AR
              <span class="notif-avatar-badge"><svg viewBox="0 0 16 16" stroke="var(--type-comment)"><path d="M2 4h12v7H5l-3 3V4z"/></svg></span>
            </div>
            <div class="notif-content">
              <div class="notif-title"><strong>Alex</strong> reviewed your pull request</div>
              <div class="notif-time">Yesterday at 2:15 PM</div>
            </div>
            <div class="notif-dot"></div>
          </div>

          <div class="notif-item" data-unread="false" data-type="system" data-tab-match="all">
            <div class="notif-avatar" style="background:linear-gradient(145deg,#374151,#6b7280)">SY
              <span class="notif-avatar-badge"><svg viewBox="0 0 16 16" stroke="var(--type-system)"><circle cx="8" cy="8" r="6"/><line x1="8" y1="5" x2="8" y2="8"/><circle cx="8" cy="11" r="0.5" fill="var(--type-system)"/></svg></span>
            </div>
            <div class="notif-content">
              <div class="notif-title">Weekly report is ready</div>
              <div class="notif-time">Yesterday at 9:00 AM</div>
            </div>
            <div class="notif-dot"></div>
          </div>

          <div class="notif-item" data-unread="false" data-type="social" data-tab-match="all">
            <div class="notif-avatar" style="background:linear-gradient(145deg,#db2777,#f472b6)">MG
              <span class="notif-avatar-badge"><svg viewBox="0 0 16 16" stroke="var(--type-social)"><path d="M8 3C5.5 1 2 3 2 6c0 4 6 7 6 7s6-3 6-7c0-3-3.5-5-6-3z"/></svg></span>
            </div>
            <div class="notif-content">
              <div class="notif-title">New follower: <strong>Maria Garcia</strong></div>
              <div class="notif-time">Yesterday at 7:20 AM</div>
            </div>
            <div class="notif-dot"></div>
          </div>

          <!-- Earlier -->
          <div class="notif-group-header">Earlier</div>

          <div class="notif-item" data-unread="false" data-type="billing" data-tab-match="all">
            <div class="notif-avatar" style="background:linear-gradient(145deg,#b45309,#f59e0b)">BI
              <span class="notif-avatar-badge"><svg viewBox="0 0 16 16" stroke="var(--type-billing)"><rect x="3" y="4" width="10" height="8" rx="1"/><line x1="3" y1="7" x2="13" y2="7"/></svg></span>
            </div>
            <div class="notif-content">
              <div class="notif-title">Your subscription renews tomorrow</div>
              <div class="notif-time">2 days ago</div>
            </div>
            <div class="notif-dot"></div>
          </div>

          <div class="notif-item" data-unread="false" data-type="social" data-tab-match="all">
            <div class="notif-avatar" style="background:linear-gradient(145deg,#7c3aed,#a78bfa)">EL
              <span class="notif-avatar-badge"><svg viewBox="0 0 16 16" stroke="var(--type-social)"><path d="M8 3C5.5 1 2 3 2 6c0 4 6 7 6 7s6-3 6-7c0-3-3.5-5-6-3z"/></svg></span>
            </div>
            <div class="notif-content">
              <div class="notif-title"><strong>Emily</strong> liked your comment</div>
              <div class="notif-time">3 days ago</div>
            </div>
            <div class="notif-dot"></div>
          </div>

          <div class="notif-item" data-unread="false" data-type="alert" data-tab-match="all">
            <div class="notif-avatar" style="background:linear-gradient(145deg,#b91c1c,#ef4444)">SE
              <span class="notif-avatar-badge"><svg viewBox="0 0 16 16" stroke="var(--type-alert)"><path d="M8 2L1 14h14L8 2z"/><line x1="8" y1="7" x2="8" y2="10"/><circle cx="8" cy="12" r="0.5" fill="var(--type-alert)"/></svg></span>
            </div>
            <div class="notif-content">
              <div class="notif-title">Security alert: New login detected</div>
              <div class="notif-time">4 days ago</div>
            </div>
            <div class="notif-dot"></div>
          </div>
        </div>

        <!-- Empty state -->
        <div class="notif-empty" id="notifEmpty">
          <svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
          <div class="notif-empty-title">All caught up!</div>
          <div class="notif-empty-desc">No unread notifications.</div>
        </div>
      </div>
    </div>

    <div class="user-avatar">JD</div>
  </div>
</header>

<!-- ── DEMO CONTENT ── -->
<div class="demo-content">
  <h1>Notification Center</h1>
  <p>Bell icon with badge, dropdown panel with grouped notifications, tab filtering, swipe dismiss, and mark-all-read orchestration.</p>
  <div class="demo-hint">
    <svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
    Click the bell icon above to open
  </div>
</div>

<!-- GSAP -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Flip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/TextPlugin.min.js"></script>
<script>gsap.registerPlugin(ScrollTrigger, Flip, TextPlugin);</script>
<script src="../animations/gsap-utils.js"></script>
<script>
(function () {
  if (UV.prefersReducedMotion) { UV.addControlPanel(); return; }

  /* ── References ── */
  var bellBtn = document.getElementById('bellBtn');
  var bellBadge = document.getElementById('bellBadge');
  var dropdown = document.getElementById('notifDropdown');
  var markAllBtn = document.getElementById('markAllBtn');
  var notifList = document.getElementById('notifList');
  var notifEmpty = document.getElementById('notifEmpty');
  var tabBtns = document.querySelectorAll('.notif-tab');
  var tabIndicator = document.getElementById('tabIndicator');
  var isOpen = false;
  var currentTab = 'all';

  /* ── Set initial state ── */
  gsap.set(dropdown, { scaleY: 0, opacity: 0 });
  gsap.set('.notif-item', { x: 0, opacity: 1 });

  /* ── Bell wiggle (every 5s when unreads exist) ── */
  var bellWiggle;
  function startBellWiggle() {
    if (bellWiggle) return;
    bellWiggle = gsap.timeline({ repeat: -1, repeatDelay: 5 })
      .to(bellBtn.querySelector('svg'), { rotation: -8, duration: 0.08, ease: 'power2.inOut' })
      .to(bellBtn.querySelector('svg'), { rotation: 8, duration: 0.08, ease: 'power2.inOut' })
      .to(bellBtn.querySelector('svg'), { rotation: -5, duration: 0.06, ease: 'power2.inOut' })
      .to(bellBtn.querySelector('svg'), { rotation: 0, duration: 0.12, ease: 'power2.out' });
  }

  function stopBellWiggle() {
    if (bellWiggle) { bellWiggle.kill(); bellWiggle = null; }
    gsap.set(bellBtn.querySelector('svg'), { rotation: 0 });
  }

  function getUnreadCount() {
    return notifList.querySelectorAll('.notif-item[data-unread="true"]').length;
  }

  function updateBadge() {
    var count = getUnreadCount();
    bellBadge.textContent = String(count);
    if (count > 0) {
      gsap.to(bellBadge, { scale: 1, opacity: 1, duration: 0.2, ease: 'back.out(2)' });
      startBellWiggle();
    } else {
      gsap.to(bellBadge, { scale: 0, opacity: 0, duration: 0.2, ease: 'power2.in' });
      stopBellWiggle();
    }
  }

  startBellWiggle();

  /* ── Tab indicator positioning ── */
  function positionIndicator(tabEl, animate) {
    var rect = tabEl.getBoundingClientRect();
    var parentRect = tabEl.parentElement.getBoundingClientRect();
    var props = {
      left: rect.left - parentRect.left,
      width: rect.width,
    };
    if (animate) {
      gsap.to(tabIndicator, { ...props, duration: 0.3, ease: 'power2.inOut' });
    } else {
      gsap.set(tabIndicator, props);
    }
  }

  /* Init indicator on first active tab */
  positionIndicator(document.querySelector('.notif-tab[data-active="true"]'), false);

  /* ── Open/Close dropdown ── */
  function openDropdown() {
    if (isOpen) return;
    isOpen = true;
    bellBtn.setAttribute('aria-expanded', 'true');
    dropdown.setAttribute('data-open', 'true');

    var items = getVisibleItems();
    gsap.set(items, { opacity: 0, y: 10 });

    var tl = gsap.timeline();
    tl.to(dropdown, { scaleY: 1, opacity: 1, duration: 0.3, ease: 'power3.out' });
    tl.to(items, { opacity: 1, y: 0, duration: 0.25, stagger: 0.03, ease: 'power2.out' }, '-=0.1');

    positionIndicator(document.querySelector('.notif-tab[data-active="true"]'), false);
  }

  function closeDropdown() {
    if (!isOpen) return;
    isOpen = false;
    bellBtn.setAttribute('aria-expanded', 'false');

    gsap.to(dropdown, {
      scaleY: 0, opacity: 0, duration: 0.2, ease: 'power2.in',
      onComplete: function () { dropdown.setAttribute('data-open', 'false'); }
    });
  }

  bellBtn.addEventListener('click', function (e) {
    e.stopPropagation();
    if (isOpen) closeDropdown(); else openDropdown();
  });

  /* Close on outside click */
  document.addEventListener('click', function (e) {
    if (isOpen && !dropdown.contains(e.target) && e.target !== bellBtn) {
      closeDropdown();
    }
  });

  /* Close on Escape */
  document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape' && isOpen) closeDropdown();
  });

  /* ── Prevent dropdown from closing when clicking inside ── */
  dropdown.addEventListener('click', function (e) { e.stopPropagation(); });

  /* ── Get visible items for current tab ── */
  function getVisibleItems() {
    var items = notifList.querySelectorAll('.notif-item');
    var visible = [];
    items.forEach(function (item) {
      var match = item.getAttribute('data-tab-match') || 'all';
      var show = false;
      if (currentTab === 'all') show = match.indexOf('all') !== -1;
      else if (currentTab === 'unread') show = match.indexOf('unread') !== -1 && item.getAttribute('data-unread') === 'true';
      else if (currentTab === 'mentions') show = match.indexOf('mentions') !== -1;
      if (show) visible.push(item);
    });
    return visible;
  }

  /* ── Tab switching ── */
  function filterByTab(tab) {
    if (tab === currentTab) return;
    currentTab = tab;

    tabBtns.forEach(function (btn) {
      var isActive = btn.getAttribute('data-tab') === tab;
      btn.setAttribute('data-active', isActive ? 'true' : 'false');
      btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
      if (isActive) positionIndicator(btn, true);
    });

    var allItems = notifList.querySelectorAll('.notif-item');
    var allHeaders = notifList.querySelectorAll('.notif-group-header');
    var hasVisible = false;

    /* Cross-fade content */
    gsap.to(allItems, {
      opacity: 0, y: -5, duration: 0.15, ease: 'power2.in',
      onComplete: function () {
        allItems.forEach(function (item) {
          var match = item.getAttribute('data-tab-match') || 'all';
          var show = false;
          if (tab === 'all') show = match.indexOf('all') !== -1;
          else if (tab === 'unread') show = match.indexOf('unread') !== -1 && item.getAttribute('data-unread') === 'true';
          else if (tab === 'mentions') show = match.indexOf('mentions') !== -1;
          item.style.display = show ? 'flex' : 'none';
          if (show) hasVisible = true;
        });

        /* Show/hide group headers based on visible children */
        allHeaders.forEach(function (header) {
          var next = header.nextElementSibling;
          var hasChild = false;
          while (next && !next.classList.contains('notif-group-header')) {
            if (next.classList.contains('notif-item') && next.style.display !== 'none') hasChild = true;
            next = next.nextElementSibling;
          }
          header.style.display = hasChild ? 'block' : 'none';
        });

        notifEmpty.classList.toggle('visible', !hasVisible);

        var visibleItems = notifList.querySelectorAll('.notif-item[style*="display: flex"], .notif-item:not([style*="display: none"])');
        var toAnimate = [];
        visibleItems.forEach(function (el) { if (el.style.display !== 'none') toAnimate.push(el); });

        gsap.fromTo(toAnimate,
          { opacity: 0, y: 10 },
          { opacity: 1, y: 0, duration: 0.25, stagger: 0.03, ease: 'power2.out' }
        );
      }
    });
  }

  tabBtns.forEach(function (btn) {
    btn.addEventListener('click', function () {
      filterByTab(btn.getAttribute('data-tab'));
    });
  });

  /* ── Mark all read ── */
  markAllBtn.addEventListener('click', function () {
    var dots = notifList.querySelectorAll('.notif-item[data-unread="true"] .notif-dot');
    var unreadItems = notifList.querySelectorAll('.notif-item[data-unread="true"]');

    if (dots.length === 0) return;

    gsap.to(dots, {
      scale: 0, duration: 0.2, stagger: 0.03, ease: 'power2.in',
      onComplete: function () {
        unreadItems.forEach(function (item) {
          item.setAttribute('data-unread', 'false');
        });
        updateBadge();
        /* If on unread tab, re-filter */
        if (currentTab === 'unread') filterByTab('unread');
      }
    });

    /* Fade background change */
    gsap.to(unreadItems, {
      backgroundColor: 'transparent', duration: 0.3, stagger: 0.02, ease: 'power2.out'
    });
  });

  /* ── Swipe dismiss individual notifications ── */
  var startX = 0;
  var currentItem = null;
  var isDragging = false;

  notifList.addEventListener('pointerdown', function (e) {
    var item = e.target.closest('.notif-item');
    if (!item) return;
    startX = e.clientX;
    currentItem = item;
    isDragging = false;
  });

  notifList.addEventListener('pointermove', function (e) {
    if (!currentItem) return;
    var dx = e.clientX - startX;
    if (Math.abs(dx) > 10) isDragging = true;
    if (isDragging && dx > 0) {
      gsap.set(currentItem, { x: dx, opacity: 1 - (dx / 400) });
    }
  });

  notifList.addEventListener('pointerup', function (e) {
    if (!currentItem) return;
    var dx = e.clientX - startX;
    var item = currentItem;
    currentItem = null;

    if (dx > 120) {
      /* Dismiss */
      gsap.to(item, {
        x: 400, opacity: 0, duration: 0.25, ease: 'power2.in',
        onComplete: function () {
          gsap.to(item, {
            height: 0, paddingTop: 0, paddingBottom: 0, marginTop: 0, marginBottom: 0,
            duration: 0.2, ease: 'power2.inOut',
            onComplete: function () {
              item.remove();
              updateBadge();
            }
          });
        }
      });
    } else {
      /* Snap back */
      gsap.to(item, { x: 0, opacity: 1, duration: 0.3, ease: 'power2.out' });
    }
  });

  /* ── Notification item hover ── */
  notifList.addEventListener('mouseenter', function (e) {
    var item = e.target.closest('.notif-item');
    if (!item) return;
    gsap.to(item, { backgroundColor: 'rgba(255,255,255,0.03)', duration: 0.15, ease: 'power2.out' });
  }, true);

  notifList.addEventListener('mouseleave', function (e) {
    var item = e.target.closest('.notif-item');
    if (!item) return;
    var isUnread = item.getAttribute('data-unread') === 'true';
    gsap.to(item, {
      backgroundColor: isUnread ? 'rgba(59,130,246,0.06)' : 'transparent',
      duration: 0.15, ease: 'power2.out'
    });
  }, true);

  /* ── Bell button hover ── */
  bellBtn.addEventListener('mouseenter', function () {
    gsap.to(bellBtn, { backgroundColor: 'rgba(255,255,255,0.06)', borderColor: 'rgba(255,255,255,0.1)', duration: 0.2, ease: 'power2.out' });
  });
  bellBtn.addEventListener('mouseleave', function () {
    gsap.to(bellBtn, { backgroundColor: 'transparent', borderColor: 'transparent', duration: 0.2, ease: 'power2.out' });
  });

  /* ── Mark all button hover ── */
  markAllBtn.addEventListener('mouseenter', function () {
    gsap.to(markAllBtn, { backgroundColor: 'rgba(245,158,11,0.1)', duration: 0.15, ease: 'power2.out' });
  });
  markAllBtn.addEventListener('mouseleave', function () {
    gsap.to(markAllBtn, { backgroundColor: 'transparent', duration: 0.15, ease: 'power2.out' });
  });

  /* ── Page entrance ── */
  var pageTl = gsap.timeline({ defaults: { ease: 'power3.out' } });
  pageTl.from('.app-header', { opacity: 0, y: -20, duration: 0.5 });
  pageTl.from('.demo-content h1', { opacity: 0, y: 20, duration: 0.5 }, '-=0.2');
  pageTl.from('.demo-content p', { opacity: 0, y: 15, duration: 0.4 }, '-=0.2');
  pageTl.from('.demo-hint', { opacity: 0, y: 10, duration: 0.35 }, '-=0.15');

  /* ── Control Panel ── */
  UV.addControlPanel();
})();
</script>
</body>
</html>
