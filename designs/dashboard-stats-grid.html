<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stats Dashboard</title>
<style>
/* ============================================================
   DESIGN TOKENS
   Dark dashboard. DataCamp/Resolution-inspired KPI anatomy.
   ============================================================ */
:root {
  --bg: #0B0C10;
  --surface: #141519;
  --surface-raised: #1A1B21;
  --accent: #818CF8;
  --accent-dim: rgba(129, 140, 248, 0.12);
  --text: #E8E6E3;
  --text-secondary: #9B9A97;
  --text-tertiary: #5F5E5B;
  --border: rgba(255, 255, 255, 0.07);
  --radius: 12px;
  --radius-sm: 8px;
  --font: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --green: #22C55E;
  --green-dim: rgba(34, 197, 94, 0.12);
  --red: #EF4444;
  --red-dim: rgba(239, 68, 68, 0.12);
  --blue: #3B82F6;
  --blue-dim: rgba(59, 130, 246, 0.12);
  --amber: #F59E0B;
  --amber-dim: rgba(245, 158, 11, 0.12);
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.2), 0 1px 2px rgba(0,0,0,0.15);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.25), 0 2px 4px rgba(0,0,0,0.15);
}

/* ============================================================
   RESET & BASE
   ============================================================ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  line-height: 1.5;
  min-height: 100dvh;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  overflow-x: hidden;
}

/* ============================================================
   TOP BAR
   ============================================================ */
.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 32px;
  border-bottom: 1px solid var(--border);
  background: var(--surface);
}

.topbar-left { display: flex; align-items: center; gap: 16px; }
.topbar-title { font-size: 1.375rem; font-weight: 800; letter-spacing: -0.03em; }

.topbar-right { display: flex; align-items: center; gap: 12px; }

.select-period {
  padding: 8px 14px;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  font-family: var(--font);
  font-size: 0.8125rem;
  font-weight: 500;
  cursor: pointer;
  appearance: none;
  outline: none;
  background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%239B9A97' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 32px;
}
.select-period:focus-visible { outline: 2px solid var(--accent); outline-offset: 1px; }

.btn-refresh {
  width: 40px;
  height: 40px;
  border-radius: var(--radius-sm);
  background: var(--surface-raised);
  border: 1px solid var(--border);
  cursor: pointer;
  display: grid;
  place-items: center;
  color: var(--text-secondary);
}
.btn-refresh svg { width: 18px; height: 18px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

/* ============================================================
   CONTENT
   ============================================================ */
.content { padding: 24px 32px 48px; max-width: 1280px; margin: 0 auto; }

/* ============================================================
   STAT CARDS
   ============================================================ */
.stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }

.stat-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  box-shadow: var(--shadow-sm);
  position: relative;
  overflow: hidden;
}

.stat-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }

.stat-icon {
  width: 40px;
  height: 40px;
  border-radius: var(--radius-sm);
  display: grid;
  place-items: center;
}
.stat-icon svg { width: 20px; height: 20px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
.stat-icon.green { background: var(--green-dim); color: var(--green); }
.stat-icon.blue { background: var(--blue-dim); color: var(--blue); }
.stat-icon.accent { background: var(--accent-dim); color: var(--accent); }
.stat-icon.red { background: var(--red-dim); color: var(--red); }

.stat-sparkline { flex-shrink: 0; }
.stat-sparkline svg { display: block; }

.stat-value { font-size: 1.75rem; font-weight: 800; letter-spacing: -0.04em; line-height: 1.1; margin-bottom: 6px; font-variant-numeric: tabular-nums; }

.stat-footer { display: flex; align-items: center; gap: 8px; }

.stat-trend {
  font-size: 0.75rem;
  font-weight: 700;
  display: inline-flex;
  align-items: center;
  gap: 3px;
  padding: 3px 8px;
  border-radius: 20px;
}
.stat-trend.up { color: var(--green); background: var(--green-dim); }
.stat-trend.down { color: var(--red); background: var(--red-dim); }

.stat-period { font-size: 0.75rem; color: var(--text-tertiary); }

/* ============================================================
   REVENUE CHART
   ============================================================ */
.chart-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  box-shadow: var(--shadow-sm);
  margin-bottom: 24px;
}

.chart-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
.chart-title { font-size: 1rem; font-weight: 700; letter-spacing: -0.01em; }
.chart-subtitle { font-size: 0.75rem; color: var(--text-tertiary); margin-top: 2px; }

.chart-area { display: flex; align-items: flex-end; gap: 0; height: 220px; position: relative; }

.chart-y-axis {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 100%;
  padding-right: 16px;
  flex-shrink: 0;
}
.chart-y-label { font-size: 0.6875rem; color: var(--text-tertiary); font-variant-numeric: tabular-nums; text-align: right; }

.chart-bars { display: flex; align-items: flex-end; gap: 12px; flex: 1; height: 100%; }

.bar-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 8px; height: 100%; justify-content: flex-end; position: relative; }

.bar {
  width: 100%;
  max-width: 48px;
  border-radius: 6px 6px 3px 3px;
  background: linear-gradient(180deg, var(--accent), rgba(129, 140, 248, 0.6));
  position: relative;
  transform-origin: bottom center;
  min-height: 4px;
}

.bar-tooltip {
  position: absolute;
  top: -32px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--text);
  color: var(--bg);
  font-size: 0.6875rem;
  font-weight: 700;
  padding: 4px 10px;
  border-radius: 6px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
}
.bar-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 5px solid transparent;
  border-top-color: var(--text);
}

.bar-day { font-size: 0.6875rem; color: var(--text-tertiary); font-weight: 500; flex-shrink: 0; }

/* ============================================================
   BOTTOM ROW
   ============================================================ */
.bottom-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  box-shadow: var(--shadow-sm);
}

.card-title { font-size: 1rem; font-weight: 700; letter-spacing: -0.01em; margin-bottom: 16px; }

/* ── Activity Feed ── */
.activity-list { display: flex; flex-direction: column; gap: 0; }

.activity-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 10px 0;
  border-bottom: 1px solid var(--border);
}
.activity-item:last-child { border-bottom: none; }

.activity-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; margin-top: 6px; }
.activity-dot.green { background: var(--green); }
.activity-dot.blue { background: var(--blue); }
.activity-dot.red { background: var(--red); }
.activity-dot.accent { background: var(--accent); }

.activity-text { font-size: 0.8125rem; color: var(--text); line-height: 1.45; flex: 1; }
.activity-time { font-size: 0.6875rem; color: var(--text-tertiary); flex-shrink: 0; white-space: nowrap; }

/* ── Top Products ── */
.product-list { display: flex; flex-direction: column; gap: 14px; }

.product-item { display: flex; align-items: center; gap: 12px; }
.product-rank { font-size: 0.75rem; font-weight: 700; color: var(--text-tertiary); width: 20px; text-align: center; }
.product-info { flex: 1; min-width: 0; }
.product-name { font-size: 0.8125rem; font-weight: 600; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.product-rev { font-size: 0.6875rem; color: var(--text-tertiary); margin-top: 1px; font-variant-numeric: tabular-nums; }
.product-bar-wrap { width: 100px; height: 6px; border-radius: 3px; background: var(--surface-raised); overflow: hidden; flex-shrink: 0; }
.product-bar { height: 100%; border-radius: 3px; background: var(--accent); transform-origin: left center; }

/* ── Traffic Sources ── */
.traffic-card { margin-top: 20px; }

.traffic-bar-wrap { display: flex; height: 10px; border-radius: 5px; overflow: hidden; gap: 2px; margin-bottom: 14px; }
.traffic-segment { height: 100%; transform-origin: left center; }
.traffic-segment.direct { background: var(--accent); }
.traffic-segment.organic { background: var(--green); }
.traffic-segment.referral { background: var(--blue); }
.traffic-segment.social { background: var(--amber); }

.traffic-legend { display: flex; flex-wrap: wrap; gap: 16px; }
.legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; color: var(--text-secondary); }
.legend-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.legend-dot.accent { background: var(--accent); }
.legend-dot.green { background: var(--green); }
.legend-dot.blue { background: var(--blue); }
.legend-dot.amber { background: var(--amber); }

/* ============================================================
   RESPONSIVE
   ============================================================ */
@media (max-width: 1024px) {
  .bottom-grid { grid-template-columns: 1fr; }
}
@media (max-width: 860px) {
  .stat-grid { grid-template-columns: repeat(2, 1fr); }
  .content { padding: 20px 16px 40px; }
  .topbar { padding: 16px 20px; }
}
@media (max-width: 520px) {
  .stat-grid { grid-template-columns: 1fr; }
  .topbar-title { font-size: 1.125rem; }
}
</style>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

<!-- ============================================================
     TOP BAR
     ============================================================ -->
<header class="topbar">
  <div class="topbar-left">
    <h1 class="topbar-title">Dashboard</h1>
  </div>
  <div class="topbar-right">
    <select class="select-period" aria-label="Time period">
      <option>Last 7 days</option>
      <option>Last 30 days</option>
      <option>Last 90 days</option>
    </select>
    <button class="btn-refresh" id="refreshBtn" aria-label="Refresh data">
      <svg viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/></svg>
    </button>
  </div>
</header>

<main class="content">

  <!-- ============================================================
       STAT CARDS
       ============================================================ -->
  <section class="stat-grid">
    <!-- Revenue -->
    <div class="stat-card" id="card-revenue">
      <div class="stat-header">
        <div class="stat-icon green">
          <svg viewBox="0 0 24 24"><path d="M12 1v22M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
        </div>
        <div class="stat-sparkline">
          <svg width="64" height="28" viewBox="0 0 64 28" fill="none">
            <path d="M2 22 L12 18 L22 20 L32 14 L42 16 L52 8 L62 4" stroke="rgba(34,197,94,0.5)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            <path d="M2 22 L12 18 L22 20 L32 14 L42 16 L52 8 L62 4 L62 28 L2 28Z" fill="rgba(34,197,94,0.08)"/>
          </svg>
        </div>
      </div>
      <div class="stat-value" data-target="48259" data-prefix="$" data-suffix="">$0</div>
      <div class="stat-footer">
        <span class="stat-trend up">&#9650; +12.5%</span>
        <span class="stat-period">vs last week</span>
      </div>
    </div>

    <!-- Users -->
    <div class="stat-card" id="card-users">
      <div class="stat-header">
        <div class="stat-icon blue">
          <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 21v-1a6 6 0 0112 0v1"/><path d="M16 3.13a4 4 0 010 7.75M21 21v-1a4 4 0 00-3-3.85"/></svg>
        </div>
        <div class="stat-sparkline">
          <svg width="52" height="28" viewBox="0 0 52 28" fill="none">
            <rect x="2" y="18" width="8" height="8" rx="2" fill="rgba(59,130,246,0.2)"/>
            <rect x="14" y="14" width="8" height="12" rx="2" fill="rgba(59,130,246,0.3)"/>
            <rect x="26" y="10" width="8" height="16" rx="2" fill="rgba(59,130,246,0.4)"/>
            <rect x="38" y="4" width="8" height="22" rx="2" fill="rgba(59,130,246,0.55)"/>
          </svg>
        </div>
      </div>
      <div class="stat-value" data-target="12543" data-prefix="" data-suffix="">0</div>
      <div class="stat-footer">
        <span class="stat-trend up">&#9650; +8.2%</span>
        <span class="stat-period">vs last week</span>
      </div>
    </div>

    <!-- Orders -->
    <div class="stat-card" id="card-orders">
      <div class="stat-header">
        <div class="stat-icon accent">
          <svg viewBox="0 0 24 24"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"/></svg>
        </div>
        <div class="stat-sparkline">
          <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
            <circle cx="16" cy="16" r="12" stroke="rgba(129,140,248,0.15)" stroke-width="4" fill="none"/>
            <path d="M16 4 A12 12 0 1 1 5.07 22" stroke="rgba(129,140,248,0.55)" stroke-width="4" stroke-linecap="round" fill="none"/>
          </svg>
        </div>
      </div>
      <div class="stat-value" data-target="1234" data-prefix="" data-suffix="">0</div>
      <div class="stat-footer">
        <span class="stat-trend up">&#9650; +23.1%</span>
        <span class="stat-period">vs last week</span>
      </div>
    </div>

    <!-- Growth -->
    <div class="stat-card" id="card-growth">
      <div class="stat-header">
        <div class="stat-icon red">
          <svg viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
        </div>
        <div class="stat-sparkline">
          <svg width="64" height="28" viewBox="0 0 64 28" fill="none">
            <path d="M2 6 L12 8 L22 5 L32 12 L42 10 L52 18 L62 22" stroke="rgba(239,68,68,0.5)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            <path d="M2 6 L12 8 L22 5 L32 12 L42 10 L52 18 L62 22 L62 28 L2 28Z" fill="rgba(239,68,68,0.08)"/>
          </svg>
        </div>
      </div>
      <div class="stat-value" data-target="18.2" data-prefix="" data-suffix="%" data-decimal="1">0%</div>
      <div class="stat-footer">
        <span class="stat-trend down">&#9660; -2.1%</span>
        <span class="stat-period">vs last week</span>
      </div>
    </div>
  </section>

  <!-- ============================================================
       REVENUE CHART
       ============================================================ -->
  <section class="chart-card" id="chartCard">
    <div class="chart-header">
      <div>
        <div class="chart-title">Revenue Overview</div>
        <div class="chart-subtitle">Last 7 days</div>
      </div>
    </div>
    <div class="chart-area">
      <div class="chart-y-axis">
        <span class="chart-y-label">$15K</span>
        <span class="chart-y-label">$10K</span>
        <span class="chart-y-label">$5K</span>
        <span class="chart-y-label">$0</span>
      </div>
      <div class="chart-bars">
        <div class="bar-col"><div class="bar" data-height="60%" style="height:0"><div class="bar-tooltip">$9,200</div></div><span class="bar-day">Mon</span></div>
        <div class="bar-col"><div class="bar" data-height="45%" style="height:0"><div class="bar-tooltip">$6,750</div></div><span class="bar-day">Tue</span></div>
        <div class="bar-col"><div class="bar" data-height="75%" style="height:0"><div class="bar-tooltip">$11,280</div></div><span class="bar-day">Wed</span></div>
        <div class="bar-col"><div class="bar" data-height="55%" style="height:0"><div class="bar-tooltip">$8,340</div></div><span class="bar-day">Thu</span></div>
        <div class="bar-col"><div class="bar" data-height="90%" style="height:0"><div class="bar-tooltip">$13,500</div></div><span class="bar-day">Fri</span></div>
        <div class="bar-col"><div class="bar" data-height="80%" style="height:0"><div class="bar-tooltip">$12,100</div></div><span class="bar-day">Sat</span></div>
        <div class="bar-col"><div class="bar" data-height="70%" style="height:0"><div class="bar-tooltip">$10,540</div></div><span class="bar-day">Sun</span></div>
      </div>
    </div>
  </section>

  <!-- ============================================================
       BOTTOM ROW
       ============================================================ -->
  <section class="bottom-grid">
    <!-- Activity Feed -->
    <div class="card" id="activityCard">
      <div class="card-title">Recent Activity</div>
      <div class="activity-list">
        <div class="activity-item"><div class="activity-dot green"></div><div class="activity-text">New order #1234 from John Smith</div><div class="activity-time">2 min ago</div></div>
        <div class="activity-item"><div class="activity-dot blue"></div><div class="activity-text">User sarah@example.com signed up</div><div class="activity-time">15 min ago</div></div>
        <div class="activity-item"><div class="activity-dot red"></div><div class="activity-text">Refund processed for order #1198</div><div class="activity-time">1 hour ago</div></div>
        <div class="activity-item"><div class="activity-dot accent"></div><div class="activity-text">5-star review from Maria Garcia</div><div class="activity-time">2 hours ago</div></div>
        <div class="activity-item"><div class="activity-dot green"></div><div class="activity-text">New order #1233 from Alex Johnson</div><div class="activity-time">3 hours ago</div></div>
        <div class="activity-item"><div class="activity-dot blue"></div><div class="activity-text">User mike@example.com signed up</div><div class="activity-time">5 hours ago</div></div>
        <div class="activity-item"><div class="activity-dot red"></div><div class="activity-text">Payment failed for order #1230</div><div class="activity-time">6 hours ago</div></div>
        <div class="activity-item"><div class="activity-dot accent"></div><div class="activity-text">Team member invited: Emily Davis</div><div class="activity-time">8 hours ago</div></div>
      </div>
    </div>

    <!-- Right column: Products + Traffic -->
    <div>
      <!-- Top Products -->
      <div class="card" id="productsCard" style="margin-bottom: 20px;">
        <div class="card-title">Top Products</div>
        <div class="product-list">
          <div class="product-item">
            <span class="product-rank">1</span>
            <div class="product-info"><div class="product-name">Wireless Headphones</div><div class="product-rev">$12,450</div></div>
            <div class="product-bar-wrap"><div class="product-bar" data-width="100%"></div></div>
          </div>
          <div class="product-item">
            <span class="product-rank">2</span>
            <div class="product-info"><div class="product-name">Smart Watch Pro</div><div class="product-rev">$9,820</div></div>
            <div class="product-bar-wrap"><div class="product-bar" data-width="79%"></div></div>
          </div>
          <div class="product-item">
            <span class="product-rank">3</span>
            <div class="product-info"><div class="product-name">Laptop Stand</div><div class="product-rev">$7,340</div></div>
            <div class="product-bar-wrap"><div class="product-bar" data-width="59%"></div></div>
          </div>
          <div class="product-item">
            <span class="product-rank">4</span>
            <div class="product-info"><div class="product-name">USB-C Hub</div><div class="product-rev">$5,890</div></div>
            <div class="product-bar-wrap"><div class="product-bar" data-width="47%"></div></div>
          </div>
          <div class="product-item">
            <span class="product-rank">5</span>
            <div class="product-info"><div class="product-name">Mechanical Keyboard</div><div class="product-rev">$4,120</div></div>
            <div class="product-bar-wrap"><div class="product-bar" data-width="33%"></div></div>
          </div>
        </div>
      </div>

      <!-- Traffic Sources -->
      <div class="card" id="trafficCard">
        <div class="card-title">Traffic Sources</div>
        <div class="traffic-bar-wrap">
          <div class="traffic-segment direct" data-width="40%" style="width:0"></div>
          <div class="traffic-segment organic" data-width="30%" style="width:0"></div>
          <div class="traffic-segment referral" data-width="20%" style="width:0"></div>
          <div class="traffic-segment social" data-width="10%" style="width:0"></div>
        </div>
        <div class="traffic-legend">
          <div class="legend-item"><span class="legend-dot accent"></span>Direct 40%</div>
          <div class="legend-item"><span class="legend-dot green"></span>Organic 30%</div>
          <div class="legend-item"><span class="legend-dot blue"></span>Referral 20%</div>
          <div class="legend-item"><span class="legend-dot amber"></span>Social 10%</div>
        </div>
      </div>
    </div>
  </section>

</main>

<!-- GSAP -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Flip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/TextPlugin.min.js"></script>
<script src="../animations/gsap-utils.js"></script>
<script>
gsap.registerPlugin(ScrollTrigger, Flip, TextPlugin);

(function () {
  var reducedMotion = UV.prefersReducedMotion;

  /* ── Helpers ── */
  function countUp(el) {
    var target = parseFloat(el.getAttribute('data-target'));
    var prefix = el.getAttribute('data-prefix') || '';
    var suffix = el.getAttribute('data-suffix') || '';
    var decimal = el.getAttribute('data-decimal');
    var obj = { val: 0 };

    if (reducedMotion) {
      var display = decimal ? target.toFixed(parseInt(decimal)) : Math.round(target);
      el.textContent = prefix + Number(display).toLocaleString('en-US') + suffix;
      return;
    }

    gsap.to(obj, {
      val: target,
      duration: 1.4,
      ease: 'power2.out',
      snap: decimal ? undefined : { val: 1 },
      onUpdate: function () {
        var d = decimal ? obj.val.toFixed(parseInt(decimal)) : Math.round(obj.val);
        el.textContent = prefix + Number(d).toLocaleString('en-US') + suffix;
      }
    });
  }

  function animateBars() {
    document.querySelectorAll('.chart-bars .bar').forEach(function (bar, i) {
      var h = bar.getAttribute('data-height');
      if (reducedMotion) { bar.style.height = h; return; }
      gsap.to(bar, { height: h, duration: 0.6, delay: 0.3 + i * 0.06, ease: 'power2.out' });
    });
  }

  function animateProductBars() {
    document.querySelectorAll('.product-bar').forEach(function (bar, i) {
      var w = bar.getAttribute('data-width');
      if (reducedMotion) { bar.style.width = w; return; }
      gsap.fromTo(bar, { scaleX: 0 }, { scaleX: 1, duration: 0.5, delay: 0.1 + i * 0.08, ease: 'power2.out' });
      bar.style.width = w;
    });
  }

  function animateTraffic() {
    document.querySelectorAll('.traffic-segment').forEach(function (seg, i) {
      var w = seg.getAttribute('data-width');
      if (reducedMotion) { seg.style.width = w; return; }
      gsap.to(seg, { width: w, duration: 0.5, delay: 0.2 + i * 0.1, ease: 'power2.out' });
    });
  }

  function animateSparklines() {
    if (reducedMotion) return;
    document.querySelectorAll('.stat-sparkline').forEach(function (sp) {
      gsap.fromTo(sp, { clipPath: 'inset(0 100% 0 0)' }, { clipPath: 'inset(0 0% 0 0)', duration: 0.8, delay: 0.6, ease: 'power2.out' });
    });
  }

  function runAllAnimations() {
    /* Count up stat values */
    document.querySelectorAll('.stat-value').forEach(countUp);

    /* Stat card stagger entrance */
    if (!reducedMotion) {
      gsap.from('.stat-card', { y: 30, opacity: 0, duration: 0.5, stagger: 0.1, ease: 'back.out(1.4)' });
    }

    animateSparklines();
    animateBars();

    /* Activity items stagger */
    if (!reducedMotion) {
      gsap.from('.activity-item', { x: -20, opacity: 0, duration: 0.35, stagger: 0.05, delay: 0.4, ease: 'power2.out' });
    }

    animateProductBars();
    animateTraffic();
  }

  /* ── Page entrance timeline ── */
  if (!reducedMotion) {
    var tl = gsap.timeline({ defaults: { ease: 'power3.out' } });
    tl.from('.topbar', { opacity: 0, y: -20, duration: 0.4 });
    tl.add(function () { runAllAnimations(); }, '-=0.1');

    /* Chart card scroll reveal */
    UV.scrollReveal('#chartCard', { y: 30, duration: 0.5 });
    UV.scrollReveal('#activityCard', { y: 30, duration: 0.5 });
    UV.scrollReveal('#productsCard', { y: 30, duration: 0.5 });
    UV.scrollReveal('#trafficCard', { y: 30, duration: 0.5 });
  } else {
    runAllAnimations();
  }

  /* ── Stat card hover ── */
  if (!reducedMotion) {
    document.querySelectorAll('.stat-card').forEach(function (card) {
      card.addEventListener('mouseenter', function () {
        gsap.to(card, { y: -4, boxShadow: '0 8px 24px rgba(0,0,0,0.35), 0 2px 8px rgba(129,140,248,0.08)', duration: 0.25, ease: 'power2.out' });
      });
      card.addEventListener('mouseleave', function () {
        gsap.to(card, { y: 0, boxShadow: '0 1px 3px rgba(0,0,0,0.2), 0 1px 2px rgba(0,0,0,0.15)', duration: 0.25, ease: 'power2.out' });
      });
    });
  }

  /* ── Chart bar hover: brighten + tooltip ── */
  if (!reducedMotion) {
    document.querySelectorAll('.bar-col').forEach(function (col) {
      var bar = col.querySelector('.bar');
      var tooltip = col.querySelector('.bar-tooltip');
      col.addEventListener('mouseenter', function () {
        gsap.to(bar, { opacity: 1, scale: 1.04, duration: 0.2, ease: 'power2.out' });
        gsap.to(tooltip, { opacity: 1, y: -4, duration: 0.2, ease: 'power2.out' });
      });
      col.addEventListener('mouseleave', function () {
        gsap.to(bar, { opacity: 1, scale: 1, duration: 0.2, ease: 'power2.out' });
        gsap.to(tooltip, { opacity: 0, y: 0, duration: 0.15, ease: 'power2.in' });
      });
    });
  }

  /* ── Refresh button: spin + re-run counters ── */
  document.getElementById('refreshBtn').addEventListener('click', function () {
    var btn = this;
    if (!reducedMotion) {
      gsap.to(btn.querySelector('svg'), { rotation: '+=360', duration: 0.6, ease: 'power2.inOut' });
    }

    /* Reset and recount all values */
    document.querySelectorAll('.stat-value').forEach(function (el) {
      var prefix = el.getAttribute('data-prefix') || '';
      var suffix = el.getAttribute('data-suffix') || '';
      el.textContent = prefix + '0' + suffix;
      countUp(el);
    });

    /* Re-animate bars */
    document.querySelectorAll('.chart-bars .bar').forEach(function (bar) {
      if (!reducedMotion) {
        gsap.set(bar, { height: 0 });
      }
    });
    animateBars();
  });

  /* ── Button hover ── */
  if (!reducedMotion) {
    document.querySelectorAll('.btn-refresh').forEach(function (btn) {
      btn.addEventListener('mouseenter', function () { gsap.to(btn, { scale: 1.06, duration: 0.15, ease: 'power2.out' }); });
      btn.addEventListener('mouseleave', function () { gsap.to(btn, { scale: 1, duration: 0.15, ease: 'power2.out' }); });
    });
  }

  UV.addControlPanel();
})();
</script>
</body>
</html>
