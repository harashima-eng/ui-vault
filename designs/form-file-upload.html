<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>File Upload Dropzone</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

:root{
  --bg:#0B0D11;
  --surface:#13161C;
  --surface-raised:#1A1E26;
  --accent:#6C8EEF;
  --accent-dim:rgba(108,142,239,0.15);
  --accent-glow:rgba(108,142,239,0.25);
  --text:#E4E7ED;
  --text-secondary:#8B92A5;
  --text-tertiary:#555C6E;
  --border:rgba(255,255,255,0.08);
  --border-accent:rgba(108,142,239,0.5);
  --radius:16px;
  --radius-sm:10px;
  --radius-xs:6px;
  --font:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  --success:#4ADE80;
  --success-dim:rgba(74,222,128,0.12);
  --error:#F87171;
  --error-dim:rgba(248,113,113,0.12);
  --warning:#FBBF24;
}

body{
  min-height:100dvh;
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:var(--font);
  background:var(--bg);
  color:var(--text);
  padding:32px 16px;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* Subtle grid background */
body::before{
  content:'';
  position:fixed;
  inset:0;
  background-image:
    linear-gradient(rgba(108,142,239,0.02) 1px,transparent 1px),
    linear-gradient(90deg,rgba(108,142,239,0.02) 1px,transparent 1px);
  background-size:48px 48px;
  pointer-events:none;
  z-index:0;
}

.upload-card{
  position:relative;
  z-index:1;
  width:100%;
  max-width:560px;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:
    0 4px 24px rgba(0,0,0,0.3),
    0 1px 3px rgba(0,0,0,0.2);
  overflow:hidden;
}

/* ---- Header ---- */
.upload-header{
  padding:28px 28px 0;
}
.upload-header h2{
  font-size:1.25rem;
  font-weight:700;
  letter-spacing:-0.01em;
  color:var(--text);
  line-height:1.3;
}
.upload-header p{
  margin-top:6px;
  font-size:0.8125rem;
  color:var(--text-secondary);
  line-height:1.5;
}

/* ---- Dropzone ---- */
.dropzone-wrap{
  padding:24px 28px;
}

.dropzone{
  position:relative;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:16px;
  padding:48px 24px;
  border:2px dashed var(--border);
  border-radius:var(--radius-sm);
  background:transparent;
  cursor:pointer;
  overflow:hidden;
}

.dropzone.drag-over{
  border-color:var(--accent);
  background:var(--accent-dim);
}

.dropzone-icon{
  width:48px;
  height:48px;
  color:var(--text-tertiary);
}

.dropzone-text{
  text-align:center;
}
.dropzone-text .primary{
  font-size:0.9375rem;
  font-weight:600;
  color:var(--text);
  line-height:1.4;
}
.dropzone-text .primary span{
  color:var(--accent);
}
.dropzone-text .meta{
  margin-top:4px;
  font-size:0.75rem;
  color:var(--text-tertiary);
}

.dropzone-divider{
  display:flex;
  align-items:center;
  gap:12px;
  width:100%;
  max-width:200px;
  color:var(--text-tertiary);
  font-size:0.75rem;
}
.dropzone-divider::before,
.dropzone-divider::after{
  content:'';
  flex:1;
  height:1px;
  background:var(--border);
}

.browse-btn{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:10px 22px;
  background:var(--accent);
  color:#fff;
  font-family:var(--font);
  font-size:0.8125rem;
  font-weight:600;
  border:none;
  border-radius:var(--radius-xs);
  cursor:pointer;
  letter-spacing:0.01em;
}

.formats{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  flex-wrap:wrap;
  margin-top:2px;
}
.format-tag{
  display:inline-block;
  padding:2px 8px;
  font-size:0.6875rem;
  font-weight:500;
  color:var(--text-tertiary);
  background:var(--surface-raised);
  border-radius:4px;
  text-transform:uppercase;
  letter-spacing:0.04em;
}

/* ---- File List ---- */
.file-list{
  padding:0 28px 8px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.file-list:empty{
  display:none;
}

.file-row{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px 14px;
  background:var(--surface-raised);
  border-radius:var(--radius-xs);
  border:1px solid var(--border);
  opacity:0;
}

.file-icon{
  width:36px;
  height:36px;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:0.6875rem;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:0.04em;
  flex-shrink:0;
}
.file-icon.pdf{ background:rgba(239,68,68,0.15); color:#EF4444; }
.file-icon.png{ background:rgba(139,92,246,0.15); color:#8B5CF6; }
.file-icon.doc{ background:rgba(59,130,246,0.15); color:#3B82F6; }
.file-icon.zip{ background:rgba(251,191,36,0.15); color:#FBBF24; }

.file-info{
  flex:1;
  min-width:0;
}
.file-name{
  font-size:0.8125rem;
  font-weight:600;
  color:var(--text);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.file-size{
  font-size:0.6875rem;
  color:var(--text-tertiary);
  margin-top:2px;
}

/* Progress bar track */
.progress-wrap{
  margin-top:8px;
  height:4px;
  border-radius:2px;
  background:rgba(255,255,255,0.06);
  overflow:hidden;
}
.progress-bar{
  height:100%;
  border-radius:2px;
  background:var(--accent);
  width:0%;
}

/* States */
.file-row.completed .progress-wrap{ display:none; }
.file-row.error .progress-wrap{ display:none; }
.file-row.error .file-name{ color:var(--error); }
.file-row.error{ border-color:var(--error-dim); }

.file-status{
  width:28px;
  height:28px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
}
.file-status.uploading{
  color:var(--text-tertiary);
  font-size:0.6875rem;
  font-weight:600;
}
.file-status.done{
  background:var(--success-dim);
  color:var(--success);
}
.file-status.failed{
  background:var(--error-dim);
  color:var(--error);
  cursor:pointer;
}

.file-cancel{
  width:24px;
  height:24px;
  display:flex;
  align-items:center;
  justify-content:center;
  border:none;
  background:none;
  color:var(--text-tertiary);
  cursor:pointer;
  border-radius:4px;
  flex-shrink:0;
}

/* ---- Summary ---- */
.upload-summary{
  padding:16px 28px 24px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-top:1px solid var(--border);
  opacity:0;
}
.summary-text{
  font-size:0.8125rem;
  color:var(--text-secondary);
}
.summary-text strong{
  color:var(--text);
  font-weight:600;
}
.summary-size{
  font-size:0.75rem;
  color:var(--text-tertiary);
}
</style>
</head>
<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Flip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/TextPlugin.min.js"></script>
<script src="../animations/gsap-utils.js"></script>

<div class="upload-card" id="uploadCard">
  <div class="upload-header">
    <h2>Upload Files</h2>
    <p>Drag and drop your files, or click to browse. Max 25MB per file.</p>
  </div>

  <div class="dropzone-wrap">
    <div class="dropzone" id="dropzone">
      <svg class="dropzone-icon" viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M24 32V16"/>
        <path d="M16 22l8-8 8 8"/>
        <path d="M40 32v4a4 4 0 01-4 4H12a4 4 0 01-4-4v-4"/>
        <path d="M8 28a12 12 0 01.8-4.2A10 10 0 0118 14a10 10 0 0110.4 5.6A8 8 0 0140 28"/>
      </svg>

      <div class="dropzone-text">
        <div class="primary">Drag &amp; drop files here, or <span>click to browse</span></div>
        <div class="meta">PNG, JPG, PDF, DOC, ZIP up to 25MB</div>
      </div>

      <div class="dropzone-divider">or</div>

      <button class="browse-btn" id="browseBtn">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48"/></svg>
        Browse Files
      </button>

      <div class="formats">
        <span class="format-tag">png</span>
        <span class="format-tag">jpg</span>
        <span class="format-tag">pdf</span>
        <span class="format-tag">doc</span>
        <span class="format-tag">zip</span>
      </div>
    </div>
  </div>

  <div class="file-list" id="fileList"></div>
  <div class="upload-summary" id="uploadSummary"></div>
</div>

<script>
gsap.registerPlugin(ScrollTrigger, Flip, TextPlugin);

var reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

/* ---- Demo File Data ---- */
var demoFiles = [
  { name: 'project-mockup-final.png', size: '4.2 MB', type: 'png', progress: 100, status: 'done' },
  { name: 'brand-guidelines-v3.pdf', size: '12.8 MB', type: 'pdf', progress: 78, status: 'uploading' },
  { name: 'meeting-notes-feb.doc', size: '1.1 MB', type: 'doc', progress: 100, status: 'done' },
  { name: 'source-assets-backup.zip', size: '18.4 MB', type: 'zip', progress: 34, status: 'error' }
];

/* ---- SVG Templates (static, safe content) ---- */
var svgCheck = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><path d="M20 6L9 17l-5-5"/></svg>';
var svgRetry = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M1 4v6h6"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/></svg>';
var svgClose = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M18 6L6 18M6 6l12 12"/></svg>';

/* ---- Build File Row via DOM API ---- */
function createFileRow(file) {
  var row = document.createElement('div');
  row.className = 'file-row';
  if (file.status === 'done') row.classList.add('completed');
  if (file.status === 'error') row.classList.add('error');

  /* File type icon */
  var icon = document.createElement('div');
  icon.className = 'file-icon ' + file.type;
  icon.textContent = file.type;
  row.appendChild(icon);

  /* File info block */
  var info = document.createElement('div');
  info.className = 'file-info';

  var nameEl = document.createElement('div');
  nameEl.className = 'file-name';
  nameEl.textContent = file.name;
  info.appendChild(nameEl);

  var sizeEl = document.createElement('div');
  sizeEl.className = 'file-size';
  sizeEl.textContent = file.size;
  info.appendChild(sizeEl);

  if (file.status !== 'done' && file.status !== 'error') {
    var pw = document.createElement('div');
    pw.className = 'progress-wrap';
    var pb = document.createElement('div');
    pb.className = 'progress-bar';
    pw.appendChild(pb);
    info.appendChild(pw);
  }
  row.appendChild(info);

  /* Status indicator */
  var status = document.createElement('div');
  if (file.status === 'done') {
    status.className = 'file-status done';
    status.innerHTML = svgCheck; /* Static SVG, safe */
  } else if (file.status === 'error') {
    status.className = 'file-status failed';
    status.setAttribute('data-retry', '');
    status.setAttribute('title', 'Retry upload');
    status.innerHTML = svgRetry; /* Static SVG, safe */
  } else {
    status.className = 'file-status uploading';
    status.textContent = '0%';
  }
  row.appendChild(status);

  /* Cancel button */
  var cancel = document.createElement('button');
  cancel.className = 'file-cancel';
  cancel.setAttribute('title', 'Remove file');
  cancel.innerHTML = svgClose; /* Static SVG, safe */
  row.appendChild(cancel);

  return row;
}

/* ---- Summary Update ---- */
function updateSummary() {
  var summary = document.getElementById('uploadSummary');
  var doneCount = demoFiles.filter(function(f){ return f.status === 'done'; }).length;
  var totalSize = demoFiles.reduce(function(acc, f){
    return acc + parseFloat(f.size);
  }, 0).toFixed(1);

  /* Build summary via DOM */
  summary.textContent = '';
  var textSpan = document.createElement('span');
  textSpan.className = 'summary-text';
  var strong = document.createElement('strong');
  strong.textContent = doneCount + ' of ' + demoFiles.length;
  textSpan.appendChild(strong);
  textSpan.appendChild(document.createTextNode(' files uploaded'));
  summary.appendChild(textSpan);

  var sizeSpan = document.createElement('span');
  sizeSpan.className = 'summary-size';
  sizeSpan.textContent = totalSize + ' MB total';
  summary.appendChild(sizeSpan);
}

/* ---- Entrance Animation ---- */
function animateEntrance() {
  if (reducedMotion) {
    document.getElementById('uploadCard').style.opacity = '1';
    return;
  }

  var tl = gsap.timeline({ defaults: { ease: 'power3.out' } });

  tl.from('#uploadCard', { opacity: 0, scale: 0.92, duration: 0.6, ease: 'back.out(1.4)' })
    .from('.upload-header h2', { opacity: 0, y: -15, duration: 0.4 }, '-=0.25')
    .from('.upload-header p', { opacity: 0, y: -10, duration: 0.35 }, '-=0.2')
    .from('.dropzone', { opacity: 0, scale: 0.95, duration: 0.5, ease: 'back.out(1.2)' }, '-=0.15')
    .from('.dropzone-icon', { opacity: 0, y: 15, scale: 0.7, duration: 0.4, ease: 'back.out(2)' }, '-=0.2')
    .from('.dropzone-text', { opacity: 0, y: 10, duration: 0.35 }, '-=0.15')
    .from('.dropzone-divider', { opacity: 0, duration: 0.25 }, '-=0.1')
    .from('.browse-btn', { opacity: 0, y: 8, scale: 0.9, duration: 0.35, ease: 'back.out(1.6)' }, '-=0.1')
    .from('.format-tag', { opacity: 0, y: 6, duration: 0.25, stagger: 0.04 }, '-=0.15');
}

/* ---- Drag Hover Animation ---- */
function setupDragInteraction() {
  var dropzone = document.getElementById('dropzone');

  dropzone.addEventListener('dragenter', function(e) {
    e.preventDefault();
    dropzone.classList.add('drag-over');
    if (!reducedMotion) {
      gsap.to('.dropzone-icon', { scale: 1.2, y: -4, duration: 0.3, ease: 'back.out(2)' });
    }
  });

  dropzone.addEventListener('dragover', function(e) { e.preventDefault(); });

  dropzone.addEventListener('dragleave', function(e) {
    e.preventDefault();
    dropzone.classList.remove('drag-over');
    if (!reducedMotion) {
      gsap.to('.dropzone-icon', { scale: 1, y: 0, duration: 0.3, ease: 'power2.out' });
    }
  });

  dropzone.addEventListener('drop', function(e) {
    e.preventDefault();
    dropzone.classList.remove('drag-over');
    if (!reducedMotion) {
      gsap.to('.dropzone-icon', { scale: 1, y: 0, duration: 0.3 });
    }
    triggerUploadDemo();
  });
}

/* ---- Browse Button Hover ---- */
function setupBrowseHover() {
  var btn = document.getElementById('browseBtn');
  if (reducedMotion) return;

  btn.addEventListener('mouseenter', function() {
    gsap.to(btn, { scale: 1.05, duration: 0.2, ease: 'power2.out' });
  });
  btn.addEventListener('mouseleave', function() {
    gsap.to(btn, { scale: 1, duration: 0.2, ease: 'power2.out' });
  });
}

/* ---- Upload Demo Simulation ---- */
var demoTriggered = false;

function triggerUploadDemo() {
  if (demoTriggered) return;
  demoTriggered = true;

  var fileList = document.getElementById('fileList');
  var rows = [];

  demoFiles.forEach(function(file) {
    var row = createFileRow(file);
    fileList.appendChild(row);
    rows.push({ el: row, file: file });
  });

  updateSummary();

  if (reducedMotion) {
    rows.forEach(function(r) { r.el.style.opacity = '1'; });
    document.getElementById('uploadSummary').style.opacity = '1';
    return;
  }

  /* Stagger file rows in */
  var tl = gsap.timeline({ defaults: { ease: 'power3.out' } });

  rows.forEach(function(r, i) {
    tl.to(r.el, { opacity: 1, x: 0, duration: 0.4 }, i * 0.12);
    tl.from(r.el, { x: -30, duration: 0.4, ease: 'power3.out' }, '<');
  });

  /* Animate progress bars */
  rows.forEach(function(r) {
    var bar = r.el.querySelector('.progress-bar');
    var statusEl = r.el.querySelector('.file-status');
    if (!bar) return;

    var targetPct = r.file.progress;

    tl.to(bar, {
      width: targetPct + '%',
      duration: 1.2 + Math.random() * 0.8,
      ease: 'power1.inOut',
      delay: 0.3,
      onUpdate: function() {
        var current = Math.round(parseFloat(bar.style.width) || 0);
        if (statusEl && statusEl.classList.contains('uploading')) {
          statusEl.textContent = current + '%';
        }
      },
      onComplete: function() {
        if (r.file.status === 'done') {
          completeFile(r.el);
        } else if (r.file.status === 'error') {
          errorFile(r.el);
        }
      }
    }, '-=0.8');
  });

  /* Show summary */
  tl.to('#uploadSummary', { opacity: 1, duration: 0.4 }, '-=0.3');
}

function completeFile(row) {
  row.classList.add('completed');
  var statusEl = row.querySelector('.file-status');
  var progressWrap = row.querySelector('.progress-wrap');

  if (progressWrap) {
    gsap.to(progressWrap, { opacity: 0, height: 0, duration: 0.25, onComplete: function() {
      progressWrap.style.display = 'none';
    }});
  }

  statusEl.className = 'file-status done';
  statusEl.innerHTML = svgCheck; /* Static SVG, safe */

  if (!reducedMotion) {
    gsap.from(statusEl, { scale: 0, duration: 0.35, ease: 'back.out(3)' });
  }
}

function errorFile(row) {
  row.classList.add('error');
  var statusEl = row.querySelector('.file-status');
  var progressWrap = row.querySelector('.progress-wrap');

  if (progressWrap) {
    gsap.to(progressWrap, { opacity: 0, height: 0, duration: 0.25, onComplete: function() {
      progressWrap.style.display = 'none';
    }});
  }

  statusEl.className = 'file-status failed';
  statusEl.setAttribute('data-retry', '');
  statusEl.setAttribute('title', 'Retry upload');
  statusEl.innerHTML = svgRetry; /* Static SVG, safe */

  if (!reducedMotion) {
    gsap.from(statusEl, { scale: 0, rotation: -90, duration: 0.4, ease: 'back.out(2)' });
    /* Shake the row */
    gsap.to(row, { x: -6, duration: 0.06, yoyo: true, repeat: 5, ease: 'power2.inOut', onComplete: function() {
      gsap.set(row, { x: 0 });
    }});
  }
}

/* ---- Cancel / Remove Row ---- */
document.addEventListener('click', function(e) {
  var cancelBtn = e.target.closest('.file-cancel');
  if (cancelBtn) {
    var row = cancelBtn.closest('.file-row');
    if (!reducedMotion) {
      gsap.to(row, { opacity: 0, x: 30, height: 0, padding: 0, marginBottom: 0, duration: 0.35, ease: 'power2.in', onComplete: function() {
        row.remove();
      }});
    } else {
      row.remove();
    }
    return;
  }

  /* Retry click */
  var retryBtn = e.target.closest('[data-retry]');
  if (retryBtn) {
    var retryRow = retryBtn.closest('.file-row');
    retryRow.classList.remove('error');

    retryBtn.className = 'file-status uploading';
    retryBtn.removeAttribute('data-retry');
    retryBtn.textContent = '0%';

    /* Re-add progress bar */
    var info = retryRow.querySelector('.file-info');
    var existingProg = info.querySelector('.progress-wrap');
    if (!existingProg) {
      var pw = document.createElement('div');
      pw.className = 'progress-wrap';
      var pb = document.createElement('div');
      pb.className = 'progress-bar';
      pw.appendChild(pb);
      info.appendChild(pw);
      gsap.set(pw, { opacity: 1, height: 'auto' });
    }

    var bar = info.querySelector('.progress-bar');
    gsap.set(bar, { width: '0%' });

    if (!reducedMotion) {
      gsap.to(bar, {
        width: '100%',
        duration: 2,
        ease: 'power1.inOut',
        onUpdate: function() {
          var cur = Math.round(parseFloat(bar.style.width) || 0);
          retryBtn.textContent = cur + '%';
        },
        onComplete: function() {
          completeFile(retryRow);
        }
      });
    }
  }
});

/* ---- Browse Click triggers demo ---- */
document.getElementById('browseBtn').addEventListener('click', function() {
  triggerUploadDemo();
});
document.getElementById('dropzone').addEventListener('click', function(e) {
  if (e.target.closest('.browse-btn')) return;
  triggerUploadDemo();
});

/* ---- Init ---- */
setupDragInteraction();
setupBrowseHover();
animateEntrance();

UV.addControlPanel();
</script>
</body>
</html>