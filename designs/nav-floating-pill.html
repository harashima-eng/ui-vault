<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Floating Pill Navigation</title>
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0}

  :root{
    --bg-deep: oklch(0.16 0.02 260);
    --bg-mid: oklch(0.20 0.025 260);
    --nav-bg: oklch(0.22 0.02 260 / 0.65);
    --nav-border: oklch(0.40 0.02 260 / 0.18);
    --pill-bg: oklch(0.62 0.19 250);
    --pill-glow: oklch(0.62 0.19 250 / 0.35);
    --text-active: oklch(0.98 0.005 260);
    --text-idle: oklch(0.65 0.02 260);
    --text-idle-hover: oklch(0.82 0.02 260);
    --text-hero: oklch(0.96 0.005 260);
    --text-sub: oklch(0.58 0.02 260);
    --dot-color: oklch(0.30 0.015 260);
  }

  body{
    min-height:100dvh;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif;
    background:var(--bg-deep);
    color:var(--text-hero);
    overflow-x:hidden;
    -webkit-font-smoothing:antialiased;
  }

  /* ---------- subtle dot grid ---------- */
  .backdrop{
    position:fixed;inset:0;z-index:0;
    background:
      radial-gradient(circle at 30% 20%, oklch(0.25 0.04 280 / 0.4) 0%, transparent 50%),
      radial-gradient(circle at 75% 70%, oklch(0.22 0.04 230 / 0.3) 0%, transparent 50%),
      radial-gradient(circle, var(--dot-color) 1px, transparent 1px);
    background-size:100% 100%, 100% 100%, 24px 24px;
  }

  /* ---------- navigation ---------- */
  .nav-wrapper{
    position:fixed;top:0;left:0;right:0;z-index:100;
    display:flex;justify-content:center;
    padding-top:28px;
    pointer-events:none;
  }

  .nav{
    position:relative;
    display:flex;align-items:center;gap:4px;
    padding:5px;
    border-radius:999px;
    background:var(--nav-bg);
    border:1px solid var(--nav-border);
    backdrop-filter:blur(18px);
    -webkit-backdrop-filter:blur(18px);
    box-shadow:
      0 4px 24px oklch(0 0 0 / 0.35),
      0 1px 3px oklch(0 0 0 / 0.2),
      inset 0 1px 0 oklch(1 0 0 / 0.04);
    pointer-events:auto;
  }

  /* sliding pill */
  .pill{
    position:absolute;
    top:5px;
    left:0;
    height:calc(100% - 10px);
    border-radius:999px;
    background:var(--pill-bg);
    box-shadow:0 0 20px var(--pill-glow), 0 1px 4px oklch(0 0 0 / 0.3);
    z-index:0;
  }

  .nav-item{
    position:relative;z-index:1;
    padding:10px 20px;
    border:none;background:none;
    font-family:inherit;
    font-size:0.875rem;
    font-weight:500;
    letter-spacing:0.01em;
    color:var(--text-idle);
    cursor:pointer;
    border-radius:999px;
    white-space:nowrap;
    -webkit-tap-highlight-color:transparent;
  }

  .nav-item[aria-selected="true"]{color:var(--text-active);font-weight:600}
  .nav-item:focus-visible{
    outline:2px solid var(--pill-bg);
    outline-offset:2px;
  }

  /* ---------- hero content ---------- */
  .hero{
    position:relative;z-index:1;
    display:flex;flex-direction:column;align-items:center;
    justify-content:center;text-align:center;
    min-height:100dvh;
    padding:120px 24px 80px;
  }

  .hero-badge{
    display:inline-flex;align-items:center;gap:8px;
    padding:6px 16px 6px 8px;
    border-radius:999px;
    background:oklch(0.26 0.025 260 / 0.7);
    border:1px solid oklch(0.40 0.02 260 / 0.2);
    font-size:0.8125rem;font-weight:500;
    color:var(--text-sub);
    margin-bottom:32px;
  }

  .hero-badge-dot{
    width:8px;height:8px;border-radius:50%;
    background:oklch(0.68 0.17 155);
    box-shadow:0 0 8px oklch(0.68 0.17 155 / 0.5);
  }

  .hero h1{
    font-size:clamp(2.25rem, 5vw + 0.5rem, 4rem);
    font-weight:800;
    line-height:1.1;
    letter-spacing:-0.03em;
    text-wrap:balance;
    max-width:14ch;
    margin-bottom:20px;
  }

  .hero h1 .accent{
    background:linear-gradient(135deg, oklch(0.72 0.18 250), oklch(0.68 0.2 220));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
  }

  .hero p{
    font-size:clamp(1rem, 1.5vw + 0.25rem, 1.25rem);
    line-height:1.6;
    color:var(--text-sub);
    max-width:48ch;
    text-wrap:pretty;
    margin-bottom:40px;
  }

  .hero-cta{
    display:inline-flex;align-items:center;gap:8px;
    padding:14px 28px;
    border-radius:999px;border:none;
    background:var(--pill-bg);
    color:var(--text-active);
    font-family:inherit;font-size:0.9375rem;font-weight:600;
    cursor:pointer;
    box-shadow:0 0 24px var(--pill-glow), 0 2px 8px oklch(0 0 0 / 0.25);
  }
  .hero-cta:focus-visible{outline:2px solid var(--pill-bg);outline-offset:3px}

  .hero-cta svg{
    width:16px;height:16px;
  }

  /* fade-up elements start hidden; GSAP animates them */
  .fade-up{
    opacity:0;
    transform:translateY(18px);
  }
</style>
</head>
<body>

<div class="backdrop" aria-hidden="true"></div>

<nav class="nav-wrapper" aria-label="Main navigation">
  <div class="nav" role="tablist">
    <div class="pill" aria-hidden="true"></div>
    <button class="nav-item" role="tab" aria-selected="true" data-index="0">Home</button>
    <button class="nav-item" role="tab" aria-selected="false" data-index="1">Features</button>
    <button class="nav-item" role="tab" aria-selected="false" data-index="2">Pricing</button>
    <button class="nav-item" role="tab" aria-selected="false" data-index="3">About</button>
    <button class="nav-item" role="tab" aria-selected="false" data-index="4">Contact</button>
  </div>
</nav>

<main class="hero" id="main-content">
  <div class="hero-badge fade-up">
    <span class="hero-badge-dot" aria-hidden="true"></span>
    UI Vault Component
  </div>
  <h1 class="fade-up">Navigate with <span class="accent">fluidity</span></h1>
  <p class="fade-up">A floating pill navbar that tracks the active item with a satisfying slide. Click the tabs above to see the indicator glide into place.</p>
  <button class="hero-cta fade-up">
    Explore components
    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3 8h10M9 4l4 4-4 4"/></svg>
  </button>
</main>

<script>
/* Navigation logic — pill movement deferred to GSAP block below */
</script>
<!-- GSAP -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/TextPlugin.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Flip.min.js"></script>
<script>gsap.registerPlugin(ScrollTrigger, TextPlugin, Flip);</script>
<script src="../animations/gsap-utils.js"></script>
<script>
(function () {
  var nav   = document.querySelector('.nav');
  var pill  = document.querySelector('.pill');
  var items = Array.from(document.querySelectorAll('.nav-item'));

  // ─── Position pill on active tab (instant, no animation) ──
  function snapPill(el) {
    var navRect = nav.getBoundingClientRect();
    var elRect  = el.getBoundingClientRect();
    gsap.set(pill, {
      width: elRect.width,
      x: elRect.left - navRect.left,
    });
  }

  // ─── Flip-based pill move (animated) ──────────────────
  function movePill(el) {
    if (UV.prefersReducedMotion) { snapPill(el); return; }
    var state = Flip.getState(pill);
    var navRect = nav.getBoundingClientRect();
    var elRect  = el.getBoundingClientRect();
    gsap.set(pill, {
      width: elRect.width,
      x: elRect.left - navRect.left,
    });
    Flip.from(state, {
      duration: 0.35,
      ease: 'power2.inOut',
      absolute: true,
    });
  }

  function activate(el) {
    items.forEach(function (btn) { btn.setAttribute('aria-selected', 'false'); });
    el.setAttribute('aria-selected', 'true');
    movePill(el);

    // Animate text color for all items
    if (!UV.prefersReducedMotion) {
      items.forEach(function (btn) {
        var isActive = btn === el;
        gsap.to(btn, {
          color: isActive
            ? getComputedStyle(document.documentElement).getPropertyValue('--text-active').trim()
            : getComputedStyle(document.documentElement).getPropertyValue('--text-idle').trim(),
          fontWeight: isActive ? 600 : 500,
          duration: 0.22,
          ease: 'power2.out',
        });
      });
    }
  }

  // Initial pill position
  var active = document.querySelector('.nav-item[aria-selected="true"]');
  if (active) snapPill(active);

  // Click handler
  items.forEach(function (btn) {
    btn.addEventListener('click', function () { activate(this); });
  });

  // Keyboard arrows
  nav.addEventListener('keydown', function (e) {
    var idx = items.indexOf(document.activeElement);
    if (idx < 0) return;
    var next = -1;
    if (e.key === 'ArrowRight' || e.key === 'ArrowDown') next = (idx + 1) % items.length;
    if (e.key === 'ArrowLeft'  || e.key === 'ArrowUp')   next = (idx - 1 + items.length) % items.length;
    if (next >= 0) {
      e.preventDefault();
      items[next].focus();
      activate(items[next]);
    }
  });

  // Recalc on resize
  var resizeTimer;
  window.addEventListener('resize', function () {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function () {
      var cur = document.querySelector('.nav-item[aria-selected="true"]');
      if (cur) snapPill(cur);
    }, 80);
  });

  // ─── GSAP Animations ─────────────────────────────────
  if (!UV.prefersReducedMotion) {

    // 1. Nav entrance — slide in from top
    gsap.from('.nav', {
      y: -50,
      opacity: 0,
      duration: 0.6,
      ease: 'power3.out',
      delay: 0.1,
    });

    // 2. Hero fade-up elements — staggered entrance
    gsap.to('.fade-up', {
      opacity: 1,
      y: 0,
      duration: 0.7,
      ease: 'power2.out',
      stagger: 0.08,
      delay: 0.3,
    });

    // 3. Nav item hover — GSAP color transitions
    items.forEach(function (btn) {
      btn.addEventListener('mouseenter', function () {
        if (btn.getAttribute('aria-selected') !== 'true') {
          gsap.to(btn, {
            color: getComputedStyle(document.documentElement).getPropertyValue('--text-idle-hover').trim(),
            duration: 0.22,
            ease: 'power2.out',
          });
        }
      });
      btn.addEventListener('mouseleave', function () {
        if (btn.getAttribute('aria-selected') !== 'true') {
          gsap.to(btn, {
            color: getComputedStyle(document.documentElement).getPropertyValue('--text-idle').trim(),
            duration: 0.22,
            ease: 'power2.out',
          });
        }
      });
    });

    // 4. Hero CTA hover — GSAP replaces CSS transition
    var cta    = document.querySelector('.hero-cta');
    var ctaSvg = cta ? cta.querySelector('svg') : null;
    if (cta) {
      cta.addEventListener('mouseenter', function () {
        gsap.to(cta, {
          y: -1,
          boxShadow: '0 0 32px var(--pill-glow), 0 4px 16px oklch(0 0 0 / 0.3)',
          duration: 0.18,
          ease: 'power2.out',
        });
        if (ctaSvg) gsap.to(ctaSvg, { x: 3, duration: 0.18, ease: 'power2.out' });
      });
      cta.addEventListener('mouseleave', function () {
        gsap.to(cta, {
          y: 0,
          boxShadow: '0 0 24px var(--pill-glow), 0 2px 8px oklch(0 0 0 / 0.25)',
          duration: 0.18,
          ease: 'power2.out',
        });
        if (ctaSvg) gsap.to(ctaSvg, { x: 0, duration: 0.18, ease: 'power2.out' });
      });
      cta.addEventListener('mousedown', function () {
        gsap.to(cta, { y: 0, scale: 0.98, duration: 0.1, ease: 'power2.out' });
      });
      cta.addEventListener('mouseup', function () {
        gsap.to(cta, { scale: 1, duration: 0.15, ease: 'power2.out' });
      });
    }

    // 5. Pill glow pulse (replaces CSS @keyframes pill-glow)
    gsap.to(pill, {
      boxShadow: '0 0 28px var(--pill-glow), 0 1px 4px oklch(0 0 0 / 0.3)',
      duration: 1.5,
      ease: 'sine.inOut',
      yoyo: true,
      repeat: -1,
    });
  } else {
    // Reduced motion: just show everything
    gsap.set('.fade-up', { opacity: 1, y: 0 });
  }

  // ─── Control Panel ──────────────────────────────────
  UV.addControlPanel();
})();
</script>
</body>
</html>
