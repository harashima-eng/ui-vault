<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UI Vault — Personal Design Warehouse</title>
<script>
  (function() {
    var theme = localStorage.getItem('ui-vault-theme');
    if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
    }
  })();
</script>
<style>
/* ============================================================
   RESET & BASE
   ============================================================ */
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

:root {
  /* Color System — Light */
  --color-bg: #FAFAF8;
  --color-bg-alt: #F5F5F0;
  --color-surface: #FFFFFF;
  --color-surface-hover: #F9F8F5;
  --color-border: #E8E5DE;
  --color-border-strong: #D4D0C8;
  --color-text-primary: #1A1A1A;
  --color-text-secondary: #6B6B6B;
  --color-text-tertiary: #9C9C9C;
  --color-text-inverted: #FFFFFF;
  --color-accent: #D97706;
  --color-accent-hover: #B45309;
  --color-accent-subtle: #FEF3C7;
  --color-accent-muted: #FFFBEB;
  --color-success: #16A34A;
  --color-warning: #D97706;
  --color-error: #DC2626;
  --color-info: #2563EB;
  --shadow-xs: 0 1px 2px rgba(140,130,115,0.06);
  --shadow-sm: 0 2px 4px rgba(140,130,115,0.08);
  --shadow-md: 0 4px 12px rgba(140,130,115,0.10);
  --shadow-lg: 0 8px 24px rgba(140,130,115,0.12);
  --shadow-xl: 0 16px 48px rgba(140,130,115,0.14);
  --color-favorite: #D97706;
  --color-favorite-filled: #F59E0B;
  --color-focus-ring: rgba(217,119,6,0.40);
  --color-overlay: rgba(0,0,0,0.30);

  /* Category badge colors */
  --badge-heroes-bg: #FEF3C7; --badge-heroes-text: #92400E;
  --badge-cards-bg: #DBEAFE; --badge-cards-text: #1E40AF;
  --badge-dashboards-bg: #D1FAE5; --badge-dashboards-text: #065F46;
  --badge-navigation-bg: #EDE9FE; --badge-navigation-text: #5B21B6;
  --badge-forms-bg: #FCE7F3; --badge-forms-text: #9D174D;
  --badge-layouts-bg: #E0E7FF; --badge-layouts-text: #3730A3;
  --badge-pricing-bg: #CCFBF1; --badge-pricing-text: #134E4A;
  --badge-footers-bg: #F3E8FF; --badge-footers-text: #6B21A8;
  --badge-sections-bg: #FEF9C3; --badge-sections-text: #854D0E;
  --badge-other-bg: #F1F5F9; --badge-other-text: #475569;

  /* Motion */
  --duration-instant: 120ms;
  --duration-fast: 180ms;
  --duration-normal: 250ms;
  --duration-panel: 300ms;
  --ease-out: cubic-bezier(0.2, 0, 0, 1);
  --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);

  /* Spacing */
  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-5: 20px;
  --space-6: 24px;
  --space-8: 32px;

  /* Radius */
  --radius-sm: 6px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-xl: 16px;

  /* Typography */
  --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --text-xs: 11px;
  --text-sm: 13px;
  --text-base: 14px;
  --text-md: 15px;
  --text-lg: 18px;
  --text-xl: 20px;

  /* Z-index */
  --z-sidebar: 100;
  --z-header: 200;
  --z-overlay: 300;
  --z-panel: 400;
}

/* Dark Mode */
.dark {
  --color-bg: #1A1A1E;
  --color-bg-alt: #16161A;
  --color-surface: #25252B;
  --color-surface-hover: #2E2E35;
  --color-border: #35353D;
  --color-border-strong: #48485A;
  --color-text-primary: #ECECEC;
  --color-text-secondary: #A0A0A8;
  --color-text-tertiary: #6B6B75;
  --color-text-inverted: #FFFFFF;
  --color-accent: #F59E0B;
  --color-accent-hover: #FBBF24;
  --color-accent-subtle: rgba(245,158,11,0.12);
  --color-accent-muted: rgba(245,158,11,0.06);
  --color-success: #4ADE80;
  --color-warning: #FBBF24;
  --color-error: #F87171;
  --color-info: #60A5FA;
  --shadow-xs: 0 1px 2px rgba(0,0,0,0.20);
  --shadow-sm: 0 2px 4px rgba(0,0,0,0.25);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.30);
  --shadow-lg: 0 8px 24px rgba(0,0,0,0.35);
  --shadow-xl: 0 16px 48px rgba(0,0,0,0.40);
  --color-favorite: #F59E0B;
  --color-favorite-filled: #FBBF24;
  --color-focus-ring: rgba(245,158,11,0.35);
  --color-overlay: rgba(0,0,0,0.55);

  --badge-heroes-bg: rgba(245,158,11,0.15); --badge-heroes-text: #FBBF24;
  --badge-cards-bg: rgba(59,130,246,0.15); --badge-cards-text: #60A5FA;
  --badge-dashboards-bg: rgba(16,185,129,0.15); --badge-dashboards-text: #34D399;
  --badge-navigation-bg: rgba(168,85,247,0.15); --badge-navigation-text: #C084FC;
  --badge-forms-bg: rgba(236,72,153,0.15); --badge-forms-text: #F472B6;
  --badge-layouts-bg: rgba(99,102,241,0.15); --badge-layouts-text: #818CF8;
  --badge-pricing-bg: rgba(20,184,166,0.15); --badge-pricing-text: #2DD4BF;
  --badge-footers-bg: rgba(168,85,247,0.15); --badge-footers-text: #D8B4FE;
  --badge-sections-bg: rgba(245,158,11,0.15); --badge-sections-text: #FDE047;
  --badge-other-bg: rgba(100,116,139,0.15); --badge-other-text: #94A3B8;
}

@media (prefers-reduced-motion: reduce) {
  :root {
    --duration-instant: 0ms;
    --duration-fast: 0ms;
    --duration-normal: 0ms;
    --duration-panel: 0ms;
  }
}

/* ============================================================
   BASE STYLES
   ============================================================ */
html {
  font-family: var(--font-family);
  font-size: var(--text-base);
  line-height: 1.5;
  color: var(--color-text-primary);
  background-color: var(--color-bg);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  min-height: 100dvh;
}

a { color: inherit; text-decoration: none; }
button { font: inherit; color: inherit; cursor: pointer; border: none; background: none; }
input, textarea { font: inherit; color: inherit; }
img { display: block; max-width: 100%; }

/* Screen-reader only */
.sr-only {
  position: absolute; width: 1px; height: 1px;
  padding: 0; margin: -1px; overflow: hidden;
  clip: rect(0,0,0,0); white-space: nowrap; border: 0;
}

/* ============================================================
   HEADER
   ============================================================ */
.header {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: 56px;
  display: flex;
  align-items: center;
  gap: var(--space-4);
  padding: 0 var(--space-6);
  background-color: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  z-index: var(--z-header);
}

.header__brand {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  flex-shrink: 0;
}

.header__logo {
  width: 28px;
  height: 28px;
  background: var(--color-accent);
  border-radius: var(--radius-md);
  display: grid;
  place-items: center;
  color: var(--color-text-inverted);
}

.header__title {
  font-size: var(--text-xl);
  font-weight: 700;
  letter-spacing: -0.02em;
  color: var(--color-text-primary);
}

.header__search {
  position: relative;
  flex: 1;
  max-width: 480px;
  margin: 0 auto;
}

.header__search-icon {
  position: absolute;
  left: var(--space-3);
  top: 50%;
  transform: translateY(-50%);
  color: var(--color-text-tertiary);
  pointer-events: none;
}

.header__search-input {
  width: 100%;
  height: 36px;
  padding: 0 var(--space-3) 0 36px;
  background: var(--color-bg-alt);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  font-size: var(--text-sm);
  color: var(--color-text-primary);
  outline: none;
}

.header__search-input::placeholder {
  color: var(--color-text-tertiary);
}

.header__search-input:focus {
  border-color: var(--color-accent);
  box-shadow: 0 0 0 3px var(--color-focus-ring);
  background: var(--color-surface);
}

.header__actions {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  flex-shrink: 0;
}

.header__count {
  font-size: var(--text-sm);
  color: var(--color-text-tertiary);
  white-space: nowrap;
  margin-right: var(--space-2);
}

.header__btn {
  width: 36px;
  height: 36px;
  display: grid;
  place-items: center;
  border-radius: var(--radius-md);
  color: var(--color-text-secondary);
}

.header__btn:hover {
  background: var(--color-bg-alt);
  color: var(--color-text-primary);
}

.header__btn:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

.header__btn.is-active {
  background: var(--color-accent-subtle);
  color: var(--color-accent);
}

/* Mobile menu button (hidden on desktop) */
.header__menu-btn {
  display: none;
}

/* ============================================================
   SIDEBAR
   ============================================================ */
.sidebar {
  position: fixed;
  top: 56px;
  left: 0;
  bottom: 0;
  width: 240px;
  background: var(--color-surface);
  border-right: 1px solid var(--color-border);
  overflow-y: auto;
  z-index: var(--z-sidebar);
  padding: var(--space-3) 0;
}

.sidebar__section {
  padding: 0 var(--space-3);
}

.sidebar__item {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  width: 100%;
  padding: var(--space-2) var(--space-3);
  border-radius: var(--radius-md);
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
  cursor: pointer;
  position: relative;
  text-align: left;
}

.sidebar__item:hover {
  background: var(--color-surface-hover);
  color: var(--color-text-primary);
}

.sidebar__item:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: -2px;
}

.sidebar__item::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%) scaleY(0);
  width: 3px;
  height: 20px;
  background: var(--color-accent);
  border-radius: 0 2px 2px 0;
}

.sidebar__item.is-active {
  background: var(--color-accent-muted);
  color: var(--color-accent);
  font-weight: 600;
}

.sidebar__item.is-active::before {
  transform: translateY(-50%) scaleY(1);
}

.sidebar__item-icon {
  flex-shrink: 0;
  color: inherit;
}

.sidebar__item-label {
  flex: 1;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.sidebar__item-count {
  font-size: var(--text-xs);
  font-weight: 500;
  color: var(--color-text-tertiary);
  background: var(--color-bg-alt);
  padding: 1px 6px;
  border-radius: 99px;
  min-width: 20px;
  text-align: center;
  flex-shrink: 0;
}

.sidebar__separator {
  height: 1px;
  background: var(--color-border);
  margin: var(--space-2) var(--space-4);
}

.sidebar__label {
  font-size: var(--text-xs);
  font-weight: 600;
  color: var(--color-text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  padding: var(--space-3) var(--space-3) var(--space-1) var(--space-6);
}

/* Sidebar overlay for mobile */
.sidebar-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: var(--color-overlay);
  z-index: calc(var(--z-sidebar) - 1);
  opacity: 0;
}

.sidebar-overlay.is-visible {
  opacity: 1;
}

/* ============================================================
   MAIN CONTENT
   ============================================================ */
.main {
  margin-left: 240px;
  margin-top: 56px;
  padding: var(--space-6);
  min-height: calc(100dvh - 56px);
}

/* ============================================================
   CARD GRID
   ============================================================ */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: var(--space-4);
}

.grid.is-hidden {
  display: none;
}

/* ============================================================
   CARD
   ============================================================ */
.card {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  overflow: hidden;
  cursor: pointer;
  position: relative;
}

/* Card hover — handled by GSAP */

.card:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

/* Card entrance — handled by GSAP */

.card__preview {
  position: relative;
  aspect-ratio: 4 / 3;
  overflow: hidden;
  background: var(--color-bg-alt);
  border-bottom: 1px solid var(--color-border);
}

.card__preview-iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 400%;
  height: 400%;
  transform: scale(0.25);
  transform-origin: top left;
  pointer-events: none;
  border: none;
  background: #FFFFFF;
}

.card__preview-placeholder {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  color: var(--color-text-tertiary);
}

.card__info {
  padding: var(--space-3) var(--space-4);
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}

.card__header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: var(--space-2);
}

.card__title {
  font-size: var(--text-md);
  font-weight: 600;
  color: var(--color-text-primary);
  line-height: 1.3;
  flex: 1;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.card__star {
  flex-shrink: 0;
  width: 28px;
  height: 28px;
  display: grid;
  place-items: center;
  border-radius: var(--radius-sm);
  color: var(--color-text-tertiary);
}

.card__star:hover {
  color: var(--color-favorite);
  background: var(--color-accent-muted);
}

.card__star.is-favorited {
  color: var(--color-favorite-filled);
}

/* Star bounce — handled by GSAP */

.card__meta {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  flex-wrap: wrap;
}

.badge {
  display: inline-flex;
  align-items: center;
  height: 22px;
  padding: 0 var(--space-2);
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  font-weight: 600;
  white-space: nowrap;
}

.badge--heroes     { background: var(--badge-heroes-bg);     color: var(--badge-heroes-text); }
.badge--cards      { background: var(--badge-cards-bg);       color: var(--badge-cards-text); }
.badge--dashboards { background: var(--badge-dashboards-bg);  color: var(--badge-dashboards-text); }
.badge--navigation { background: var(--badge-navigation-bg);  color: var(--badge-navigation-text); }
.badge--forms      { background: var(--badge-forms-bg);        color: var(--badge-forms-text); }
.badge--layouts    { background: var(--badge-layouts-bg);      color: var(--badge-layouts-text); }
.badge--pricing    { background: var(--badge-pricing-bg);      color: var(--badge-pricing-text); }
.badge--footers    { background: var(--badge-footers-bg);      color: var(--badge-footers-text); }
.badge--sections   { background: var(--badge-sections-bg);     color: var(--badge-sections-text); }
.badge--other      { background: var(--badge-other-bg);        color: var(--badge-other-text); }

.tag {
  display: inline-flex;
  align-items: center;
  height: 20px;
  padding: 0 var(--space-2);
  border-radius: 99px;
  font-size: var(--text-xs);
  color: var(--color-text-tertiary);
  background: var(--color-bg-alt);
  border: 1px solid var(--color-border);
}

/* ============================================================
   LIST VIEW
   ============================================================ */
.list {
  display: none;
  flex-direction: column;
}

.list.is-active {
  display: flex;
}

.list-item {
  display: flex;
  align-items: center;
  gap: var(--space-4);
  padding: var(--space-3) var(--space-4);
  background: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  cursor: pointer;
}

.list-item:first-child {
  border-top: 1px solid var(--color-border);
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

.list-item:last-child {
  border-radius: 0 0 var(--radius-lg) var(--radius-lg);
  border-bottom: 1px solid var(--color-border);
}

.list-item:only-child {
  border-radius: var(--radius-lg);
}

.list-item:hover {
  background: var(--color-surface-hover);
}

.list-item:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: -2px;
}

.list-item__preview {
  width: 80px;
  height: 60px;
  border-radius: var(--radius-sm);
  overflow: hidden;
  background: var(--color-bg-alt);
  border: 1px solid var(--color-border);
  flex-shrink: 0;
  position: relative;
}

.list-item__preview-iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 400%;
  height: 400%;
  transform: scale(0.25);
  transform-origin: top left;
  pointer-events: none;
  border: none;
  background: #FFFFFF;
}

.list-item__content {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.list-item__title {
  font-size: var(--text-base);
  font-weight: 600;
  color: var(--color-text-primary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.list-item__subtitle {
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
  display: flex;
  align-items: center;
  gap: var(--space-2);
  flex-wrap: wrap;
}

.list-item__actions {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  flex-shrink: 0;
}

.list-item__star {
  width: 32px;
  height: 32px;
  display: grid;
  place-items: center;
  border-radius: var(--radius-sm);
  color: var(--color-text-tertiary);
}

.list-item__star:hover {
  color: var(--color-favorite);
  background: var(--color-accent-muted);
}

.list-item__star.is-favorited {
  color: var(--color-favorite-filled);
}

/* List star bounce — handled by GSAP */

/* ============================================================
   PREVIEW PANEL
   ============================================================ */
.panel-overlay {
  position: fixed;
  inset: 0;
  background: var(--color-overlay);
  z-index: var(--z-overlay);
  opacity: 0;
  visibility: hidden;
}

.panel-overlay.is-visible {
  opacity: 1;
  visibility: visible;
}

.panel {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  width: 60vw;
  min-width: 500px;
  max-width: 900px;
  background: var(--color-surface);
  border-left: 1px solid var(--color-border);
  border-radius: var(--radius-xl) 0 0 var(--radius-xl);
  z-index: var(--z-panel);
  display: flex;
  flex-direction: column;
  transform: translateX(100%);
  box-shadow: var(--shadow-xl);
}

.panel.is-open {
  transform: translateX(0);
}

.panel__header {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-4) var(--space-6);
  border-bottom: 1px solid var(--color-border);
  flex-shrink: 0;
}

.panel__title {
  flex: 1;
  font-size: var(--text-lg);
  font-weight: 700;
  color: var(--color-text-primary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.panel__btn {
  width: 36px;
  height: 36px;
  display: grid;
  place-items: center;
  border-radius: var(--radius-md);
  color: var(--color-text-secondary);
}

.panel__btn:hover {
  background: var(--color-bg-alt);
  color: var(--color-text-primary);
}

.panel__btn:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

.panel__body {
  flex: 1;
  overflow: hidden;
  position: relative;
  background: var(--color-bg-alt);
}

.panel__iframe {
  width: 100%;
  height: 100%;
  border: none;
  background: #FFFFFF;
}

.panel__footer {
  padding: var(--space-4) var(--space-6);
  border-top: 1px solid var(--color-border);
  flex-shrink: 0;
}

.panel__notes-label {
  font-size: var(--text-xs);
  font-weight: 600;
  color: var(--color-text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: var(--space-2);
}

.panel__notes {
  width: 100%;
  min-height: 72px;
  max-height: 160px;
  padding: var(--space-2) var(--space-3);
  background: var(--color-bg-alt);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  font-size: var(--text-sm);
  color: var(--color-text-primary);
  resize: vertical;
  outline: none;
}

.panel__notes::placeholder {
  color: var(--color-text-tertiary);
}

.panel__notes:focus {
  border-color: var(--color-accent);
  box-shadow: 0 0 0 3px var(--color-focus-ring);
}

.panel__save-status {
  font-size: var(--text-xs);
  color: var(--color-text-tertiary);
  margin-top: var(--space-1);
  min-height: 16px;
}

/* ============================================================
   INSPECTOR PANEL
   ============================================================ */
.inspector {
  position: absolute;
  top: 0;
  right: 0;
  width: 280px;
  height: 100%;
  background: var(--color-surface);
  border-left: 1px solid var(--color-border);
  overflow-y: auto;
  overflow-x: hidden;
  z-index: 10;
  display: flex;
  flex-direction: column;
  transform: translateX(100%);
}

.inspector.is-open {
  transform: translateX(0);
}

.panel__iframe.inspector-active {
  width: calc(100% - 280px);
}

.inspector__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  border-bottom: 1px solid var(--color-border);
  flex-shrink: 0;
}

.inspector__title {
  font-size: 13px;
  font-weight: 700;
  color: var(--color-text-primary);
  letter-spacing: -0.01em;
}

.inspector__close {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  background: none;
  color: var(--color-text-tertiary);
  cursor: pointer;
  border-radius: var(--radius-sm);
  padding: 0;
}

.inspector__close:hover {
  color: var(--color-text-primary);
  background: var(--color-bg-alt);
}

.inspector__sections {
  flex: 1;
  overflow-y: auto;
  padding-bottom: 16px;
}

/* ---- Inspector Section (Accordion) ---- */
.inspector__section {
  border-bottom: 1px solid var(--color-border);
}

.inspector__section:last-child {
  border-bottom: none;
}

.inspector__section-toggle {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 16px;
  font-size: 11px;
  font-weight: 700;
  font-family: inherit;
  color: var(--color-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  background: none;
  border: none;
  cursor: pointer;
}

.inspector__section-toggle:hover {
  color: var(--color-text-primary);
  background: var(--color-bg-alt);
}

.inspector__section-toggle:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: -2px;
}

.inspector__section-chevron {
  flex-shrink: 0;
}

.inspector__section.is-open .inspector__section-chevron {
  transform: rotate(180deg);
}

.inspector__section-content {
  overflow: hidden;
  height: 0;
}

.inspector__section-inner {
  padding: 0 16px 12px;
}

/* ---- Inspector Label ---- */
.inspector__label {
  font-size: 10px;
  font-weight: 600;
  color: var(--color-text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 6px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.inspector__label-value {
  font-weight: 400;
  text-transform: none;
  letter-spacing: 0;
}

/* ---- Swatches ---- */
.inspector__swatches {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 6px;
  margin-bottom: 12px;
}

.inspector__swatch {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: 2px solid transparent;
  cursor: pointer;
  padding: 0;
  position: relative;
}

.inspector__swatch:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

.inspector__swatch.is-active {
  border-color: #fff;
  box-shadow: 0 0 0 2px var(--color-accent);
}

.inspector__swatch.is-disabled {
  opacity: 0.2;
  cursor: not-allowed;
}

.inspector__swatch--original {
  background: conic-gradient(#3B82F6, #10B981, #F59E0B, #A855F7, #EC4899, #3B82F6);
}

.inspector__swatch-label {
  position: absolute;
  bottom: -14px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 8px;
  color: var(--color-text-tertiary);
  white-space: nowrap;
  pointer-events: none;
  opacity: 0;
}

.inspector__swatch:hover .inspector__swatch-label {
  opacity: 1;
}

/* ---- Hex Input Row ---- */
.inspector__hex-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
}

.inspector__hex-preview {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: 2px solid var(--color-border);
  flex-shrink: 0;
}

.inspector__hex-input {
  flex: 1;
  padding: 5px 8px;
  font-size: 12px;
  font-family: 'SF Mono', SFMono-Regular, ui-monospace, monospace;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  background: var(--color-bg);
  color: var(--color-text-primary);
}

.inspector__hex-input:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: 0 0 0 2px rgba(217, 119, 6, 0.15);
}

/* ---- Sliders ---- */
.inspector__slider-row {
  margin-bottom: 10px;
}

.inspector__slider {
  width: 100%;
  accent-color: var(--color-accent);
  cursor: pointer;
  height: 4px;
}

.inspector__slider:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

/* ---- Font Chips ---- */
.inspector__font-chips {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 4px;
  margin-bottom: 12px;
}

.inspector__font-chip {
  padding: 5px 8px;
  font-size: 11px;
  font-family: inherit;
  border-radius: var(--radius-sm);
  border: 1px solid var(--color-border);
  background: none;
  color: var(--color-text-secondary);
  cursor: pointer;
  text-align: center;
}

.inspector__font-chip:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 1px;
}

.inspector__font-chip:hover {
  border-color: var(--color-text-tertiary);
}

.inspector__font-chip.is-active {
  border-color: var(--color-accent);
  color: var(--color-accent);
  background: rgba(217, 119, 6, 0.06);
}

.inspector__font-chip.is-disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

/* ---- Toggle Group ---- */
.inspector__toggle-group {
  display: flex;
  gap: 0;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  overflow: hidden;
  margin-bottom: 10px;
}

.inspector__toggle-btn {
  flex: 1;
  padding: 5px 4px;
  font-size: 11px;
  font-family: inherit;
  border: none;
  border-right: 1px solid var(--color-border);
  background: none;
  color: var(--color-text-tertiary);
  cursor: pointer;
}

.inspector__toggle-btn:last-child {
  border-right: none;
}

.inspector__toggle-btn:hover {
  color: var(--color-text-secondary);
  background: var(--color-bg-alt);
}

.inspector__toggle-btn.is-active {
  background: var(--color-accent);
  color: #fff;
}

.inspector__toggle-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

/* ---- Preset Buttons ---- */
.inspector__presets {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 4px;
}

.inspector__preset-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 8px;
  font-size: 11px;
  font-family: inherit;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  background: none;
  color: var(--color-text-secondary);
  cursor: pointer;
  text-align: left;
}

.inspector__preset-btn:hover {
  border-color: var(--color-text-tertiary);
  background: var(--color-bg-alt);
}

.inspector__preset-btn.is-active {
  border-color: var(--color-accent);
  color: var(--color-accent);
  background: rgba(217, 119, 6, 0.06);
}

.inspector__preset-btn.is-disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

.inspector__preset-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
}

.inspector__reset-btn {
  width: 100%;
  margin-top: 8px;
  padding: 6px 8px;
  font-size: 11px;
  font-family: inherit;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  background: none;
  color: var(--color-error);
  cursor: pointer;
}

.inspector__reset-btn:hover {
  background: rgba(220, 38, 38, 0.06);
  border-color: var(--color-error);
}

/* ---- Inspector Toggle Button in Panel Header ---- */
.panel__btn--inspector {
  position: relative;
}

.panel__btn--inspector.is-active {
  color: var(--color-accent);
}

/* ---- Mobile: hide inspector ---- */
@media (max-width: 768px) {
  .inspector {
    display: none;
  }
  .panel__btn--inspector {
    display: none;
  }
  .panel__iframe.inspector-active {
    width: 100%;
  }
}

/* ============================================================
   EMPTY STATE
   ============================================================ */
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-3);
  padding: 80px var(--space-6);
  text-align: center;
}

.empty-state__icon {
  width: 48px;
  height: 48px;
  color: var(--color-text-tertiary);
  opacity: 0.5;
}

.empty-state__title {
  font-size: var(--text-lg);
  font-weight: 600;
  color: var(--color-text-primary);
}

.empty-state__desc {
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
  max-width: 36ch;
  line-height: 1.5;
}

/* ============================================================
   MOBILE RESPONSIVE
   ============================================================ */
@media (max-width: 768px) {
  .header {
    padding: 0 var(--space-4);
    gap: var(--space-3);
  }

  .header__menu-btn {
    display: grid;
    width: 36px;
    height: 36px;
    place-items: center;
    border-radius: var(--radius-md);
    color: var(--color-text-secondary);
  }

  .header__menu-btn:hover {
    background: var(--color-bg-alt);
    color: var(--color-text-primary);
  }

  .header__count {
    display: none;
  }

  .sidebar {
    transform: translateX(-100%);
  }

  .sidebar.is-open {
    transform: translateX(0);
  }

  .sidebar-overlay {
    display: block;
  }

  .main {
    margin-left: 0;
    padding: var(--space-4);
  }

  .grid {
    grid-template-columns: 1fr;
  }

  .panel {
    width: 100%;
    min-width: unset;
    max-width: unset;
    border-radius: 0;
  }

  .list-item__preview {
    width: 60px;
    height: 45px;
  }
}

/* ============================================================
   SCROLLBAR
   ============================================================ */
.sidebar::-webkit-scrollbar {
  width: 6px;
}

.sidebar::-webkit-scrollbar-track {
  background: transparent;
}

.sidebar::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: 3px;
}

.sidebar::-webkit-scrollbar-thumb:hover {
  background: var(--color-border-strong);
}
</style>
</head>
<body>
<!-- GSAP -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/TextPlugin.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Flip.min.js"></script>
<script>gsap.registerPlugin(ScrollTrigger, TextPlugin, Flip);</script>
<script src="animations/gsap-utils.js"></script>

<!-- ============================================================
     HEADER
     ============================================================ -->
<header class="header" role="banner">
  <button class="header__menu-btn" aria-label="Open sidebar" id="menuBtn">
    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round">
      <line x1="3" y1="5" x2="15" y2="5"/>
      <line x1="3" y1="9" x2="15" y2="9"/>
      <line x1="3" y1="13" x2="15" y2="13"/>
    </svg>
  </button>

  <div class="header__brand">
    <div class="header__logo" aria-hidden="true">
      <svg width="16" height="16" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="5" height="5" rx="1"/>
        <rect x="10" y="3" width="5" height="5" rx="1"/>
        <rect x="3" y="10" width="5" height="5" rx="1"/>
        <rect x="10" y="10" width="5" height="5" rx="1"/>
      </svg>
    </div>
    <h1 class="header__title">UI Vault</h1>
  </div>

  <div class="header__search">
    <div class="header__search-icon" aria-hidden="true">
      <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round">
        <circle cx="8" cy="8" r="5"/>
        <line x1="12" y1="12" x2="15.5" y2="15.5"/>
      </svg>
    </div>
    <input
      type="search"
      class="header__search-input"
      id="searchInput"
      placeholder="Search designs..."
      aria-label="Search designs"
      autocomplete="off"
    >
  </div>

  <div class="header__actions">
    <span class="header__count" id="designCount">0 designs</span>

    <button class="header__btn is-active" id="gridViewBtn" aria-label="Grid view" title="Grid view">
      <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
        <rect x="2" y="2" width="6" height="6" rx="1"/>
        <rect x="10" y="2" width="6" height="6" rx="1"/>
        <rect x="2" y="10" width="6" height="6" rx="1"/>
        <rect x="10" y="10" width="6" height="6" rx="1"/>
      </svg>
    </button>

    <button class="header__btn" id="listViewBtn" aria-label="List view" title="List view">
      <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round">
        <line x1="3" y1="4.5" x2="15" y2="4.5"/>
        <line x1="3" y1="9" x2="15" y2="9"/>
        <line x1="3" y1="13.5" x2="15" y2="13.5"/>
      </svg>
    </button>

    <button class="header__btn" id="themeBtn" aria-label="Toggle dark mode" title="Toggle dark mode">
      <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" id="themeIcon">
      </svg>
    </button>
  </div>
</header>

<!-- ============================================================
     SIDEBAR
     ============================================================ -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>
<nav class="sidebar" id="sidebar" role="navigation" aria-label="Design categories">
  <div class="sidebar__section">
    <button class="sidebar__item is-active" data-filter="all" role="tab" aria-selected="true" tabindex="0">
      <span class="sidebar__item-icon" aria-hidden="true">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="2" width="6" height="6" rx="1"/>
          <rect x="10" y="2" width="6" height="6" rx="1"/>
          <rect x="2" y="10" width="6" height="6" rx="1"/>
          <rect x="10" y="10" width="6" height="6" rx="1"/>
        </svg>
      </span>
      <span class="sidebar__item-label">All Designs</span>
      <span class="sidebar__item-count" id="allCount">0</span>
    </button>
    <button class="sidebar__item" data-filter="favorites" role="tab" aria-selected="false" tabindex="0">
      <span class="sidebar__item-icon" aria-hidden="true">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="9,2 11.3,6.6 16.3,7.4 12.6,11 13.5,16 9,13.6 4.5,16 5.4,11 1.7,7.4 6.7,6.6"/>
        </svg>
      </span>
      <span class="sidebar__item-label">Favorites</span>
      <span class="sidebar__item-count" id="favCount">0</span>
    </button>
  </div>
  <div class="sidebar__separator"></div>
  <div class="sidebar__label">Categories</div>
  <div class="sidebar__section" id="categoryList">
  </div>
</nav>

<!-- ============================================================
     MAIN
     ============================================================ -->
<main class="main" id="main" role="main">
  <div class="grid" id="cardGrid">
  </div>
  <div class="list" id="listView">
  </div>
  <div class="empty-state" id="emptyState" style="display: none;">
    <div class="empty-state__icon" id="emptyIcon" aria-hidden="true"></div>
    <div class="empty-state__title" id="emptyTitle"></div>
    <div class="empty-state__desc" id="emptyDesc"></div>
  </div>
</main>

<!-- ============================================================
     PREVIEW PANEL
     ============================================================ -->
<div class="panel-overlay" id="panelOverlay"></div>
<aside class="panel" id="panel" role="dialog" aria-label="Design preview" aria-hidden="true">
  <div class="panel__header">
    <h2 class="panel__title" id="panelTitle">Design Title</h2>
    <button class="panel__btn" id="panelExternal" aria-label="Open in new tab" title="Open in new tab">
      <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
        <path d="M13.5 10.5v3a1.5 1.5 0 0 1-1.5 1.5H4.5A1.5 1.5 0 0 1 3 13.5V6a1.5 1.5 0 0 1 1.5-1.5h3"/>
        <polyline points="10.5 3 15 3 15 7.5"/>
        <line x1="7.5" y1="10.5" x2="15" y2="3"/>
      </svg>
    </button>
    <button class="panel__btn panel__btn--inspector" id="inspectorToggle" aria-label="Toggle inspector" title="Toggle inspector">
      <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="9" cy="9" r="2.5"/>
        <path d="M14.7 11.1a1.2 1.2 0 0 0 .24 1.32l.04.04a1.44 1.44 0 1 1-2.04 2.04l-.04-.04a1.2 1.2 0 0 0-1.32-.24 1.2 1.2 0 0 0-.72 1.1v.12a1.44 1.44 0 1 1-2.88 0v-.06a1.2 1.2 0 0 0-.78-1.1 1.2 1.2 0 0 0-1.32.24l-.04.04a1.44 1.44 0 1 1-2.04-2.04l.04-.04a1.2 1.2 0 0 0 .24-1.32 1.2 1.2 0 0 0-1.1-.72h-.12a1.44 1.44 0 0 1 0-2.88h.06a1.2 1.2 0 0 0 1.1-.78 1.2 1.2 0 0 0-.24-1.32l-.04-.04a1.44 1.44 0 1 1 2.04-2.04l.04.04a1.2 1.2 0 0 0 1.32.24h.06a1.2 1.2 0 0 0 .72-1.1v-.12a1.44 1.44 0 0 1 2.88 0v.06a1.2 1.2 0 0 0 .72 1.1 1.2 1.2 0 0 0 1.32-.24l.04-.04a1.44 1.44 0 1 1 2.04 2.04l-.04.04a1.2 1.2 0 0 0-.24 1.32v.06a1.2 1.2 0 0 0 1.1.72h.12a1.44 1.44 0 0 1 0 2.88h-.06a1.2 1.2 0 0 0-1.1.72z"/>
      </svg>
    </button>
    <button class="panel__btn" id="panelClose" aria-label="Close preview" title="Close preview">
      <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round">
        <line x1="4.5" y1="4.5" x2="13.5" y2="13.5"/>
        <line x1="13.5" y1="4.5" x2="4.5" y2="13.5"/>
      </svg>
    </button>
  </div>
  <div class="panel__body">
    <iframe class="panel__iframe" id="panelIframe" title="Design preview"></iframe>
    <!-- Inspector Sidebar -->
  <div class="inspector" id="inspector">
    <div class="inspector__header">
      <span class="inspector__title">Inspector</span>
      <button class="inspector__close" id="inspectorClose" aria-label="Close inspector">
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round">
          <line x1="3" y1="3" x2="11" y2="11"/><line x1="11" y1="3" x2="3" y2="11"/>
        </svg>
      </button>
    </div>
    <div class="inspector__sections">

      <!-- Color Section -->
      <div class="inspector__section is-open" data-section="color">
        <button class="inspector__section-toggle" aria-expanded="true">
          <span>Color</span>
          <svg class="inspector__section-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"><polyline points="3 4.5 6 7.5 9 4.5"/></svg>
        </button>
        <div class="inspector__section-content">
          <div class="inspector__section-inner">
            <div class="inspector__label">Accent</div>
            <div class="inspector__swatches" id="accentPicker"></div>
            <div class="inspector__hex-row">
              <div class="inspector__hex-preview" id="hexPreview"></div>
              <input type="text" class="inspector__hex-input" id="hexInput" placeholder="#D97706" maxlength="7" spellcheck="false">
            </div>
            <div class="inspector__slider-row">
              <div class="inspector__label">Background <span class="inspector__label-value" id="bgDarknessValue">50%</span></div>
              <input type="range" class="inspector__slider" id="bgDarknessSlider" min="0" max="100" step="5" value="50">
            </div>
            <div class="inspector__slider-row">
              <div class="inspector__label">Surface Tint <span class="inspector__label-value" id="surfaceTintValue">0%</span></div>
              <input type="range" class="inspector__slider" id="surfaceTintSlider" min="0" max="100" step="5" value="0">
            </div>
          </div>
        </div>
      </div>

      <!-- Typography Section -->
      <div class="inspector__section" data-section="type">
        <button class="inspector__section-toggle" aria-expanded="false">
          <span>Typography</span>
          <svg class="inspector__section-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"><polyline points="3 4.5 6 7.5 9 4.5"/></svg>
        </button>
        <div class="inspector__section-content">
          <div class="inspector__section-inner">
            <div class="inspector__label">Font Family</div>
            <div class="inspector__font-chips" id="fontPicker"></div>
            <div class="inspector__label">Size</div>
            <div class="inspector__toggle-group" id="fontSizeGroup">
              <button class="inspector__toggle-btn" data-size="14">Compact</button>
              <button class="inspector__toggle-btn is-active" data-size="16">Default</button>
              <button class="inspector__toggle-btn" data-size="18">Relaxed</button>
              <button class="inspector__toggle-btn" data-size="20">Large</button>
            </div>
            <div class="inspector__label">Weight</div>
            <div class="inspector__toggle-group" id="fontWeightGroup">
              <button class="inspector__toggle-btn" data-weight="300">Light</button>
              <button class="inspector__toggle-btn is-active" data-weight="400">Regular</button>
              <button class="inspector__toggle-btn" data-weight="500">Medium</button>
              <button class="inspector__toggle-btn" data-weight="600">Semi</button>
            </div>
            <div class="inspector__slider-row">
              <div class="inspector__label">Line Height <span class="inspector__label-value" id="lineHeightValue">1.5</span></div>
              <input type="range" class="inspector__slider" id="lineHeightSlider" min="1.2" max="2.0" step="0.1" value="1.5">
            </div>
          </div>
        </div>
      </div>

      <!-- Shape Section -->
      <div class="inspector__section" data-section="shape">
        <button class="inspector__section-toggle" aria-expanded="false">
          <span>Shape</span>
          <svg class="inspector__section-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"><polyline points="3 4.5 6 7.5 9 4.5"/></svg>
        </button>
        <div class="inspector__section-content">
          <div class="inspector__section-inner">
            <div class="inspector__slider-row">
              <div class="inspector__label">Radius <span class="inspector__label-value" id="radiusValue">--</span></div>
              <input type="range" class="inspector__slider" id="radiusSlider" min="0" max="32" step="1" value="12">
            </div>
            <div class="inspector__label">Border Width</div>
            <div class="inspector__toggle-group" id="borderWidthGroup">
              <button class="inspector__toggle-btn" data-border="0">None</button>
              <button class="inspector__toggle-btn is-active" data-border="1">Subtle</button>
              <button class="inspector__toggle-btn" data-border="2">Medium</button>
              <button class="inspector__toggle-btn" data-border="3">Bold</button>
            </div>
            <div class="inspector__slider-row">
              <div class="inspector__label">Shadow <span class="inspector__label-value" id="shadowValue">50%</span></div>
              <input type="range" class="inspector__slider" id="shadowSlider" min="0" max="100" step="10" value="50">
            </div>
          </div>
        </div>
      </div>

      <!-- Presets Section -->
      <div class="inspector__section" data-section="presets">
        <button class="inspector__section-toggle" aria-expanded="false">
          <span>Presets</span>
          <svg class="inspector__section-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"><polyline points="3 4.5 6 7.5 9 4.5"/></svg>
        </button>
        <div class="inspector__section-content">
          <div class="inspector__section-inner">
            <div class="inspector__presets" id="presetPicker"></div>
            <button class="inspector__reset-btn" id="resetBtn">Reset to Defaults</button>
          </div>
        </div>
      </div>

    </div>
  </div>
  </div><!-- panel__body -->
  <div class="panel__footer">
    <div class="panel__notes-label">Notes</div>
    <textarea
      class="panel__notes"
      id="panelNotes"
      placeholder="Add notes about this design..."
      aria-label="Design notes"
    ></textarea>
    <div class="panel__save-status" id="saveStatus"></div>
  </div>
</aside>

<!-- ============================================================
     JAVASCRIPT
     ============================================================ -->
<script>
(function() {
  'use strict';

  /* ===========================================================
     DATA LAYER
     =========================================================== */

  var CATALOG_DATA = [
    {
      "id": "hero-gradient-mesh",
      "title": "Gradient Mesh Hero",
      "category": "Heroes",
      "type": "full-page",
      "tags": ["gradient", "mesh", "animation", "dark", "landing", "gsap"],
      "filePath": "designs/hero-gradient-mesh.html",
      "description": "Animated OKLCH gradient mesh with GSAP-driven blob drift, hue rotation on CSS custom properties, and typewriter hero text.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["timeline", "hoverScale", "scrollParallax", "customProperty"],
      "animation_count": 9,
      "plugins_used": ["ScrollTrigger"]
    },
    {
      "id": "card-glassmorphism",
      "title": "Glassmorphism Cards",
      "category": "Cards",
      "type": "component",
      "tags": ["glass", "blur", "frosted", "dark", "hover", "gsap"],
      "filePath": "designs/card-glassmorphism.html",
      "description": "Three frosted glass cards with GSAP stagger entrance, hover lift, and inner-element reveal sequences.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["staggerSequence", "hoverLift", "fadeIn"],
      "animation_count": 4,
      "plugins_used": []
    },
    {
      "id": "dashboard-analytics",
      "title": "Analytics Dashboard",
      "category": "Dashboards",
      "type": "full-page",
      "tags": ["dashboard", "charts", "stats", "table", "sidebar", "gsap"],
      "filePath": "designs/dashboard-analytics.html",
      "description": "Full analytics dashboard with GSAP number countup, animated bar charts, panel slide-ins, and hover interactions.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["slideIn", "hoverScale", "numberCountup", "staggerSequence"],
      "animation_count": 7,
      "plugins_used": []
    },
    {
      "id": "nav-floating-pill",
      "title": "Floating Pill Navigation",
      "category": "Navigation",
      "type": "component",
      "tags": ["navbar", "pill", "sliding", "blur", "dark", "gsap", "flip"],
      "filePath": "designs/nav-floating-pill.html",
      "description": "Floating navbar with Flip-powered pill indicator, GSAP nav entrance, and glow pulse effects.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["flipLayout", "fadeIn", "hoverScale"],
      "animation_count": 5,
      "plugins_used": ["Flip"]
    },
    {
      "id": "form-multi-step",
      "title": "Multi-Step Wizard Form",
      "category": "Forms",
      "type": "component",
      "tags": ["form", "wizard", "steps", "progress", "animation", "gsap"],
      "filePath": "designs/form-multi-step.html",
      "description": "3-step wizard with GSAP step transitions, animated progress bar fill, shake validation, and completion effects.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["timeline", "fadeIn", "fadeOut", "shakeInput"],
      "animation_count": 6,
      "plugins_used": []
    },
    {
      "id": "layout-bento-grid",
      "title": "Bento Grid Feature Showcase",
      "category": "Layouts",
      "type": "full-page",
      "tags": ["bento", "grid", "earth-tones", "warm", "cards", "gsap"],
      "filePath": "designs/layout-bento-grid.html",
      "description": "Mixed-size bento grid with GSAP stagger entrance, scroll reveal, and hover scale interactions.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["staggerSequence", "scrollReveal", "hoverScale"],
      "animation_count": 3,
      "plugins_used": ["ScrollTrigger"]
    },
    {
      "id": "pricing-neon-table",
      "title": "Neon Pricing Table",
      "category": "Pricing",
      "type": "component",
      "tags": ["pricing", "neon", "glow", "cyberpunk", "dark", "gsap"],
      "filePath": "designs/pricing-neon-table.html",
      "description": "Cyberpunk pricing columns with GSAP glow pulse, staggered card/feature entrance, and neon hover intensification.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["staggerSequence", "scaleIn", "hoverScale", "glowPulse"],
      "animation_count": 6,
      "plugins_used": []
    },
    {
      "id": "section-testimonial-marquee",
      "title": "Testimonial Marquee",
      "category": "Sections",
      "type": "component",
      "tags": ["testimonial", "marquee", "scroll", "editorial", "organic", "gsap"],
      "filePath": "designs/section-testimonial-marquee.html",
      "description": "Dual-row GSAP-powered infinite marquee with smooth timeScale pause on hover and card lift effects.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["timeline", "hoverLift", "infiniteScroll"],
      "animation_count": 4,
      "plugins_used": []
    },
    {
      "id": "form-split-login",
      "title": "Split Login Screen",
      "category": "Forms",
      "type": "full-page",
      "tags": ["login", "split", "auth", "indigo", "social", "gsap"],
      "filePath": "designs/form-split-login.html",
      "description": "50/50 split login with 6 GSAP orbital drift timelines, form stagger entrance, and interactive focus/hover effects.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["timeline", "staggerSequence", "hoverScale", "orbitalDrift"],
      "animation_count": 8,
      "plugins_used": []
    },
    {
      "id": "footer-mega",
      "title": "Premium Mega Footer",
      "category": "Footers",
      "type": "component",
      "tags": ["footer", "mega", "newsletter", "gradient", "columns", "gsap"],
      "filePath": "designs/footer-mega.html",
      "description": "Mega footer with GSAP scroll-reveal columns, newsletter focus glow, subscribe hover effect, and social icon staggers.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["scrollReveal", "hoverScale", "hoverLift", "fadeIn"],
      "animation_count": 6,
      "plugins_used": ["ScrollTrigger"]
    },
    {
      "id": "hero-kinetic-typography",
      "title": "Kinetic Typography Hero",
      "category": "Heroes",
      "type": "full-page",
      "tags": ["typography", "kinetic", "animation", "editorial", "minimal", "gsap"],
      "filePath": "designs/hero-kinetic-typography.html",
      "description": "Word-by-word GSAP stagger hero with accent pulse, subtitle timeline, and CTA underline hover animation.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["staggerSequence", "timeline", "hoverScale"],
      "animation_count": 4,
      "plugins_used": []
    },
    {
      "id": "card-toast-notifications",
      "title": "Toast Notification Stack",
      "category": "Cards",
      "type": "component",
      "tags": ["toast", "notification", "status", "slide-in", "progress", "gsap"],
      "filePath": "designs/card-toast-notifications.html",
      "description": "4 toast variants with GSAP slide-in, animated progress bars, dismiss effects, and replay-all functionality.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["slideIn", "timeline", "fadeOut"],
      "animation_count": 5,
      "plugins_used": []
    },
    {
      "id": "nav-vertical-sidebar",
      "title": "Vertical Sidebar Navigation",
      "category": "Navigation",
      "type": "component",
      "tags": ["sidebar", "vertical", "collapsible", "dark", "app", "gsap"],
      "filePath": "designs/nav-vertical-sidebar.html",
      "description": "Collapsible sidebar with GSAP width/opacity transitions, teams expand animation, mobile drawer slide, and multi-element hover effects.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["timeline", "staggerSequence", "hoverScale", "slideIn"],
      "animation_count": 10,
      "plugins_used": []
    },
    {
      "id": "gsap-scroll-showcase",
      "title": "GSAP Scroll Showcase",
      "category": "GSAP",
      "type": "full-page",
      "tags": ["gsap", "scrolltrigger", "pin", "scrub", "parallax", "countup"],
      "filePath": "designs/gsap-scroll-showcase.html",
      "description": "Multi-section scroll story: horizontal scroll, scrub progress bars, parallax depth layers, number countup, and pinned fade sequences.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["scrollTrigger", "pin", "scrub", "parallax", "numberCountup", "timeline"],
      "animation_count": 12,
      "plugins_used": ["ScrollTrigger"]
    },
    {
      "id": "gsap-text-effects",
      "title": "GSAP Text Effects",
      "category": "GSAP",
      "type": "full-page",
      "tags": ["gsap", "text", "typewriter", "scramble", "typography", "stagger"],
      "filePath": "designs/gsap-text-effects.html",
      "description": "Typography animation gallery: typewriter, character reveal, word bounce, scramble decode, gradient sweep, line slide, and scale-blur effects.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["typewriter", "textRevealByLine", "staggerSequence", "scramble"],
      "animation_count": 8,
      "plugins_used": ["TextPlugin", "ScrollTrigger"]
    },
    {
      "id": "gsap-flip-gallery",
      "title": "GSAP Flip Gallery",
      "category": "GSAP",
      "type": "full-page",
      "tags": ["gsap", "flip", "gallery", "filter", "grid", "masonry", "layout"],
      "filePath": "designs/gsap-flip-gallery.html",
      "description": "Interactive gallery with Flip-powered layout switching (grid, list, masonry) and category filtering with smooth position animations.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["flipLayout", "staggerSequence", "hoverLift", "filter"],
      "animation_count": 6,
      "plugins_used": ["Flip"]
    },
    {
      "id": "gsap-micro-interactions",
      "title": "GSAP Micro Interactions",
      "category": "GSAP",
      "type": "full-page",
      "tags": ["gsap", "micro", "buttons", "toggles", "inputs", "hover", "click"],
      "filePath": "designs/gsap-micro-interactions.html",
      "description": "Micro-interactions collection: magnetic/ripple/elastic buttons, slide/bounce/liquid toggles, floating labels, tilt cards, and loading animations.",
      "dateAdded": "2026-02-22",
      "gsap_features": ["hoverScale", "timeline", "scrollReveal", "elastic", "magnetic"],
      "animation_count": 16,
      "plugins_used": ["ScrollTrigger"]
    },
    {
      "id": "widget-command-palette",
      "title": "Command Palette",
      "category": "Cards",
      "type": "component",
      "tags": ["command", "palette", "search", "keyboard", "spotlight", "gsap"],
      "filePath": "designs/widget-command-palette.html",
      "description": "macOS Spotlight-style command palette with search, grouped results, keyboard navigation, and GSAP overlay animations.",
      "dateAdded": "2026-02-23",
      "gsap_features": ["scaleIn", "staggerSequence", "fadeIn", "fadeOut"],
      "animation_count": 6,
      "plugins_used": []
    },
    {
      "id": "dashboard-data-table",
      "title": "Data Table",
      "category": "Dashboards",
      "type": "component",
      "tags": ["table", "data", "sortable", "pagination", "select", "gsap"],
      "filePath": "designs/dashboard-data-table.html",
      "description": "Professional data table with sortable columns, row selection, bulk actions, pagination, and GSAP stagger entrance.",
      "dateAdded": "2026-02-23",
      "gsap_features": ["staggerSequence", "fadeIn", "slideIn", "hoverScale"],
      "animation_count": 5,
      "plugins_used": []
    },
    {
      "id": "layout-kanban-board",
      "title": "Kanban Board",
      "category": "Layouts",
      "type": "full-page",
      "tags": ["kanban", "board", "tasks", "columns", "cards", "gsap"],
      "filePath": "designs/layout-kanban-board.html",
      "description": "Trello-style kanban board with 4 columns, task cards, priority labels, tags, and GSAP column/card stagger entrance.",
      "dateAdded": "2026-02-23",
      "gsap_features": ["staggerSequence", "fadeIn", "slideIn", "hoverLift"],
      "animation_count": 7,
      "plugins_used": []
    },
    {
      "id": "pricing-feature-comparison",
      "title": "Feature Comparison",
      "category": "Pricing",
      "type": "component",
      "tags": ["pricing", "comparison", "features", "toggle", "tiers", "gsap"],
      "filePath": "designs/pricing-feature-comparison.html",
      "description": "3-tier feature comparison with monthly/yearly toggle, animated price countup, check/cross indicators, and GSAP column entrance.",
      "dateAdded": "2026-02-23",
      "gsap_features": ["scaleIn", "staggerSequence", "numberCountup", "hoverLift"],
      "animation_count": 6,
      "plugins_used": []
    },
    {
      "id": "section-team-showcase",
      "title": "Team Showcase",
      "category": "Sections",
      "type": "component",
      "tags": ["team", "showcase", "cards", "flip", "bio", "gsap"],
      "filePath": "designs/section-team-showcase.html",
      "description": "3x2 team member grid with GSAP-powered card flip to reveal bio, social links, and scroll-triggered stagger entrance.",
      "dateAdded": "2026-02-23",
      "gsap_features": ["scrollReveal", "staggerSequence", "scaleIn", "timeline"],
      "animation_count": 6,
      "plugins_used": ["ScrollTrigger"]
    },
    {
      "id": "section-faq-accordion",
      "title": "FAQ Accordion",
      "category": "Sections",
      "type": "component",
      "tags": ["faq", "accordion", "search", "tabs", "expand", "gsap"],
      "filePath": "designs/section-faq-accordion.html",
      "description": "FAQ section with search filter, category tabs, GSAP height-animated accordion, and scroll-reveal entrance.",
      "dateAdded": "2026-02-23",
      "gsap_features": ["scrollReveal", "staggerSequence", "timeline", "fadeIn"],
      "animation_count": 7,
      "plugins_used": ["ScrollTrigger"]
    },
    {
      "id": "widget-chat",
      "title": "Chat Widget",
      "category": "Cards",
      "type": "component",
      "tags": ["chat", "widget", "messenger", "bubble", "typing", "gsap"],
      "filePath": "designs/widget-chat.html",
      "description": "Floating chat widget with expandable window, message history, typing indicator, and GSAP bubble/message animations.",
      "dateAdded": "2026-02-23",
      "gsap_features": ["scaleIn", "slideIn", "staggerSequence", "timeline"],
      "animation_count": 8,
      "plugins_used": []
    },
    {
      "id": "form-file-upload",
      "title": "File Upload Dropzone",
      "category": "Forms",
      "type": "component",
      "tags": ["upload", "dropzone", "drag", "progress", "files", "gsap"],
      "filePath": "designs/form-file-upload.html",
      "description": "Drag-and-drop file upload with progress bars, preview thumbnails, error states, and GSAP entrance/progress animations.",
      "dateAdded": "2026-02-23",
      "gsap_features": ["scaleIn", "slideIn", "timeline", "fadeIn"],
      "animation_count": 6,
      "plugins_used": []
    },
    {
      "id": "layout-blog-post",
      "title": "Blog Post Layout",
      "category": "Layouts",
      "type": "full-page",
      "tags": ["blog", "editorial", "article", "toc", "reading", "gsap"],
      "filePath": "designs/layout-blog-post.html",
      "description": "Premium editorial blog post with hero, sticky TOC sidebar, reading progress bar, and GSAP scroll-driven animations.",
      "dateAdded": "2026-02-23",
      "gsap_features": ["scrollReveal", "textRevealByLine", "scrollParallax", "staggerSequence"],
      "animation_count": 8,
      "plugins_used": ["ScrollTrigger"]
    },
    {
      "id": "section-gallery-lightbox",
      "title": "Image Gallery Lightbox",
      "category": "Sections",
      "type": "component",
      "tags": ["gallery", "lightbox", "images", "masonry", "zoom", "gsap"],
      "filePath": "designs/section-gallery-lightbox.html",
      "description": "3-column image gallery with GSAP-powered lightbox, keyboard navigation, prev/next transitions, and scroll-reveal entrance.",
      "dateAdded": "2026-02-23",
      "gsap_features": ["scrollReveal", "scaleIn", "fadeIn", "slideIn"],
      "animation_count": 7,
      "plugins_used": ["ScrollTrigger"]
    }
  ];

  /* ---- localStorage helpers ---- */
  function getFavorites() {
    try { return JSON.parse(localStorage.getItem('ui-vault-favorites') || '[]'); }
    catch(e) { return []; }
  }

  function setFavorite(id, isFav) {
    var favs = getFavorites();
    var idx = favs.indexOf(id);
    if (isFav && idx === -1) { favs.push(id); }
    else if (!isFav && idx !== -1) { favs.splice(idx, 1); }
    localStorage.setItem('ui-vault-favorites', JSON.stringify(favs));
    updateFavCount();
  }

  function isFavorite(id) {
    return getFavorites().indexOf(id) !== -1;
  }

  function getNotes(id) {
    return localStorage.getItem('ui-vault-note-' + id) || '';
  }

  function setNotes(id, text) {
    if (text) { localStorage.setItem('ui-vault-note-' + id, text); }
    else { localStorage.removeItem('ui-vault-note-' + id); }
  }

  function getViewPref() {
    return localStorage.getItem('ui-vault-view') || 'grid';
  }

  function setViewPref(view) {
    localStorage.setItem('ui-vault-view', view);
  }

  /* ---- Filtering ---- */
  var currentFilter = 'all';
  var currentSearch = '';

  function getFilteredDesigns() {
    var favs = getFavorites();
    return CATALOG_DATA.filter(function(d) {
      if (currentFilter === 'favorites' && favs.indexOf(d.id) === -1) return false;
      if (currentFilter !== 'all' && currentFilter !== 'favorites' && d.category !== currentFilter) return false;

      if (currentSearch) {
        var q = currentSearch.toLowerCase();
        var haystack = (d.title + ' ' + d.category + ' ' + (d.tags || []).join(' ')).toLowerCase();
        return haystack.indexOf(q) !== -1;
      }
      return true;
    });
  }

  function getCategories() {
    var cats = {};
    CATALOG_DATA.forEach(function(d) {
      cats[d.category] = (cats[d.category] || 0) + 1;
    });
    return cats;
  }

  /* ===========================================================
     DOM REFERENCES
     =========================================================== */
  var searchInput     = document.getElementById('searchInput');
  var designCountEl   = document.getElementById('designCount');
  var gridViewBtn     = document.getElementById('gridViewBtn');
  var listViewBtn     = document.getElementById('listViewBtn');
  var themeBtn        = document.getElementById('themeBtn');
  var themeIcon       = document.getElementById('themeIcon');
  var menuBtn         = document.getElementById('menuBtn');
  var sidebar         = document.getElementById('sidebar');
  var sidebarOverlay  = document.getElementById('sidebarOverlay');
  var categoryListEl  = document.getElementById('categoryList');
  var allCount        = document.getElementById('allCount');
  var favCountEl      = document.getElementById('favCount');
  var cardGrid        = document.getElementById('cardGrid');
  var listView        = document.getElementById('listView');
  var emptyStateEl    = document.getElementById('emptyState');
  var emptyIcon       = document.getElementById('emptyIcon');
  var emptyTitle      = document.getElementById('emptyTitle');
  var emptyDesc       = document.getElementById('emptyDesc');
  var panel           = document.getElementById('panel');
  var panelOverlay    = document.getElementById('panelOverlay');
  var panelTitle      = document.getElementById('panelTitle');
  var panelIframe     = document.getElementById('panelIframe');
  var panelClose      = document.getElementById('panelClose');
  var panelExternal   = document.getElementById('panelExternal');
  var panelNotes      = document.getElementById('panelNotes');
  var saveStatus      = document.getElementById('saveStatus');

  var currentPanelId = null;
  var notesTimer = null;

  /* ===========================================================
     SVG ICON HELPERS
     =========================================================== */
  var ICONS = {
    sun: '<circle cx="9" cy="9" r="3.5"/><line x1="9" y1="1.5" x2="9" y2="3"/><line x1="9" y1="15" x2="9" y2="16.5"/><line x1="2.7" y1="2.7" x2="3.75" y2="3.75"/><line x1="14.25" y1="14.25" x2="15.3" y2="15.3"/><line x1="1.5" y1="9" x2="3" y2="9"/><line x1="15" y1="9" x2="16.5" y2="9"/><line x1="2.7" y1="15.3" x2="3.75" y2="14.25"/><line x1="14.25" y1="3.75" x2="15.3" y2="2.7"/>',
    moon: '<path d="M15.1 10.4A6.5 6.5 0 0 1 7.6 2.9a6.5 6.5 0 1 0 7.5 7.5Z"/>',
    starOutline: '<polygon points="9,2 11.3,6.6 16.3,7.4 12.6,11 13.5,16 9,13.6 4.5,16 5.4,11 1.7,7.4 6.7,6.6"/>',
    starFilled: '<polygon points="9,2 11.3,6.6 16.3,7.4 12.6,11 13.5,16 9,13.6 4.5,16 5.4,11 1.7,7.4 6.7,6.6" fill="currentColor"/>',
    folder: '<path d="M2 5a1 1 0 0 1 1-1h4l2 2h6a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V5Z"/>',
    search: '<circle cx="8" cy="8" r="5"/><line x1="12" y1="12" x2="15.5" y2="15.5"/>'
  };

  function svgWrap(inner, size) {
    size = size || 18;
    return '<svg width="' + size + '" height="' + size + '" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">' + inner + '</svg>';
  }

  var CATEGORY_ICONS = {
    heroes: '<rect x="2" y="4" width="14" height="10" rx="1.5"/><line x1="6" y1="8" x2="12" y2="8"/><line x1="7" y1="11" x2="11" y2="11"/>',
    cards: '<rect x="3" y="3" width="12" height="12" rx="1.5"/><line x1="6" y1="7" x2="12" y2="7"/><line x1="6" y1="10" x2="10" y2="10"/>',
    dashboards: '<rect x="2" y="2" width="6" height="5" rx="1"/><rect x="10" y="2" width="6" height="8" rx="1"/><rect x="2" y="9" width="6" height="7" rx="1"/><rect x="10" y="12" width="6" height="4" rx="1"/>',
    navigation: '<line x1="3" y1="5" x2="15" y2="5"/><line x1="3" y1="9" x2="15" y2="9"/><line x1="3" y1="13" x2="15" y2="13"/>',
    forms: '<rect x="3" y="3" width="12" height="3" rx="1"/><rect x="3" y="8" width="12" height="3" rx="1"/><rect x="3" y="13" width="6" height="3" rx="1"/>',
    layouts: '<rect x="2" y="2" width="14" height="3" rx="1"/><rect x="2" y="7" width="5" height="9" rx="1"/><rect x="9" y="7" width="7" height="9" rx="1"/>',
    pricing: '<circle cx="9" cy="9" r="6"/><path d="M9 5.5v7"/><path d="M6.5 7.5c0-1.1 1.1-2 2.5-2s2.5.9 2.5 2-1.1 1.5-2.5 1.5-2.5.9-2.5 2 1.1 2 2.5 2 2.5-.9 2.5-2"/>',
    footers: '<rect x="2" y="10" width="14" height="5" rx="1.5"/><line x1="5" y1="12.5" x2="13" y2="12.5"/>',
    sections: '<rect x="2" y="3" width="14" height="4" rx="1"/><rect x="2" y="9" width="14" height="4" rx="1"/>',
    other: '<circle cx="9" cy="9" r="6.5"/><circle cx="9" cy="9" r="1"/>'
  };

  /* ===========================================================
     THEME
     =========================================================== */
  function updateThemeIcon() {
    var isDark = document.documentElement.classList.contains('dark');
    themeIcon.textContent = '';
    themeIcon.insertAdjacentHTML('afterbegin', isDark ? ICONS.sun : ICONS.moon);
  }

  function toggleTheme() {
    var isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('ui-vault-theme', isDark ? 'dark' : 'light');
    updateThemeIcon();

    /* GSAP smooth theme transition */
    if (typeof gsap !== 'undefined' && !UV.prefersReducedMotion) {
      var bg = getComputedStyle(document.documentElement).getPropertyValue('--color-bg').trim();
      var surface = getComputedStyle(document.documentElement).getPropertyValue('--color-surface').trim();
      gsap.to('body', { backgroundColor: bg, duration: 0.4, ease: 'power2.inOut' });
      gsap.to('.header, .sidebar', { backgroundColor: surface, duration: 0.4, ease: 'power2.inOut' });
    }
  }

  updateThemeIcon();
  themeBtn.addEventListener('click', toggleTheme);

  /* ===========================================================
     VIEW TOGGLE
     =========================================================== */
  var currentView = getViewPref();

  function setView(view) {
    currentView = view;
    setViewPref(view);

    if (view === 'grid') {
      gridViewBtn.classList.add('is-active');
      listViewBtn.classList.remove('is-active');
      cardGrid.classList.remove('is-hidden');
      listView.classList.remove('is-active');
    } else {
      gridViewBtn.classList.remove('is-active');
      listViewBtn.classList.add('is-active');
      cardGrid.classList.add('is-hidden');
      listView.classList.add('is-active');
    }
  }

  gridViewBtn.addEventListener('click', function() { setView('grid'); });
  listViewBtn.addEventListener('click', function() { setView('list'); });

  /* ===========================================================
     MOBILE SIDEBAR
     =========================================================== */
  function openSidebar() {
    sidebar.classList.add('is-open');
    sidebarOverlay.classList.add('is-visible');

    if (typeof gsap !== 'undefined' && !UV.prefersReducedMotion) {
      gsap.to(sidebar, { x: 0, duration: 0.3, ease: 'power3.out' });
      gsap.to(sidebarOverlay, { opacity: 1, duration: 0.25, ease: 'power2.out' });
    }
  }

  function closeSidebar() {
    if (typeof gsap !== 'undefined' && !UV.prefersReducedMotion) {
      gsap.to(sidebar, {
        x: '-100%', duration: 0.25, ease: 'power2.in',
        onComplete: function() { sidebar.classList.remove('is-open'); }
      });
      gsap.to(sidebarOverlay, {
        opacity: 0, duration: 0.2, ease: 'power2.in',
        onComplete: function() { sidebarOverlay.classList.remove('is-visible'); }
      });
    } else {
      sidebar.classList.remove('is-open');
      sidebarOverlay.classList.remove('is-visible');
    }
  }

  menuBtn.addEventListener('click', openSidebar);
  sidebarOverlay.addEventListener('click', closeSidebar);

  /* ===========================================================
     SIDEBAR RENDERING
     =========================================================== */
  function renderSidebar() {
    var cats = getCategories();
    allCount.textContent = CATALOG_DATA.length;
    updateFavCount();

    /* Build category buttons using DOM methods */
    var frag = document.createDocumentFragment();
    var sortedCats = Object.keys(cats).sort();

    sortedCats.forEach(function(cat) {
      var isActive = currentFilter === cat;
      var displayName = cat.charAt(0).toUpperCase() + cat.slice(1);
      var iconMarkup = CATEGORY_ICONS[cat] || CATEGORY_ICONS.other;

      var btn = document.createElement('button');
      btn.className = 'sidebar__item' + (isActive ? ' is-active' : '');
      btn.setAttribute('data-filter', cat);
      btn.setAttribute('role', 'tab');
      btn.setAttribute('aria-selected', String(isActive));
      btn.setAttribute('tabindex', '0');

      var iconSpan = document.createElement('span');
      iconSpan.className = 'sidebar__item-icon';
      iconSpan.setAttribute('aria-hidden', 'true');
      iconSpan.insertAdjacentHTML('afterbegin', svgWrap(iconMarkup));

      var labelSpan = document.createElement('span');
      labelSpan.className = 'sidebar__item-label';
      labelSpan.textContent = displayName;

      var countSpan = document.createElement('span');
      countSpan.className = 'sidebar__item-count';
      countSpan.textContent = cats[cat];

      btn.appendChild(iconSpan);
      btn.appendChild(labelSpan);
      btn.appendChild(countSpan);
      frag.appendChild(btn);
    });

    categoryListEl.textContent = '';
    categoryListEl.appendChild(frag);

    /* Update active states on static items */
    var allItems = sidebar.querySelectorAll('.sidebar__item');
    allItems.forEach(function(item) {
      var filter = item.getAttribute('data-filter');
      if (filter === currentFilter) {
        item.classList.add('is-active');
        item.setAttribute('aria-selected', 'true');
      } else {
        item.classList.remove('is-active');
        item.setAttribute('aria-selected', 'false');
      }
    });
  }

  function updateFavCount() {
    favCountEl.textContent = getFavorites().length;
  }

  /* Handle sidebar clicks via delegation */
  sidebar.addEventListener('click', function(e) {
    var item = e.target.closest('.sidebar__item');
    if (!item) return;

    var filter = item.getAttribute('data-filter');
    if (filter === currentFilter) return;

    currentFilter = filter;
    renderSidebar();
    renderContent();

    if (window.innerWidth <= 768) { closeSidebar(); }
  });

  /* ===========================================================
     IFRAME LAZY LOADING
     =========================================================== */
  var iframeObserver = null;

  function setupIframeObserver() {
    if (iframeObserver) { iframeObserver.disconnect(); }

    if (!('IntersectionObserver' in window)) {
      document.querySelectorAll('[data-iframe-src]').forEach(function(el) {
        el.src = el.getAttribute('data-iframe-src');
      });
      return;
    }

    iframeObserver = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          var iframe = entry.target;
          var src = iframe.getAttribute('data-iframe-src');
          if (src && !iframe.src) {
            iframe.src = src;
          }
          iframeObserver.unobserve(iframe);
        }
      });
    }, { rootMargin: '200px' });

    document.querySelectorAll('[data-iframe-src]').forEach(function(el) {
      iframeObserver.observe(el);
    });
  }

  /* ===========================================================
     UTILITY
     =========================================================== */
  function escAttr(str) {
    if (!str) return '';
    return str.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
  }

  function capitalize(str) {
    return str ? str.charAt(0).toUpperCase() + str.slice(1) : '';
  }

  /* ===========================================================
     GRID RENDERING (DOM-based)
     =========================================================== */
  function renderGrid(designs) {
    cardGrid.textContent = '';
    if (designs.length === 0) return;

    var frag = document.createDocumentFragment();

    designs.forEach(function(d, i) {
      var fav = isFavorite(d.id);
      var catKey = d.category || 'other';

      /* Card article */
      var card = document.createElement('article');
      card.className = 'card';
      card.tabIndex = 0;
      card.setAttribute('data-id', d.id);
      card.setAttribute('aria-label', d.title);

      /* Preview container */
      var preview = document.createElement('div');
      preview.className = 'card__preview';

      var iframe = document.createElement('iframe');
      iframe.className = 'card__preview-iframe';
      iframe.setAttribute('data-iframe-src', d.filePath);
      iframe.title = 'Preview of ' + d.title;
      iframe.loading = 'lazy';
      iframe.sandbox = 'allow-same-origin';

      preview.appendChild(iframe);
      card.appendChild(preview);

      /* Info section */
      var info = document.createElement('div');
      info.className = 'card__info';

      var header = document.createElement('div');
      header.className = 'card__header';

      var titleSpan = document.createElement('span');
      titleSpan.className = 'card__title';
      titleSpan.textContent = d.title;

      var starBtn = document.createElement('button');
      starBtn.className = 'card__star' + (fav ? ' is-favorited' : '');
      starBtn.setAttribute('data-fav', d.id);
      starBtn.setAttribute('aria-label', fav ? 'Remove from favorites' : 'Add to favorites');
      starBtn.insertAdjacentHTML('afterbegin', svgWrap(fav ? ICONS.starFilled : ICONS.starOutline));

      header.appendChild(titleSpan);
      header.appendChild(starBtn);
      info.appendChild(header);

      /* Meta: badge + tags */
      var meta = document.createElement('div');
      meta.className = 'card__meta';

      var badge = document.createElement('span');
      badge.className = 'badge badge--' + catKey;
      badge.textContent = capitalize(catKey);
      meta.appendChild(badge);

      if (d.tags && d.tags.length) {
        d.tags.forEach(function(t) {
          var tag = document.createElement('span');
          tag.className = 'tag';
          tag.textContent = t;
          meta.appendChild(tag);
        });
      }

      info.appendChild(meta);
      card.appendChild(info);
      frag.appendChild(card);
    });

    cardGrid.appendChild(frag);
    setupIframeObserver();

    /* GSAP card entrance */
    if (typeof gsap !== 'undefined' && !UV.prefersReducedMotion) {
      gsap.from('.card', {
        opacity: 0,
        y: 16,
        duration: 0.4,
        ease: 'power3.out',
        stagger: 0.05,
      });
    }
  }

  /* ===========================================================
     LIST RENDERING (DOM-based)
     =========================================================== */
  function renderList(designs) {
    listView.textContent = '';
    if (designs.length === 0) return;

    var frag = document.createDocumentFragment();

    designs.forEach(function(d) {
      var fav = isFavorite(d.id);
      var catKey = d.category || 'other';

      var row = document.createElement('div');
      row.className = 'list-item';
      row.tabIndex = 0;
      row.setAttribute('data-id', d.id);
      row.setAttribute('aria-label', d.title);

      /* Mini preview */
      var previewWrap = document.createElement('div');
      previewWrap.className = 'list-item__preview';

      var iframe = document.createElement('iframe');
      iframe.className = 'list-item__preview-iframe';
      iframe.setAttribute('data-iframe-src', d.filePath);
      iframe.title = 'Preview of ' + d.title;
      iframe.loading = 'lazy';
      iframe.sandbox = 'allow-same-origin';

      previewWrap.appendChild(iframe);
      row.appendChild(previewWrap);

      /* Content */
      var content = document.createElement('div');
      content.className = 'list-item__content';

      var title = document.createElement('div');
      title.className = 'list-item__title';
      title.textContent = d.title;
      content.appendChild(title);

      var subtitle = document.createElement('div');
      subtitle.className = 'list-item__subtitle';

      var badge = document.createElement('span');
      badge.className = 'badge badge--' + catKey;
      badge.textContent = capitalize(catKey);
      subtitle.appendChild(badge);

      if (d.tags && d.tags.length) {
        d.tags.slice(0, 3).forEach(function(t) {
          var tag = document.createElement('span');
          tag.className = 'tag';
          tag.textContent = t;
          subtitle.appendChild(tag);
        });
      }

      content.appendChild(subtitle);
      row.appendChild(content);

      /* Actions */
      var actions = document.createElement('div');
      actions.className = 'list-item__actions';

      var starBtn = document.createElement('button');
      starBtn.className = 'list-item__star' + (fav ? ' is-favorited' : '');
      starBtn.setAttribute('data-fav', d.id);
      starBtn.setAttribute('aria-label', fav ? 'Remove from favorites' : 'Add to favorites');
      starBtn.insertAdjacentHTML('afterbegin', svgWrap(fav ? ICONS.starFilled : ICONS.starOutline));

      actions.appendChild(starBtn);
      row.appendChild(actions);
      frag.appendChild(row);
    });

    listView.appendChild(frag);
    setupIframeObserver();
  }

  /* ===========================================================
     EMPTY STATE
     =========================================================== */
  function renderEmptyState(type) {
    var icon, title, desc;

    switch(type) {
      case 'no-results':
        icon = ICONS.search;
        title = 'No results found';
        desc = 'Try a different search term or clear your filters.';
        break;
      case 'no-favorites':
        icon = ICONS.starOutline;
        title = 'No favorites yet';
        desc = 'Click the star on any design to save it here.';
        break;
      case 'empty-category':
        icon = ICONS.folder;
        title = 'No designs in this category';
        desc = 'Add designs to this category to see them here.';
        break;
      default:
        icon = ICONS.folder;
        title = 'No designs yet';
        desc = 'Add HTML files to your designs folder to get started.';
    }

    emptyIcon.textContent = '';
    emptyIcon.insertAdjacentHTML('afterbegin', svgWrap(icon, 48));
    emptyTitle.textContent = title;
    emptyDesc.textContent = desc;
    emptyStateEl.style.display = 'flex';
  }

  function hideEmptyState() {
    emptyStateEl.style.display = 'none';
  }

  /* ===========================================================
     CONTENT ORCHESTRATOR
     =========================================================== */
  function renderContent() {
    var designs = getFilteredDesigns();

    designCountEl.textContent = designs.length + ' design' + (designs.length !== 1 ? 's' : '');

    if (designs.length === 0) {
      cardGrid.textContent = '';
      listView.textContent = '';

      if (currentSearch) { renderEmptyState('no-results'); }
      else if (currentFilter === 'favorites') { renderEmptyState('no-favorites'); }
      else if (currentFilter !== 'all') { renderEmptyState('empty-category'); }
      else { renderEmptyState('empty'); }
      return;
    }

    hideEmptyState();
    renderGrid(designs);
    renderList(designs);
  }

  /* ===========================================================
     SEARCH
     =========================================================== */
  var searchTimer = null;

  searchInput.addEventListener('input', function() {
    clearTimeout(searchTimer);
    searchTimer = setTimeout(function() {
      currentSearch = searchInput.value.trim();
      renderContent();
    }, 150);
  });

  /* ===========================================================
     STAR TOGGLE (event delegation)
     =========================================================== */
  function handleStarClick(e) {
    var starBtn = e.target.closest('[data-fav]');
    if (!starBtn) return;

    e.stopPropagation();
    var id = starBtn.getAttribute('data-fav');
    var wasFav = isFavorite(id);
    setFavorite(id, !wasFav);

    document.querySelectorAll('[data-fav="' + id + '"]').forEach(function(btn) {
      if (wasFav) {
        btn.classList.remove('is-favorited');
        btn.textContent = '';
        btn.insertAdjacentHTML('afterbegin', svgWrap(ICONS.starOutline));
        btn.setAttribute('aria-label', 'Add to favorites');
      } else {
        btn.classList.add('is-favorited');
        btn.textContent = '';
        btn.insertAdjacentHTML('afterbegin', svgWrap(ICONS.starFilled));
        btn.setAttribute('aria-label', 'Remove from favorites');
        if (typeof gsap !== 'undefined') {
          gsap.fromTo(btn, { scale: 1 }, {
            scale: 1.3, duration: 0.15, yoyo: true, repeat: 1,
            ease: 'back.out(3)',
          });
        }
      }
    });

    if (currentFilter === 'favorites' && wasFav) {
      renderContent();
    }

    renderSidebar();
  }

  cardGrid.addEventListener('click', handleStarClick);
  listView.addEventListener('click', handleStarClick);

  /* ===========================================================
     CARD CLICK -> OPEN PANEL
     =========================================================== */
  function handleCardClick(e) {
    if (e.target.closest('[data-fav]')) return;
    var card = e.target.closest('[data-id]');
    if (!card) return;
    openPanel(card.getAttribute('data-id'));
  }

  function handleCardKeydown(e) {
    if (e.key === 'Enter' || e.key === ' ') {
      var card = e.target.closest('[data-id]');
      if (card && !e.target.closest('[data-fav]')) {
        e.preventDefault();
        openPanel(card.getAttribute('data-id'));
      }
    }
  }

  cardGrid.addEventListener('click', handleCardClick);
  cardGrid.addEventListener('keydown', handleCardKeydown);
  listView.addEventListener('click', handleCardClick);
  listView.addEventListener('keydown', handleCardKeydown);

  /* ===========================================================
     PREVIEW PANEL
     =========================================================== */
  function openPanel(id) {
    var design = CATALOG_DATA.find(function(d) { return d.id === id; });
    if (!design) return;

    currentPanelId = id;
    panelTitle.textContent = design.title;
    panelIframe.src = design.filePath;
    panelNotes.value = getNotes(id);
    saveStatus.textContent = '';

    /* Inspector: sync UI and inject on iframe load */
    syncInspectorUI(id);
    panelIframe.onload = function() {
      if (currentPanelId) { injectTheme(currentPanelId); }
    };

    panel.classList.add('is-open');
    panel.setAttribute('aria-hidden', 'false');
    panelOverlay.classList.add('is-visible');
    document.body.style.overflow = 'hidden';

    /* GSAP panel slide-in */
    if (typeof gsap !== 'undefined' && !UV.prefersReducedMotion) {
      gsap.to(panel, { x: 0, duration: 0.35, ease: 'power3.out' });
      gsap.to(panelOverlay, { opacity: 1, visibility: 'visible', duration: 0.3, ease: 'power2.out' });
    }

    setTimeout(function() { panelClose.focus(); }, 50);
  }

  function closePanel() {
    panel.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';

    /* Reset inspector */
    if (inspectorOpen) {
      inspectorOpen = false;
      inspectorEl.classList.remove('is-open');
      inspectorToggleBtn.classList.remove('is-active');
      panelIframe.classList.remove('inspector-active');
      if (typeof gsap !== 'undefined') {
        gsap.set(inspectorEl, { x: '100%' });
      }
    }

    /* GSAP panel slide-out */
    if (typeof gsap !== 'undefined' && !UV.prefersReducedMotion) {
      gsap.to(panel, {
        x: '100%', duration: 0.3, ease: 'power2.in',
        onComplete: function() {
          panel.classList.remove('is-open');
          panelIframe.src = 'about:blank';
          currentPanelId = null;
        }
      });
      gsap.to(panelOverlay, {
        opacity: 0, duration: 0.25, ease: 'power2.in',
        onComplete: function() {
          panelOverlay.classList.remove('is-visible');
          panelOverlay.style.visibility = 'hidden';
        }
      });
    } else {
      panel.classList.remove('is-open');
      panelOverlay.classList.remove('is-visible');
      panelIframe.src = 'about:blank';
      currentPanelId = null;
    }
  }

  panelClose.addEventListener('click', closePanel);
  panelOverlay.addEventListener('click', closePanel);

  panelExternal.addEventListener('click', function() {
    if (!currentPanelId) return;
    var design = CATALOG_DATA.find(function(d) { return d.id === currentPanelId; });
    if (design) { window.open(design.filePath, '_blank'); }
  });

  /* Escape key */
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      if (panel.classList.contains('is-open')) {
        closePanel();
      } else if (sidebar.classList.contains('is-open')) {
        closeSidebar();
      }
    }
  });

  /* Notes auto-save */
  panelNotes.addEventListener('input', function() {
    clearTimeout(notesTimer);
    saveStatus.textContent = '';

    notesTimer = setTimeout(function() {
      if (currentPanelId) {
        setNotes(currentPanelId, panelNotes.value);
        saveStatus.textContent = 'Saved';
        setTimeout(function() {
          if (saveStatus.textContent === 'Saved') {
            saveStatus.textContent = '';
          }
        }, 2000);
      }
    }, 500);
  });

  /* ===========================================================
     INSPECTOR PANEL
     =========================================================== */

  /* ---- Data Constants ---- */
  var PALETTES = [
    { id: 'original',  name: 'Original',  accent: null,      bg: null,      surface: null,      text: null,      textMuted: null,      border: null },
    { id: 'ocean',     name: 'Ocean',     accent: '#3B82F6', bg: '#0c1220', surface: '#141e30', text: '#e2e8f0', textMuted: '#94a3b8', border: 'rgba(59,130,246,0.2)' },
    { id: 'emerald',   name: 'Emerald',   accent: '#10B981', bg: '#0a1a14', surface: '#122620', text: '#d1fae5', textMuted: '#6ee7b7', border: 'rgba(16,185,129,0.2)' },
    { id: 'sunset',    name: 'Sunset',    accent: '#F59E0B', bg: '#1a1008', surface: '#261a0a', text: '#fef3c7', textMuted: '#fcd34d', border: 'rgba(245,158,11,0.2)' },
    { id: 'violet',    name: 'Violet',    accent: '#A855F7', bg: '#14081e', surface: '#1e0e2e', text: '#f3e8ff', textMuted: '#c4b5fd', border: 'rgba(168,85,247,0.2)' },
    { id: 'rose',      name: 'Rose',      accent: '#EC4899', bg: '#1a0812', surface: '#2a0e1e', text: '#fce7f3', textMuted: '#f9a8d4', border: 'rgba(236,72,153,0.2)' },
    { id: 'nord',      name: 'Nord',      accent: '#88C0D0', bg: '#2E3440', surface: '#3B4252', text: '#ECEFF4', textMuted: '#D8DEE9', border: 'rgba(136,192,208,0.2)' },
    { id: 'dracula',   name: 'Dracula',   accent: '#BD93F9', bg: '#282A36', surface: '#44475A', text: '#F8F8F2', textMuted: '#6272A4', border: 'rgba(189,147,249,0.2)' },
    { id: 'solarized', name: 'Solarized', accent: '#268BD2', bg: '#002B36', surface: '#073642', text: '#839496', textMuted: '#586E75', border: 'rgba(38,139,210,0.2)' },
    { id: 'tokyo',     name: 'Tokyo Night',accent:'#7AA2F7', bg: '#1A1B26', surface: '#24283B', text: '#C0CAF5', textMuted: '#565F89', border: 'rgba(122,162,247,0.2)' },
    { id: 'catppuccin',name: 'Catppuccin', accent: '#CBA6F7', bg: '#1E1E2E', surface: '#313244', text: '#CDD6F4', textMuted: '#A6ADC8', border: 'rgba(203,166,247,0.2)' },
    { id: 'onedark',   name: 'One Dark',  accent: '#61AFEF', bg: '#282C34', surface: '#2C313C', text: '#ABB2BF', textMuted: '#5C6370', border: 'rgba(97,175,239,0.2)' },
  ];

  var FONTS = [
    { id: 'system',    name: 'System',    stack: null },
    { id: 'serif',     name: 'Serif',     stack: "'Iowan Old Style','Palatino Linotype',Palatino,Georgia,serif" },
    { id: 'mono',      name: 'Mono',      stack: "'SF Mono',SFMono-Regular,ui-monospace,'Cascadia Code',monospace" },
    { id: 'rounded',   name: 'Rounded',   stack: "'Nunito','Varela Round',system-ui,-apple-system,sans-serif" },
    { id: 'humanist',  name: 'Humanist',  stack: "'Gill Sans','Gill Sans MT',Calibri,sans-serif" },
    { id: 'condensed', name: 'Condensed', stack: "'Roboto Condensed','Arial Narrow',sans-serif" },
  ];

  var PRESETS = [
    { id: 'original',   name: 'Original',   dot: null,      palette: 'original', font: 'system', fontSize: 16, fontWeight: 400, lineHeight: 1.5, radius: null, borderWidth: 1, shadowIntensity: 50 },
    { id: 'nord',       name: 'Nord',       dot: '#88C0D0', palette: 'nord',     font: 'serif',  fontSize: 16, fontWeight: 400, lineHeight: 1.6, radius: 12,   borderWidth: 1, shadowIntensity: 30 },
    { id: 'dracula',    name: 'Dracula',    dot: '#BD93F9', palette: 'dracula',  font: 'system', fontSize: 16, fontWeight: 400, lineHeight: 1.5, radius: 8,    borderWidth: 1, shadowIntensity: 40 },
    { id: 'solarized',  name: 'Solarized',  dot: '#268BD2', palette: 'solarized',font: 'mono',   fontSize: 14, fontWeight: 400, lineHeight: 1.5, radius: 4,    borderWidth: 1, shadowIntensity: 20 },
    { id: 'tokyo',      name: 'Tokyo Night', dot: '#7AA2F7', palette: 'tokyo',   font: 'system', fontSize: 16, fontWeight: 400, lineHeight: 1.5, radius: 10,   borderWidth: 1, shadowIntensity: 50 },
    { id: 'catppuccin', name: 'Catppuccin', dot: '#CBA6F7', palette: 'catppuccin',font:'rounded', fontSize: 16, fontWeight: 400, lineHeight: 1.6, radius: 14,   borderWidth: 1, shadowIntensity: 40 },
    { id: 'onedark',    name: 'One Dark',   dot: '#61AFEF', palette: 'onedark',  font: 'system', fontSize: 16, fontWeight: 400, lineHeight: 1.5, radius: 6,    borderWidth: 1, shadowIntensity: 40 },
    { id: 'github',     name: 'GitHub Dark', dot: '#58A6FF', palette: 'original',font: 'system', fontSize: 16, fontWeight: 400, lineHeight: 1.5, radius: 6,    borderWidth: 1, shadowIntensity: 50 },
  ];

  var THEME_MAPS = {
    'dashboard-analytics': {
      bg: ['--bg'], surface: ['--surface'], accent: ['--blue'], accentSoft: ['--blue-soft'],
      text: ['--text'], textMuted: ['--text-muted'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm'], font: ['--font']
    },
    'form-multi-step': {
      bg: ['--bg'], surface: ['--card'], accent: ['--accent'],
      text: ['--text'], textMuted: ['--text-muted'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm', '--radius-xs'], font: null
    },
    'gsap-flip-gallery': {
      bg: ['--bg'], surface: ['--surface'], accent: ['--accent'],
      text: ['--text'], textMuted: ['--text-secondary'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm', '--radius-xs'], font: ['--font']
    },
    'gsap-micro-interactions': {
      bg: ['--color-bg'], surface: ['--color-surface', '--color-surface-raised'], accent: ['--color-violet'],
      text: ['--color-text'], textMuted: ['--color-text-muted'], border: ['--color-border'],
      radius: ['--radius-md', '--radius-lg'], radiusSm: ['--radius-sm'], font: ['--font-family']
    },
    'gsap-scroll-showcase': {
      bg: ['--bg-deep', '--bg-mid'], surface: ['--bg-card'], accent: ['--accent'],
      text: ['--text-primary'], textMuted: ['--text-secondary'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm'], font: ['--font']
    },
    'layout-bento-grid': {
      bg: ['--bg'], surface: ['--surface'], accent: ['--accent-terra'],
      text: ['--text'], textMuted: ['--text-secondary'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm'], font: ['--font']
    },
    'pricing-neon-table': {
      bg: ['--bg'], surface: ['--surface', '--surface-raised'], accent: ['--neon-cyan'],
      text: ['--text'], textMuted: ['--text-muted'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm'], font: null
    },
    'nav-floating-pill': {
      bg: ['--bg-deep', '--bg-mid'], surface: ['--nav-bg'], accent: ['--pill-bg'],
      text: ['--text-active', '--text-hero'], textMuted: ['--text-idle'], border: ['--nav-border'],
      radius: null, radiusSm: null, font: null
    },
    'form-split-login': {
      bg: ['--bg-brand'], surface: ['--bg-form'], accent: ['--accent'],
      text: ['--text-primary'], textMuted: ['--text-secondary'], border: ['--input-border'],
      radius: null, radiusSm: null, font: null
    },
    'nav-vertical-sidebar': {
      bg: ['--bg'], surface: ['--hv'], accent: ['--a'],
      text: ['--t'], textMuted: ['--m'], border: null,
      radius: null, radiusSm: null, font: ['--f']
    },
    'footer-mega': {
      bg: ['--bg'], surface: ['--sf'], accent: ['--am'],
      text: ['--hd'], textMuted: ['--lk'], border: ['--sp'],
      radius: null, radiusSm: null, font: null
    },
    'card-glassmorphism': {
      bg: null, surface: ['--glass-bg'], accent: null,
      text: ['--text-primary'], textMuted: ['--text-secondary'], border: ['--glass-border'],
      radius: null, radiusSm: null, font: null
    },
    'hero-gradient-mesh': null,
    'gsap-text-effects': null,
    'hero-kinetic-typography': null,
    'card-toast-notifications': null,
    'section-testimonial-marquee': null,
    'widget-command-palette': {
      bg: ['--bg'], surface: ['--surface', '--surface-raised'], accent: ['--accent'],
      text: ['--text'], textMuted: ['--text-secondary'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm'], font: ['--font']
    },
    'dashboard-data-table': {
      bg: ['--bg'], surface: ['--surface', '--surface-raised'], accent: ['--accent'],
      text: ['--text'], textMuted: ['--text-secondary'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm'], font: ['--font']
    },
    'layout-kanban-board': {
      bg: ['--bg'], surface: ['--surface', '--surface-raised'], accent: ['--accent'],
      text: ['--text'], textMuted: ['--text-secondary'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm'], font: ['--font']
    },
    'pricing-feature-comparison': {
      bg: ['--bg'], surface: ['--surface', '--surface-raised'], accent: ['--accent'],
      text: ['--text'], textMuted: ['--text-secondary'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm'], font: ['--font']
    },
    'section-team-showcase': {
      bg: ['--bg'], surface: ['--surface', '--surface-raised'], accent: ['--accent'],
      text: ['--text'], textMuted: ['--text-secondary'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm'], font: ['--font']
    },
    'section-faq-accordion': {
      bg: ['--bg'], surface: ['--surface', '--surface-raised'], accent: ['--accent'],
      text: ['--text'], textMuted: ['--text-secondary'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm'], font: ['--font']
    },
    'widget-chat': {
      bg: ['--bg'], surface: ['--surface', '--surface-raised'], accent: ['--accent'],
      text: ['--text'], textMuted: ['--text-secondary'], border: ['--border'],
      radius: ['--radius'], radiusSm: null, font: ['--font']
    },
    'form-file-upload': {
      bg: ['--bg'], surface: ['--surface', '--surface-raised'], accent: ['--accent'],
      text: ['--text'], textMuted: ['--text-secondary'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm'], font: ['--font']
    },
    'layout-blog-post': {
      bg: ['--bg'], surface: ['--surface'], accent: ['--accent'],
      text: ['--text'], textMuted: ['--text-secondary'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm'], font: ['--font']
    },
    'section-gallery-lightbox': {
      bg: ['--bg'], surface: ['--surface', '--surface-raised'], accent: ['--accent'],
      text: ['--text'], textMuted: ['--text-secondary'], border: ['--border'],
      radius: ['--radius'], radiusSm: ['--radius-sm'], font: ['--font']
    },
  };

  /* ---- Default theme object ---- */
  var DEFAULT_THEME = {
    palette: 'original', customHex: null, bgDarkness: 50, surfaceTint: 0,
    font: 'system', fontSize: 16, fontWeight: 400, lineHeight: 1.5,
    radius: null, borderWidth: 1, shadowIntensity: 50, preset: null
  };

  /* ---- Color Utilities ---- */
  function hexToRGB(hex) {
    hex = hex.replace('#', '');
    return {
      r: parseInt(hex.substring(0, 2), 16),
      g: parseInt(hex.substring(2, 4), 16),
      b: parseInt(hex.substring(4, 6), 16)
    };
  }

  function rgbToHex(r, g, b) {
    return '#' + [r, g, b].map(function(c) {
      var h = Math.max(0, Math.min(255, Math.round(c))).toString(16);
      return h.length === 1 ? '0' + h : h;
    }).join('');
  }

  function adjustBrightness(hex, pct) {
    var rgb = hexToRGB(hex);
    var factor = pct / 50;
    return rgbToHex(rgb.r * factor, rgb.g * factor, rgb.b * factor);
  }

  function blendColors(hex1, hex2, ratio) {
    var c1 = hexToRGB(hex1);
    var c2 = hexToRGB(hex2);
    return rgbToHex(
      c1.r + (c2.r - c1.r) * ratio,
      c1.g + (c2.g - c1.g) * ratio,
      c1.b + (c2.b - c1.b) * ratio
    );
  }

  /* ---- Inspector DOM refs ---- */
  var inspectorEl = document.getElementById('inspector');
  var inspectorToggleBtn = document.getElementById('inspectorToggle');
  var inspectorCloseBtn = document.getElementById('inspectorClose');
  var accentPicker = document.getElementById('accentPicker');
  var hexPreview = document.getElementById('hexPreview');
  var hexInput = document.getElementById('hexInput');
  var bgDarknessSlider = document.getElementById('bgDarknessSlider');
  var bgDarknessValue = document.getElementById('bgDarknessValue');
  var surfaceTintSlider = document.getElementById('surfaceTintSlider');
  var surfaceTintValue = document.getElementById('surfaceTintValue');
  var fontPicker = document.getElementById('fontPicker');
  var fontSizeGroup = document.getElementById('fontSizeGroup');
  var fontWeightGroup = document.getElementById('fontWeightGroup');
  var lineHeightSlider = document.getElementById('lineHeightSlider');
  var lineHeightValue = document.getElementById('lineHeightValue');
  var radiusSlider = document.getElementById('radiusSlider');
  var radiusValue = document.getElementById('radiusValue');
  var borderWidthGroup = document.getElementById('borderWidthGroup');
  var shadowSlider = document.getElementById('shadowSlider');
  var shadowValue = document.getElementById('shadowValue');
  var presetPicker = document.getElementById('presetPicker');
  var resetBtn = document.getElementById('resetBtn');
  var inspectorOpen = false;

  /* ---- Build accent swatches ---- */
  PALETTES.forEach(function(p) {
    var btn = document.createElement('button');
    btn.className = 'inspector__swatch' + (p.id === 'original' ? ' inspector__swatch--original' : '');
    btn.setAttribute('data-palette', p.id);
    btn.setAttribute('title', p.name);
    btn.setAttribute('aria-label', p.name + ' palette');
    if (p.accent) { btn.style.background = p.accent; }
    accentPicker.appendChild(btn);
  });

  /* ---- Build font chips ---- */
  FONTS.forEach(function(f) {
    var btn = document.createElement('button');
    btn.className = 'inspector__font-chip';
    btn.setAttribute('data-font', f.id);
    btn.textContent = f.name;
    if (f.stack) { btn.style.fontFamily = f.stack; }
    fontPicker.appendChild(btn);
  });

  /* ---- Build preset buttons ---- */
  PRESETS.forEach(function(p) {
    var btn = document.createElement('button');
    btn.className = 'inspector__preset-btn';
    btn.setAttribute('data-preset', p.id);
    if (p.dot) {
      var dot = document.createElement('span');
      dot.className = 'inspector__preset-dot';
      dot.style.background = p.dot;
      btn.appendChild(dot);
    }
    var label = document.createTextNode(p.name);
    btn.appendChild(label);
    presetPicker.appendChild(btn);
  });

  /* ---- Accordion toggle ---- */
  inspectorEl.querySelectorAll('.inspector__section-toggle').forEach(function(toggle) {
    toggle.addEventListener('click', function() {
      var section = toggle.closest('.inspector__section');
      var content = section.querySelector('.inspector__section-content');
      var isOpen = section.classList.contains('is-open');

      if (typeof gsap !== 'undefined' && !UV.prefersReducedMotion) {
        if (isOpen) {
          gsap.to(content, {
            height: 0, duration: 0.25, ease: 'power2.in',
            onComplete: function() { content.style.overflow = 'hidden'; }
          });
        } else {
          gsap.set(content, { height: 'auto' });
          gsap.from(content, {
            height: 0, duration: 0.3, ease: 'power2.out',
            onStart: function() { content.style.overflow = 'hidden'; },
            onComplete: function() { content.style.overflow = ''; }
          });
        }
      } else {
        content.style.height = isOpen ? '0' : 'auto';
        content.style.overflow = isOpen ? 'hidden' : '';
      }

      section.classList.toggle('is-open', !isOpen);
      toggle.setAttribute('aria-expanded', String(!isOpen));
    });
  });

  /* Initialize open section content height */
  inspectorEl.querySelectorAll('.inspector__section.is-open .inspector__section-content').forEach(function(c) {
    c.style.height = 'auto';
  });

  /* ---- Inspector toggle (show/hide sidebar) ---- */
  function toggleInspector() {
    inspectorOpen = !inspectorOpen;
    inspectorToggleBtn.classList.toggle('is-active', inspectorOpen);

    if (typeof gsap !== 'undefined' && !UV.prefersReducedMotion) {
      if (inspectorOpen) {
        inspectorEl.classList.add('is-open');
        panelIframe.classList.add('inspector-active');
        gsap.fromTo(inspectorEl, { x: '100%' }, { x: '0%', duration: 0.3, ease: 'power2.out' });
      } else {
        panelIframe.classList.remove('inspector-active');
        gsap.to(inspectorEl, {
          x: '100%', duration: 0.25, ease: 'power2.in',
          onComplete: function() { inspectorEl.classList.remove('is-open'); }
        });
      }
    } else {
      inspectorEl.classList.toggle('is-open', inspectorOpen);
      panelIframe.classList.toggle('inspector-active', inspectorOpen);
    }
  }

  inspectorToggleBtn.addEventListener('click', toggleInspector);
  inspectorCloseBtn.addEventListener('click', toggleInspector);

  /* ---- localStorage helpers (with migration) ---- */
  function getDesignTheme(designId) {
    try {
      var raw = localStorage.getItem('ui-vault-palette-' + designId);
      if (!raw) return JSON.parse(JSON.stringify(DEFAULT_THEME));
      var parsed = JSON.parse(raw);
      /* Migrate old format */
      if (parsed.fontSize === undefined) {
        return {
          palette: parsed.palette || 'original',
          customHex: null,
          bgDarkness: 50,
          surfaceTint: 0,
          font: parsed.font || 'system',
          fontSize: 16,
          fontWeight: 400,
          lineHeight: 1.5,
          radius: parsed.radius != null ? parsed.radius : null,
          borderWidth: 1,
          shadowIntensity: 50,
          preset: null
        };
      }
      return parsed;
    } catch(e) { return JSON.parse(JSON.stringify(DEFAULT_THEME)); }
  }

  function setDesignTheme(designId, theme) {
    localStorage.setItem('ui-vault-palette-' + designId, JSON.stringify(theme));
  }

  /* ---- CSS injection engine ---- */
  var INJECTED_STYLE_ID = 'uv-theme-override';

  function buildOverrideCSS(designId, theme) {
    var map = THEME_MAPS[designId];
    var rules = [];
    var palette = PALETTES.find(function(p) { return p.id === theme.palette; });
    var accentHex = theme.customHex || (palette ? palette.accent : null);

    /* Color overrides */
    if (map && palette && palette.id !== 'original') {
      var bgColor = palette.bg;
      var surfaceColor = palette.surface;

      /* Apply bgDarkness adjustment */
      if (bgColor && theme.bgDarkness !== 50) {
        bgColor = adjustBrightness(bgColor, theme.bgDarkness);
      }
      if (surfaceColor && theme.bgDarkness !== 50) {
        surfaceColor = adjustBrightness(surfaceColor, theme.bgDarkness);
      }

      /* Apply surfaceTint */
      if (surfaceColor && accentHex && theme.surfaceTint > 0) {
        surfaceColor = blendColors(surfaceColor, accentHex, theme.surfaceTint / 100 * 0.3);
      }

      var usedAccent = accentHex || palette.accent;

      var mappings = [
        { prop: 'bg',       val: bgColor },
        { prop: 'surface',  val: surfaceColor },
        { prop: 'accent',   val: usedAccent },
        { prop: 'text',     val: palette.text },
        { prop: 'textMuted',val: palette.textMuted },
        { prop: 'border',   val: palette.border },
      ];

      mappings.forEach(function(m) {
        var vars = map[m.prop];
        if (vars && m.val) {
          vars.forEach(function(v) {
            rules.push(v + ':' + m.val + ' !important;');
          });
        }
      });
    } else if (map && accentHex) {
      /* Custom hex on original palette — only override accent */
      var accentVars = map.accent;
      if (accentVars) {
        accentVars.forEach(function(v) {
          rules.push(v + ':' + accentHex + ' !important;');
        });
      }
    }

    /* Radius */
    if (map && theme.radius != null) {
      var r = theme.radius;
      if (map.radius) {
        map.radius.forEach(function(v) { rules.push(v + ':' + r + 'px !important;'); });
      }
      if (map.radiusSm) {
        var rSm = Math.round(r * 0.625);
        map.radiusSm.forEach(function(v) { rules.push(v + ':' + rSm + 'px !important;'); });
      }
    }

    /* Border width */
    if (map && map.border && theme.borderWidth !== 1) {
      /* We apply border-width as a separate body rule */
    }

    /* Shadow intensity */
    var shadowCSS = '';
    if (theme.shadowIntensity !== 50) {
      var si = theme.shadowIntensity / 100;
      shadowCSS = '*{--shadow-override-opacity:' + si + '}';
    }

    /* Font */
    var fontObj = FONTS.find(function(f) { return f.id === theme.font; });
    var bodyRules = [];

    if (fontObj && fontObj.stack) {
      if (map && map.font) {
        map.font.forEach(function(v) { rules.push(v + ':' + fontObj.stack + ' !important;'); });
      }
      bodyRules.push('font-family:' + fontObj.stack + ' !important');
    }

    /* Font size */
    if (theme.fontSize !== 16) {
      bodyRules.push('font-size:' + theme.fontSize + 'px !important');
    }

    /* Font weight */
    if (theme.fontWeight !== 400) {
      bodyRules.push('font-weight:' + theme.fontWeight + ' !important');
    }

    /* Line height */
    if (theme.lineHeight !== 1.5) {
      bodyRules.push('line-height:' + theme.lineHeight + ' !important');
    }

    var css = '';
    if (rules.length > 0) css += ':root{' + rules.join('') + '}';
    if (bodyRules.length > 0) css += 'body{' + bodyRules.join(';') + '}';
    if (shadowCSS) css += shadowCSS;

    return css;
  }

  function injectTheme(designId) {
    try {
      var doc = panelIframe.contentDocument || panelIframe.contentWindow.document;
      if (!doc) return;

      var existing = doc.getElementById(INJECTED_STYLE_ID);
      if (existing) existing.remove();

      var theme = getDesignTheme(designId);
      var css = buildOverrideCSS(designId, theme);
      if (!css) return;

      var style = doc.createElement('style');
      style.id = INJECTED_STYLE_ID;
      style.textContent = css;
      doc.head.appendChild(style);
    } catch(e) { /* cross-origin or iframe not loaded */ }
  }

  /* ---- Sync inspector UI to current design theme ---- */
  function syncInspectorUI(designId) {
    var theme = getDesignTheme(designId);
    var map = THEME_MAPS[designId];
    var isHardcoded = (map === null);

    /* Accent swatches */
    accentPicker.querySelectorAll('.inspector__swatch').forEach(function(btn) {
      var pid = btn.getAttribute('data-palette');
      btn.classList.toggle('is-active', pid === theme.palette && !theme.customHex);
      btn.classList.toggle('is-disabled', isHardcoded && pid !== 'original');
      btn.disabled = isHardcoded && pid !== 'original';
    });

    /* Hex input */
    var palette = PALETTES.find(function(p) { return p.id === theme.palette; });
    var displayHex = theme.customHex || (palette && palette.accent) || '#D97706';
    hexInput.value = displayHex;
    hexPreview.style.background = displayHex;
    hexInput.disabled = isHardcoded;

    /* Bg darkness */
    bgDarknessSlider.value = theme.bgDarkness;
    bgDarknessValue.textContent = theme.bgDarkness + '%';
    bgDarknessSlider.disabled = isHardcoded || theme.palette === 'original';

    /* Surface tint */
    surfaceTintSlider.value = theme.surfaceTint;
    surfaceTintValue.textContent = theme.surfaceTint + '%';
    surfaceTintSlider.disabled = isHardcoded || theme.palette === 'original';

    /* Font chips */
    fontPicker.querySelectorAll('.inspector__font-chip').forEach(function(btn) {
      btn.classList.toggle('is-active', btn.getAttribute('data-font') === theme.font);
    });

    /* Font size */
    fontSizeGroup.querySelectorAll('.inspector__toggle-btn').forEach(function(btn) {
      btn.classList.toggle('is-active', parseInt(btn.getAttribute('data-size')) === theme.fontSize);
    });

    /* Font weight */
    fontWeightGroup.querySelectorAll('.inspector__toggle-btn').forEach(function(btn) {
      btn.classList.toggle('is-active', parseInt(btn.getAttribute('data-weight')) === theme.fontWeight);
    });

    /* Line height */
    lineHeightSlider.value = theme.lineHeight;
    lineHeightValue.textContent = theme.lineHeight.toFixed(1);

    /* Radius */
    if (theme.radius != null) {
      radiusSlider.value = theme.radius;
      radiusValue.textContent = theme.radius + 'px';
    } else {
      radiusSlider.value = 12;
      radiusValue.textContent = '--';
    }
    radiusSlider.disabled = isHardcoded || !map || !map.radius;

    /* Border width */
    borderWidthGroup.querySelectorAll('.inspector__toggle-btn').forEach(function(btn) {
      btn.classList.toggle('is-active', parseInt(btn.getAttribute('data-border')) === theme.borderWidth);
      btn.disabled = isHardcoded;
    });

    /* Shadow */
    shadowSlider.value = theme.shadowIntensity;
    shadowValue.textContent = theme.shadowIntensity + '%';

    /* Presets */
    presetPicker.querySelectorAll('.inspector__preset-btn').forEach(function(btn) {
      btn.classList.toggle('is-active', btn.getAttribute('data-preset') === theme.preset);
      btn.classList.toggle('is-disabled', isHardcoded && btn.getAttribute('data-preset') !== 'original');
      btn.disabled = isHardcoded && btn.getAttribute('data-preset') !== 'original';
    });
  }

  /* ---- Helper: update theme and inject ---- */
  function applyThemeChange() {
    if (!currentPanelId) return;
    var theme = getDesignTheme(currentPanelId);
    theme.preset = null;
    setDesignTheme(currentPanelId, theme);
    syncInspectorUI(currentPanelId);
    injectTheme(currentPanelId);
  }

  /* ---- Event: accent swatch click ---- */
  accentPicker.addEventListener('click', function(e) {
    var btn = e.target.closest('.inspector__swatch');
    if (!btn || btn.disabled || !currentPanelId) return;
    var theme = getDesignTheme(currentPanelId);
    theme.palette = btn.getAttribute('data-palette');
    theme.customHex = null;
    theme.preset = null;
    setDesignTheme(currentPanelId, theme);
    syncInspectorUI(currentPanelId);
    injectTheme(currentPanelId);
  });

  /* ---- Event: hex input ---- */
  hexInput.addEventListener('input', function() {
    var val = hexInput.value.trim();
    if (/^#[0-9a-fA-F]{6}$/.test(val)) {
      if (!currentPanelId) return;
      var theme = getDesignTheme(currentPanelId);
      theme.customHex = val;
      theme.preset = null;
      hexPreview.style.background = val;
      setDesignTheme(currentPanelId, theme);
      injectTheme(currentPanelId);
    }
  });

  /* ---- Event: bg darkness slider ---- */
  bgDarknessSlider.addEventListener('input', function() {
    if (!currentPanelId) return;
    var theme = getDesignTheme(currentPanelId);
    theme.bgDarkness = parseInt(bgDarknessSlider.value);
    bgDarknessValue.textContent = theme.bgDarkness + '%';
    theme.preset = null;
    setDesignTheme(currentPanelId, theme);
    injectTheme(currentPanelId);
  });

  /* ---- Event: surface tint slider ---- */
  surfaceTintSlider.addEventListener('input', function() {
    if (!currentPanelId) return;
    var theme = getDesignTheme(currentPanelId);
    theme.surfaceTint = parseInt(surfaceTintSlider.value);
    surfaceTintValue.textContent = theme.surfaceTint + '%';
    theme.preset = null;
    setDesignTheme(currentPanelId, theme);
    injectTheme(currentPanelId);
  });

  /* ---- Event: font chip click ---- */
  fontPicker.addEventListener('click', function(e) {
    var btn = e.target.closest('.inspector__font-chip');
    if (!btn || !currentPanelId) return;
    var theme = getDesignTheme(currentPanelId);
    theme.font = btn.getAttribute('data-font');
    theme.preset = null;
    setDesignTheme(currentPanelId, theme);
    syncInspectorUI(currentPanelId);
    injectTheme(currentPanelId);
  });

  /* ---- Event: font size toggle ---- */
  fontSizeGroup.addEventListener('click', function(e) {
    var btn = e.target.closest('.inspector__toggle-btn');
    if (!btn || !currentPanelId) return;
    var theme = getDesignTheme(currentPanelId);
    theme.fontSize = parseInt(btn.getAttribute('data-size'));
    theme.preset = null;
    setDesignTheme(currentPanelId, theme);
    syncInspectorUI(currentPanelId);
    injectTheme(currentPanelId);
  });

  /* ---- Event: font weight toggle ---- */
  fontWeightGroup.addEventListener('click', function(e) {
    var btn = e.target.closest('.inspector__toggle-btn');
    if (!btn || !currentPanelId) return;
    var theme = getDesignTheme(currentPanelId);
    theme.fontWeight = parseInt(btn.getAttribute('data-weight'));
    theme.preset = null;
    setDesignTheme(currentPanelId, theme);
    syncInspectorUI(currentPanelId);
    injectTheme(currentPanelId);
  });

  /* ---- Event: line height slider ---- */
  lineHeightSlider.addEventListener('input', function() {
    if (!currentPanelId) return;
    var theme = getDesignTheme(currentPanelId);
    theme.lineHeight = parseFloat(lineHeightSlider.value);
    lineHeightValue.textContent = theme.lineHeight.toFixed(1);
    theme.preset = null;
    setDesignTheme(currentPanelId, theme);
    injectTheme(currentPanelId);
  });

  /* ---- Event: radius slider ---- */
  radiusSlider.addEventListener('input', function() {
    if (!currentPanelId) return;
    var val = parseInt(radiusSlider.value);
    radiusValue.textContent = val + 'px';
    var theme = getDesignTheme(currentPanelId);
    theme.radius = val;
    theme.preset = null;
    setDesignTheme(currentPanelId, theme);
    injectTheme(currentPanelId);
  });

  /* ---- Event: border width toggle ---- */
  borderWidthGroup.addEventListener('click', function(e) {
    var btn = e.target.closest('.inspector__toggle-btn');
    if (!btn || btn.disabled || !currentPanelId) return;
    var theme = getDesignTheme(currentPanelId);
    theme.borderWidth = parseInt(btn.getAttribute('data-border'));
    theme.preset = null;
    setDesignTheme(currentPanelId, theme);
    syncInspectorUI(currentPanelId);
    injectTheme(currentPanelId);
  });

  /* ---- Event: shadow slider ---- */
  shadowSlider.addEventListener('input', function() {
    if (!currentPanelId) return;
    var theme = getDesignTheme(currentPanelId);
    theme.shadowIntensity = parseInt(shadowSlider.value);
    shadowValue.textContent = theme.shadowIntensity + '%';
    theme.preset = null;
    setDesignTheme(currentPanelId, theme);
    injectTheme(currentPanelId);
  });

  /* ---- Event: preset click ---- */
  presetPicker.addEventListener('click', function(e) {
    var btn = e.target.closest('.inspector__preset-btn');
    if (!btn || btn.disabled || !currentPanelId) return;
    var presetId = btn.getAttribute('data-preset');
    var preset = PRESETS.find(function(p) { return p.id === presetId; });
    if (!preset) return;

    var theme = getDesignTheme(currentPanelId);
    theme.palette = preset.palette;
    theme.customHex = null;
    theme.font = preset.font;
    theme.fontSize = preset.fontSize;
    theme.fontWeight = preset.fontWeight;
    theme.lineHeight = preset.lineHeight;
    theme.radius = preset.radius;
    theme.borderWidth = preset.borderWidth;
    theme.shadowIntensity = preset.shadowIntensity;
    theme.bgDarkness = 50;
    theme.surfaceTint = 0;
    theme.preset = presetId;
    setDesignTheme(currentPanelId, theme);
    syncInspectorUI(currentPanelId);
    injectTheme(currentPanelId);
  });

  /* ---- Event: reset button ---- */
  resetBtn.addEventListener('click', function() {
    if (!currentPanelId) return;
    localStorage.removeItem('ui-vault-palette-' + currentPanelId);
    syncInspectorUI(currentPanelId);
    injectTheme(currentPanelId);
  });

  /* ===========================================================
     CATALOG LOADER
     =========================================================== */
  function loadCatalog(callback) {
    if (CATALOG_DATA.length > 0) {
      callback();
      return;
    }

    try {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', 'catalog.json', true);
      xhr.timeout = 3000;
      xhr.onload = function() {
        if (xhr.status === 200 || xhr.status === 0) {
          try {
            var data = JSON.parse(xhr.responseText);
            /* Support both flat array and { designs: [] } wrapper */
            if (Array.isArray(data) && data.length > 0) {
              CATALOG_DATA = data;
            } else if (data && Array.isArray(data.designs) && data.designs.length > 0) {
              CATALOG_DATA = data.designs;
            }
          } catch(e) { /* parse error, use empty fallback */ }
        }
        callback();
      };
      xhr.onerror = function() { callback(); };
      xhr.ontimeout = function() { callback(); };
      xhr.send();
    } catch(e) {
      callback();
    }
  }

  /* ===========================================================
     INIT
     =========================================================== */
  function init() {
    setView(currentView);
    renderSidebar();
    renderContent();
    gsapInit();
  }

  /* ===========================================================
     GSAP INITIALIZATION
     =========================================================== */
  function gsapInit() {
    if (typeof gsap === 'undefined' || UV.prefersReducedMotion) return;

    /* Page load timeline */
    var tl = gsap.timeline({ defaults: { ease: 'power3.out' } });
    tl.from('.header', { y: -20, opacity: 0, duration: 0.5 })
      .from('.sidebar', { x: -20, opacity: 0, duration: 0.4 }, '-=0.3')
      .from('.header__search-input', { scaleX: 0.7, opacity: 0, duration: 0.35, transformOrigin: 'left center' }, '-=0.2')
      .from('.header__actions', { opacity: 0, duration: 0.3 }, '-=0.2');

    /* Card hover lift */
    UV.hoverLift('.card', {
      y: -3,
      shadow: '0 8px 24px rgba(140,130,115,0.12)',
      restShadow: '0 4px 12px rgba(140,130,115,0.10)',
    });

    /* Sidebar item hover */
    UV.hoverScale('.sidebar__item', {
      scale: 1.02,
      duration: 0.2,
      shadow: 'none',
      restShadow: 'none',
    });

    /* Header button hover */
    document.querySelectorAll('.header__btn, .panel__btn').forEach(function(el) {
      el.addEventListener('mouseenter', function() {
        gsap.to(el, { scale: 1.1, duration: 0.2, ease: 'power2.out' });
      });
      el.addEventListener('mouseleave', function() {
        gsap.to(el, { scale: 1, duration: 0.2, ease: 'power2.out' });
      });
    });
  }

  loadCatalog(init);

})();
</script>
</body>
</html>
